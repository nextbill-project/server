{"version":3,"sources":["app.module.js","app.config.js","analysis/analysis-chart.controller.js","analysis/analysis.service.js","billings/billing-create.controller.js","billings/billing-details.controller.js","billings/billing-process-list.controller.js","billings/billing.service.js","budgets/budget-edit.controller.js","budgets/budget-list.controller.js","budgets/budget.service.js","businesspartners/businesspartner.service.js","components/ms-articles-select.component.js","components/ms-costdistribution-calculate.directive.js","components/ms-input-date.component.js","components/ms-invoice-summary.component.js","components/ms-invoice-table.component.js","components/ms-invoicecategorie-select.directive.js","components/ms-paymentperson-select.directive.js","components/ms-search-configuration.directive.js","costdistributionitems/costdistribution.service.js","costdistributionitems/costdistributionitem.service.js","dashboard/dashboard.controller.js","fileanalyses/fileanalyses-upload.controller.js","invoicecategories/invoicecategories.service.js","invoiceimages/invoiceimage.service.js","invoices/invoice-edit.controller.js","invoices/invoice-list.controller.js","invoices/invoice.service.js","messages/message.service.js","notifications/notification.directive.js","notifications/notification.service.js","services/costdistributioncalculate.service.js","services/search.service.js","settings/profile.controller.js","settings/settings.service.js","settings/setup.controller.js","standingorders/standingorder-list.controller.js","shell/shell.controller.js","user/user-list.controller.js","user/user.service.js","usercontacts/usercontact.service.js"],"names":["angular","module","constant","window","csrfToken","moment","_","ColorHash","Chart","value","configure","$httpProvider","$urlRouterProvider","$stateProvider","$translateProvider","defaults","xsrfHeaderName","xsrfCookieName","when","otherwise","state","url","templateUrl","controller","controllerAs","abstract","template","params","sumToBePaid","userContact","billingListItem","returnView","useSanitizeValueStrategy","useStaticFilesLoader","prefix","suffix","fallbackLanguage","preferredLanguage","config","$inject","AnalysisChartController","$state","SearchService","$stateParams","NotificationService","AnalysisService","InvoiceService","vm","this","updateChartData","isSearchFiringActivated","diagramViewType","useAbsolutValues","diagramType","then","response","refreshChart","response2","chartData","getChartData","labels","xaxesValues","push","yaxesValues","title","diagramViewOptions","name","code","isActive","diagramOptions","barChartOptions","pieChartOptions","showAllTooltips","pluginService","register","beforeRender","chart","options","pluginTooltips","data","datasets","forEach","dataset","i","getDatasetMeta","sector","j","Tooltip","_chart","_chartInstance","_data","_options","tooltips","_active","enabled","afterDraw","easing","allTooltipsOnce","helpers","each","tooltip","initialize","displayColors","bodyFontSize","height","yPadding","xPadding","caretSize","cornerRadius","update","pivot","transition","draw","selectedMonth","monthRanges","showAfterButton","showBeforeButton","startSearch","setChartType","item","statisticData","basicDataSubType","tmpValue","getStatisticData","undefined","numberValue","setChartViewType","chartServiceLoading","isLoading","transferSelectionToSearch","getSearchConfiguration","startDate","endDate","monthSelected","findWhere","monthNumber","parseInt","startMonth","endMonth","monthBefore","currentMonthNumber","toString","monthAfter","length","monthNames","currentDate","subtract","currentDate2","monthRange","startOf","toDate","getTime","endOf","monthName","month","year","generateMonthRanges","activate","$http","$q","base","chartsWithFilter","statistics","isLoadingValue","service","useAbsolutValuesTmp","chartTypeTmp","searchConfiguration","clearCurrentPageReadyList","clearCurrentPageCheckList","setSearchMode","allInvoices","tmpSearchConfiguration","copy","standingOrder","resolve","method","chartType","result","$log","warn","setIsLoading","isLoadingValueTmp","indexOfPosition","findIndex","factory","BillingCreateController","BillingService","SettingsService","switched","smtpMailServiceEnabled","toggleSwitch","go","returnViewObject","view","billingConfig","costPayerMail","email","getCategoriesForInvoicePayer","billing","categoriesInvoicePayer","map","invoiceCategoriesOfInvoicePayer","category","invoiceCategoryName","join","getCategoriesForCostPayer","categoriesCostPayer","invoiceCategoriesOfCostPayer","createBilling","userSelectionPaymentPersonTypeEnum","paymentPersonTypeEnum","userSelection","paymentPersonId","sendMailInvoicePayer","sendMailCostPayer","lockBillingButton","get","BillingDetailsController","leaveState","getBilling","billingId","selected","returnSumPaidSum","sumPaid","archiveBilling","firstAction","billingUpdate","messageType","secondAction","billingDelete","getBillingReportUrl","billingReportUrl","billingServiceLoading","createCompensation","invoiceId","executeEquality","BillingProcessListController","UserService","useArchived","getGroupedBillingListItems","getBillingProcesses","getBillingListProcessItems","groupedBillingListItem","billingListProcessItemDTOs","checkReminderMessage","appUserId","refreshArchived","setUseArchived","paramsTransfer","currentUser","currentuser","invoicePayer","paymentPersonEnum","foundCostDistribution","filter","userContactDTOs","userContactDTO","userContactId","payerId","costPayer","showCanBeCompensatedWarning","billingProcess","sumToPay","showBillingPaidPart","billingListItemDTO","showSumToBeChecked","sumToBeChecked","goToDetails","billingListProcessItem","listBillingProcesses","getUseArchived","MessageService","billingUdate","billingProcesses","billingReport","archive","billingProcessList","billingList","getBillings","replace","reportConfig","httpConfiguration","headers","Content-Type","create","list","billingPaymentBean","billingStatusEnum","result3","result2","object1Id","useArchivedTmp","reject","resultError","urlExtended","BudgetEditController","$timeout","$filter","$scope","BudgetService","budget","createMode","budgetId","paymentTypeEnums","budgetRepetionTypeEnums","submitForm","paymentTypeEnum","createBudget","goToOverview","updateBudget","getDialogId","customIdentifier","resultId","getDialogIdWithoutHash","removePersonFromList","payerDtoInput","payerDTOS","payerDTO","id","splice","removeCategoryFromList","categoryDtoInput","invoiceCategoryDTOS","categoryDTO","addPersonToList","payer","budgetRecipient","displayName","type","addCategoryToList","removeBudget","deleteBudget","deleteConfirmationMenu","$itemScope","$event","color","paymentTypeEnumList","budgetRepetitionTypeEnumList","details","Date","s4","Math","floor","random","substring","generateUUID","budgetRepetitionType","sum","BudgetListController","budgets","newBudget","budgetServiceLoading","displayNameForBudgetType","budgetType","displayNames","WEEK","MONTH","listBudgets","budgetUdate","budgetDelete","budgetList","getBudgets","BusinesspartnerService","getOne","uuid","getAutoCategory","getBusinessPartners","businessPartners","search","searchName","businessPartnerName","businessPartnerDTOList","businessPartnerNewName","newUserName","getBusinessPartnerNewName","businessPartnerDTO","remove","businessPartnerId","foundBusinessPartner","businessPartner","foundBusinessPartnerIndex","indexOf","ArticlesSelectController","showLoadingText","dataInput","articles","imageUrl","username","setTimeout","error","console","log","calculateSum","price","roundedString","toFixed","Number","useThisSum","callback","document","getElementById","addEventListener","event","x","y","bounds","getBoundingClientRect","left","top","pageX","pageY","cw","clientWidth","ch","clientHeight","iw","naturalWidth","ih","naturalHeight","py","percentX","toPrecision","percentY","removeArticleFromList","article","component","bindings","msCostdistributioncalculate","$document","restrict","scope","costDistributionItem","costDistributionItems","dialogId","updateMethod","sumCost","link","CostdistributioncalculateController","bindToController","CostdistributioncalculateService","updateCostDistributionItem","currentValue","prototype","setScale","scale","pow","round","divide","number2","remainder","n","compareTo","multiply","add","costDistributionPercentageTv","costDistributionQuotaTv","costDistributionFixedAmountEt","costDistributionItemTypeEnum","costDistributionItemsWithoutCurrentItem","costDistributionItemId","costDistributionItemsWithoutCurrentItemUpdate","refreshAllViews","updateCostDistributionItems","moneyValue","calculateAmountForCostDistributionItemPrecise","onProgressChanged","percent","seekBar","maxAmountForOneCostDistributionItem","getMaxAmountForOneCostDistributionItem","maxQuota","getCountWithoutFixed","maxQuotaWeighted","getCountWeightedWithoutFixed","maxQuotaSubtractMaxQuotaWeighted","maxAmount","percentOfResult","quotaForEt","refreshProgressBar","refreshFixedAmountEt","calculateQuotaForValue","percentOfCurrentQuota","percentForValue","calculatePercentForValue","refreshPercentageTv","onQuotaCheckBoxClick","quota","onPercentCheckBoxClick","onFixedAmountCheckBoxClick","fixedAmount","calculateAmountForValue","onFixedAmountTextChanged","fixedAmountForEt","percentForProgressEt","amountOfPercent","directive","InputDateController","$element","$onInit","$watch","newValue","timestamp","intTimestamp","date","isNaN","$onChanges","changes","required","attr","removeAttribute","dateToTimestamp","isDate","isFunction","setDateToNull","setNull","disabled","InvoiceSummaryController","CostdistributionitemService","InvoiceimageService","payerName","paymentRecipientName","hasInvoiceImageValue","repetionTypeEnums","originalStandingOrder","costDistributions","goToInvoice","invoice","isReadOnlyMode","invoiceWorkflowMode","isStandingOrder","removeInvoiceTemplate","removeInvoice","hasInvoiceImage","invoiceImageId","getInvoiceImageUrl","deleteStandingOrder","isNullOrUndefined","todoAfter","getCurrentUser","paymentRecipientId","paymentRecipientDTO","refreshInvoiceData","costDistributionItemDTOs","originalCostDistributionItems","originalInvoice","invoiceTemplateId","futureInvoiceTemplateId","getStandingOrder","repetitionTypeEnum","repetitionTypeEnumList","foundRepetionTypeEnum","repetionTypeEnum","foundRepetionTypeEnumIndex","isReadyOnlyMode","InvoiceTableController","info","selectedInvoiceId","isInvoiceDetailsEnabled","tableViewId","detailViewId","allowGoTo","invoiceStatusEnum","toggleInvoiceDetails","isSelected","chain","intersection","toggleSelect","index","invoiceServiceLoading","invoices","useSelection","useDebtValue","msInvoicecategorieSelect","InvoicecategoriesService","invoiceCategories","returnInvoiceCategory","currentSelection","hideSelectionButton","expenseType","hiddenSelButtonActivator","element","attrs","InvoicecategorieSelectController","newInvoiceCategoryName","getParentInvoiceCategories","categorieParentsFiltered","selectNone","findInvoiceCategoriesForParent","parentInvoiceCategory","getInvoiceCategories","invoiceCategory","parentInvoiceCategoryDTO","invoiceCategoryId","selectInvoiceCategory","invoiceCategorie","invoiceCategorySearch","refreshInvoiceParents","searchFilterForInvoiceCategories","searchMatcher","hasChilds","childCategories","searchFilter","searchInput","searchMatch","RegExp","test","createInvoiceCategory","parentInvoiceCategoryAdding","removeInvoiceCategory","msPaymentpersonSelect","appUsers","userContacts","projects","callbackPaymentPerson","hideBusinessPartners","hideCurrentUser","PaymentpersonSelectController","UsercontactService","showDialog","businessPartnerTimeoutRunning","appUserTimeoutRunning","currentUserId","getUsers","appUser","foundAppUser","appUserContactId","foundAppUserIndex","getNewBusinessPartnerName","getFoundAppUser","createNewBusinessPartner","selectBusinessPartner","createNewProject","createProject","projectsSearch","selectProject","createNewUserContact","createUserContact","userContactsSearch","selectUserContact","createNewAppUserContact","createAppUserContact","selectUser","removeBusinessPartner","removeUserContact","businessPartnerInputDone","businessPartnerInput","appUserInputDone","usersSearch","searchForUser","getUserContacts","getProjects","resetValues","user","contactName","virtualType","project","searchFilterForBusinessPartners","businessPartnerSearch","searchFilterForUsers","searchFilterForUserContacts","searchFilterForProjects","msSearchConfiguration","SearchConfigurationController","CostdistributionService","payerPersonSearchConfiguration","paymentRecipientPersonSearchConfiguration","costPayerSearchConfiguration","invoiceCategorySearchConfiguration","repetitionTypeEnums","enumName","booleanSelections","remarksTimeoutRunning","remarksInput","fullTextTimeoutRunning","fullTextInput","remarksInputDone","remarks","fullTextInputDone","fullText","getPayerPersonSelection","payerPerson","getCostDistributions","repairSearchConfiguration","updateSearchConfiguration","getPaymentRecipientPersonSelection","paymentRecipientPerson","getCostPayerSelection","setPayerPerson","payerEnum","setPaymentRecipientPerson","setCostPayer","invoiceCategoryDTO","costDistribution","costDistributionItemDTOS","costDistributionId","prepareItemForCostDistribution","listForInvoice","DashboardController","FileAnalysesController","FileUploader","uploader","alias","csrf_token","cname","ca","decodeURIComponent","cookie","split","c","charAt","getCookie","filters","fn","queue","onWhenAddingFileFailed","onAfterAddingFile","fileItem","onAfterAddingAll","addedFileItems","onBeforeUploadItem","onProgressItem","progress","onProgressAll","onSuccessItem","status","onErrorItem","onCancelItem","onCompleteItem","onCompleteAll","resetSearchConfiguration","invoicecategories","autoAttributes","getAutoAttributes","categorieParents","invoiceCategoryType","invoiceCategoryNameInput","parentInvoiceCategoryId","InvoiceEditController","areChanges","isStandingOrderEqual","imagePreview","isAllAnotherEqual","equals","toDoAfterCurrentUserGet","createNewCostDistributionItem","mainFunctionEnum","paymentRecipientTypeEnum","payerTypeEnum","articleDTOs","mistakeMessage","transactionType","loadingBarCategory","userSelectSearch","costDistributionsMenu","costDistributionsMenuOptions","selectedCostDistributionItemForArticleSelection","uploadAll","generateStandingOrder","updateInvoice","resetForm","getInvoice","invoiceForm","$setPristine","$setUntouched","repeatAnalysis","addCostDistributionItemToList","position","costPaid","paymentPersonName","correctionStatus","getAttributesForCategory","sumOfInvoice","resetInvoice","paymentRecipientTransfer","getCategoryForBusinessPartner","$","modal","updateCostDistributionItemDirectiveExec","updateCostDistributionItemDirective","payerTransfer","removeImage","clearQueue","showArticlesInvoiceDialog","showArticlesDialogForInvoice","hideArticlesInvoiceDialog","selectArticleInvoiceData","showPaymentRecipient","showPayer","callbackForArticlesSelectInvoice","selectArticleCostDistributionItem","showArticlesDialogForCostDistributionItem","hideSelectArticleCostDistributionItemDialog","selectedArticleCostDistributionItemData","callbackForArticlesSelectCostDistributionItem","reverseInvoice","removeCostDistributionItemFromList","lastCostDistributionItem","setCorrectionStatus","setCostPaidStatus","paymentItem","setInvoiceCostPaidStatus","showPaymentRecipientPaymentPersonHasPaidButton","createdById","showPayerPaymentPersonHasPaidButton","showCostPaymentPersonHasPaidButton","paymentItemPersonHasPaid","invoicePaymentItemPersonHasPaid","appUserName","correctDateAndRepetitionForStandingOrder","hasChangesInDate","dateOfInvoice","useCostDistribution","innerItem","newCostDistributionItem","createCostDistributionRequest","tmpCostDistribution","newCostDistributionName","removeCostDistribution","costDistributionInput","foundCostDistributionIndex","sendMistakeMessage","useStandardCostDistribution","today","invoiceSource","reader","FileReader","onload","readAsDataURL","_file","hasUserRight","hasScanRight","isObject","deleteInvoiceImage","updateStandingOrder","specialType","InvoiceListController","showCheckList","showReadyList","isLoadingReadyList","toggleFilter","setViewMode","viewMode","getInvoices","mode","viewInput","getViewMode","getIsScrollingDisabled","toggleFilterView","toggleExportView","showCsvExport","getCsvExportUrl","jsonString","JSON","stringify","objJsonB64","btoa","setCorrectionStatusForSelection","updateCorrectionStatus","refreshInvoiceList","refreshInvoices","setIsScrollingDisabled","$emit","showMoreReadyList","isSearchMode","addValueToCurrentPageReadyList","readyInvoicesList","showMoreCheckList","addValueToCurrentPageCheckList","checkInvoicesList","newExpense","newIncome","newFileAnalysis","otherMenuOptions","invoicesWithFilterBean","invoiceImages","standingOrders","standingOrderInvoiceTemplates","deleteStandingOrders","invoiceAnalysis","invoiceListCheck","invoiceListReady","invoiceListReadyRaw","invoiceListStandingOrder","currentPageReadyList","currentPageCheckList","useSearchMode","isScrollingDisabled","resultCostItems","detailsInvoice","distributeInvoice","setWorkflow","searchAndRemoveInvoiceInList","searchAndUpdateInvoiceInList","message","messageDTO","getInvoicesReadyRawList","setInvoices","invoiceListTmp","invoiceListTmp2","invoiceList","standingOrderInvoiceTemplateId","invoiceListReadyTmp","invoiceListReadyTmpSorted","sortBy","o","reverse","itemsGroupedByMonth","distributeInvoices","deleteInvoiceTemplate","foundInvoice","foundInvoiceIndex","currentPageReadyListTmp","invoiceListReadyRawSize","invoiceListReadyRawOriginalCopy","searchModeInput","viewModeInput","pollingProcessRecursive","currentIteration","sleeptimes","invoiceInput","distributeReadyInvoices","invoicesListReadyTmp","items","groups","groupsTmp","itemGroupedByMonths","monthLabels","dateOfInvoiceTmp","tmpKey","getMonth","getFullYear","tmpKeyObject","key","groupTmp","groupLabel","groupSum","all","onlyStandingOrder","currentPage","counter","invoiceListReadyRawCounter","invoiceListReadyRawTmp","searchFilterBean","pageNumber","invoiceDTOs","invoiceTmp","messages","deleteMessage","messagesList","getMessages","problemSolved","basicDataId","foundMessage","foundMessageIndex","isCustomized","tmpMessageList","tmpItem","tmpItemMessageParsed","parse","subject","msNotification","$rootScope","$compile","container","duration","removeDelay","$on","received","toastId","content","notification","append","toast","delay","NotificationController","$translate","translatedContent","$broadcast","translationKey","getMaxQuotaForOneCostDistributionItem","getMaxAmountForOneQuota","costDistributionItemTypeOfValue","quotaWeighted","maxQuotaForOneCostDistributionItemTmp","maxAmountForOneQuota","valueForCalculating","percentOfMaxAmountForOneQuota","maxQuotaForOneCostDistributionItem","resultPercent","getCountOfFixedAmount","getCountOfPercent","calculateAmountForCostDistributionItem","resultAmount","countWeightedWithoutFixed","countWithoutFixed","countOfFixed","countOfPercent","sumOfPercent","tmpCostDistributionItem","sumOfFixedAmount","sumOfMixed","isCostDistributionComplete","countCostDistributionItemsIncludeQuota","costDistributionPosition","costDistributionItemQuotaList","tmpCostDistributionItem1","calculatedRestSum","sumOfAllCostDistributions","getCalculatedRestSum","corrector","restAmountForOneCostDistributionItem","amountWithoutFixed","getCountOfFixed","setSearchConfiguration","searchConfigurationInput","defaultSearchConfiguration","isSearchConfigurationDefaultOne","NaN","incomeMainFunctionEnum","expenseMainFunctionEnum","ProfileController","mailSendEnabled","sendPasswordResetMail","sendPassword","responseMail","getInit","updateInit","setupData","sendTestMail","scansioEnabled","versionCheck","SetupController","loaded","version","saveData","resetUser","newUrl","location","protocol","host","StandingOrderListController","viewList","ShellController","userCanEditUsers","userCanEditSettings","settingsLoaded","countOfMessages","getMessageDTO","basicDataMessage","thirdAction","UserListController","users","userToDelete","lockUser","editable","new","indexOfUser","updateUser","adminUpdate","foundUser","tmpUser","foundUserIndex","showDeleteUserDialog","deleteUser","adminDelete","addUser","unshift","useAndroid","useOcr","editUsers","editSettings","mail","responseScansio","appUserDTO","currentUserFun","rightCode","roles","appRightDTOs","pluck","usercontacts","findByEmail","projectNewName","allContacts","distributeContacts","userContactNewName","foundUserContact","foundUserContactIndex","searchMail","getCurrentUSer","currentUserData"],"mappings":"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","file":"../app/app.min.js","sourcesContent":["/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp',[\r\n\t\t\t'ui.router',\r\n\t\t\t'monospaced.elastic',\r\n\t\t\t'moment-picker',\r\n\t\t\t'pascalprecht.translate',\r\n\t\t\t'angular-loading-bar',\r\n\t\t\t'ui.bootstrap.contextMenu',\r\n            'chart.js',\r\n\t\t\t'msWebApp.msInputDate',\r\n\t\t\t'msWebApp.msPaymentpersonSelect',\r\n\t\t\t'msWebApp.msCostdistributioncalculate',\r\n\t\t\t'msWebApp.msInvoicecategorieSelect',\r\n\t\t\t'msWebApp.msArticlesSelect',\r\n\t\t\t'msWebApp.msSearchConfiguration',\r\n\t\t\t'msWebApp.msInvoiceTable',\r\n\t\t\t'msWebApp.msInvoiceSummary',\r\n\t\t\t'angularFileUpload',\r\n\t\t\t'infinite-scroll'\r\n\t\t])\r\n\t\t.constant('csrfToken', window.csrfToken)\r\n\t\t.constant('moment', window.moment)\r\n\t\t.constant('_', window._)\r\n\t\t.constant('ColorHash', window.ColorHash)\r\n        .constant('Chart', window.Chart)\r\n\t\t.value('THROTTLE_MILLISECONDS', 2000);\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.config(configure);\r\n\r\n\tconfigure.$inject = ['$httpProvider','$urlRouterProvider','$stateProvider','$translateProvider'];\r\n\r\n\tfunction configure($httpProvider,$urlRouterProvider,$stateProvider,$translateProvider) {\r\n\t\tvar langCode = 'de';\r\n\r\n\t\t$httpProvider.defaults.xsrfHeaderName = csrfToken;\r\n\t\t$httpProvider.defaults.xsrfCookieName = csrfToken;\r\n\r\n\t\t$urlRouterProvider\r\n\t\t\t.when('/invoices', '/invoices/list')\r\n\t\t\t.otherwise('/');\r\n\r\n\t\t$stateProvider.\r\n\t\t\tstate('dashboard', {\r\n\t\t\t\turl: '/',\r\n\t\t\t\ttemplateUrl: 'app/dashboard/dashboard.html',\r\n\t\t\t\tcontroller: 'DashboardController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('setup', {\r\n\t\t\t\turl: '/setup',\r\n\t\t\t\ttemplateUrl: 'app/settings/setup.html',\r\n\t\t\t\tcontroller: 'SetupController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('profile', {\r\n\t\t\t\turl: '/profile',\r\n\t\t\t\ttemplateUrl: 'app/settings/profile.html',\r\n\t\t\t\tcontroller: 'ProfileController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('invoices', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/invoices',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('invoices.list', {\r\n\t\t\t\turl: '/list?view',\r\n\t\t\t\ttemplateUrl: 'app/invoices/invoice-list.html',\r\n\t\t\t\tcontroller: 'InvoiceListController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('user', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/user',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('user.list', {\r\n\t\t\t\turl: '/list',\r\n\t\t\t\ttemplateUrl: 'app/user/user-list.html',\r\n\t\t\t\tcontroller: 'UserListController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('budgets', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/budgets',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('budgets.list', {\r\n\t\t\t\turl: '/budgets',\r\n\t\t\t\ttemplateUrl: 'app/budgets/budget-list.html',\r\n\t\t\t\tcontroller: 'BudgetListController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('budgets.create', {\r\n\t\t\t\turl: '/new',\r\n\t\t\t\ttemplateUrl: 'app/budgets/budget-edit.html',\r\n\t\t\t\tcontroller: 'BudgetEditController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('budgets.edit', {\r\n\t\t\t\turl: '/:budgetId',\r\n\t\t\t\ttemplateUrl: 'app/budgets/budget-edit.html',\r\n\t\t\t\tcontroller: 'BudgetEditController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('standingorders', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/standingorders',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('standingorders.list', {\r\n\t\t\t\turl: '/list?view',\r\n\t\t\t\ttemplateUrl: 'app/standingorders/standingorder-list.html',\r\n\t\t\t\tcontroller: 'StandingOrderListController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('billings', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/billings',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('billings.processList', {\r\n\t\t\t\turl: '/processList',\r\n\t\t\t\ttemplateUrl: 'app/billings/billing-process-list.html',\r\n\t\t\t\tcontroller: 'BillingProcessListController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('billings.create', {\r\n\t\t\t\turl: '/create',\r\n\t\t\t\ttemplateUrl: 'app/billings/billing-create.html',\r\n\t\t\t\tcontroller: 'BillingCreateController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tsumToBePaid: null,\r\n\t\t\t\t\tuserContact: null,\r\n\t\t\t\t\tbillingListItem: null\r\n\t\t\t\t}\r\n\t\t\t}).\r\n\t\t\tstate('billings.details', {\r\n\t\t\t\turl: '/:billingId',\r\n\t\t\t\ttemplateUrl: 'app/billings/billing-details.html',\r\n\t\t\t\tcontroller: 'BillingDetailsController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('invoices.create', {\r\n\t\t\t\turl: '/new?transactionType&returnView&isStandingOrder',\r\n\t\t\t\ttemplateUrl: 'app/invoices/invoice-edit.html',\r\n\t\t\t\tcontroller: 'InvoiceEditController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('invoices.details', {\r\n\t\t\t\turl: '/:invoiceId?isStandingOrder&transactionType',\r\n\t\t\t\ttemplateUrl: 'app/invoices/invoice-edit.html',\r\n\t\t\t\tcontroller: 'InvoiceEditController',\r\n\t\t\t\tcontrollerAs: 'vm',\r\n\t\t\t\tparams: {\r\n\t\t\t\t\treturnView: null\r\n\t\t\t\t}\r\n\t\t\t}).\r\n\t\t\tstate('analysis', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/analysis',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('analysis.charts', {\r\n\t\t\t\turl: '/charts',\r\n\t\t\t\ttemplateUrl: 'app/analysis/analysis-chart.html',\r\n\t\t\t\tcontroller: 'AnalysisChartController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t}).\r\n\t\t\tstate('fileanalyses', {\r\n\t\t\t\tabstract: true,\r\n\t\t\t\turl: '/fileanalyses',\r\n\t\t\t\ttemplate: '<ui-view/>'\r\n\t\t\t}).\r\n\t\t\tstate('fileanalyses.upload', {\r\n\t\t\t\turl: '/upload',\r\n\t\t\t\ttemplateUrl: 'app/fileanalyses/fileanalyses-upload.html',\r\n\t\t\t\tcontroller: 'FileAnalysesController',\r\n\t\t\t\tcontrollerAs: 'vm'\r\n\t\t\t});\r\n\r\n\t\t$translateProvider.\r\n\t\t\tuseSanitizeValueStrategy('sanitize').\r\n\t\t\tuseStaticFilesLoader({\r\n\t\t\t\tprefix: 'i18n/locale-',\r\n\t\t\t\tsuffix: '.json'\r\n\t\t\t}).\r\n\t\t\tfallbackLanguage('de').\r\n\t\t\tpreferredLanguage(langCode);\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('AnalysisChartController', AnalysisChartController);\r\n\r\n    AnalysisChartController.$inject = ['$state','moment','SearchService','$stateParams','NotificationService', 'AnalysisService','InvoiceService','Chart','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction AnalysisChartController($state,moment,SearchService,$stateParams,NotificationService, AnalysisService,InvoiceService, Chart, _) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'AnalysisChartController';\r\n\r\n        vm.diagramViewOptions = [\r\n\t\t\t{name: 'Liniendiagramm', code: 'BAR' ,useAbsolutValues:false, isActive:true},\r\n\t\t\t{name: 'Tortendiagramm', code: 'PIE' , useAbsolutValues:true}\r\n        ];\r\n\r\n\t\tvm.diagramOptions = [\r\n\t\t\t{name: 'Kategorien', diagramType:'CATEGORY'},\r\n            {name: 'Trger', diagramType:'COST_PAYER'},\r\n            {name: 'Tagesvergleich', diagramType:'DAY'},\r\n            {name: 'Zahlungsempfnger', diagramType:'PAYMENT_RECIPIENTS'},\r\n            {name: 'Monatsvergleich', diagramType:'MONTH', isActive:true}\r\n\t\t];\r\n\r\n        vm.barChartOptions = {\r\n            // showAllTooltips: true,\r\n            // scales: {\r\n            //     xAxes: [{\r\n            //         ticks: {\r\n            //             suggestedMax: 30,\r\n            //             suggestedMin: 10,\r\n            //             maxTicksLimit: 20,\r\n            //             stepSize: 1\r\n            //         }\r\n            //     }]\r\n            // }\r\n        };\r\n\r\n        vm.pieChartOptions = {\r\n            showAllTooltips: true\r\n        };\r\n\r\n        Chart.pluginService.register({\r\n            beforeRender: function (chart) {\r\n                if (chart.config.options.showAllTooltips) {\r\n                    // create an array of tooltips\r\n                    // we can't use the chart tooltip because there is only one tooltip per chart\r\n                    chart.pluginTooltips = [];\r\n                    chart.config.data.datasets.forEach(function (dataset, i) {\r\n                        chart.getDatasetMeta(i).data.forEach(function (sector, j) {\r\n                            chart.pluginTooltips.push(new Chart.Tooltip({\r\n                                _chart: chart.chart,\r\n                                _chartInstance: chart,\r\n                                _data: chart.data,\r\n                                _options: chart.options.tooltips,\r\n                                _active: [sector]\r\n                            }, chart));\r\n                        });\r\n                    });\r\n\r\n                    // turn off normal tooltips\r\n                    chart.options.tooltips.enabled = false;\r\n                }\r\n            },\r\n            afterDraw: function (chart, easing) {\r\n                if (chart.config.options.showAllTooltips) {\r\n                    // we don't want the permanent tooltips to animate, so don't do anything till the animation runs atleast once\r\n                    if (!chart.allTooltipsOnce) {\r\n                        if (easing !== 1)\r\n                            return;\r\n                        chart.allTooltipsOnce = true;\r\n                    }\r\n\r\n                    // turn on tooltips\r\n                    chart.options.tooltips.enabled = true;\r\n                    Chart.helpers.each(chart.pluginTooltips, function (tooltip) {\r\n                        tooltip.initialize();\r\n                        tooltip._options.displayColors = false;\r\n                        tooltip._options.bodyFontSize = tooltip._chart.height*0.025;\r\n                        tooltip._options.yPadding = tooltip._options.bodyFontSize*0.10;\r\n                        tooltip._options.xPadding = tooltip._options.bodyFontSize*0.10;\r\n                        tooltip._options.caretSize = tooltip._options.bodyFontSize*0.3;\r\n                        tooltip._options.cornerRadius = tooltip._options.bodyFontSize*0.20;\r\n                        tooltip.update();\r\n                        // we don't actually need this since we are not animating tooltips\r\n                        tooltip.pivot();\r\n                        tooltip.transition(easing).draw();\r\n                    });\r\n                    chart.options.tooltips.enabled = false;\r\n                }\r\n            }\r\n        });\r\n\r\n        vm.selectedMonth = null;\r\n        vm.monthRanges = [];\r\n        vm.showAfterButton = true;\r\n        vm.showBeforeButton = true;\r\n\r\n        vm.isSearchFiringActivated = true;\r\n\r\n        vm.diagramType = vm.diagramOptions[4];\r\n        vm.diagramViewType = vm.diagramViewOptions[0];\r\n\r\n\t\tvm.startSearch = function(){\r\n\t\t    if (vm.isSearchFiringActivated){\r\n                updateChartData();\r\n            }\r\n\t\t};\r\n\r\n\t\tvm.setChartType = function(diagramType){\r\n            vm.diagramOptions.forEach(function(item){\r\n               item.isActive = false;\r\n            });\r\n            vm.diagramType = diagramType;\r\n            vm.diagramType.isActive = true;\r\n            updateChartData();\r\n\t\t};\r\n        \r\n        vm.statisticData = function(basicDataSubType){\r\n            var tmpValue = AnalysisService.getStatisticData(basicDataSubType);\r\n\r\n            if (tmpValue != undefined){\r\n                return tmpValue.numberValue;\r\n            }else{\r\n                return \"Keine Angabe\";\r\n            }\r\n\r\n        };\r\n\r\n        vm.setChartViewType = function(diagramViewType){\r\n            vm.diagramViewOptions.forEach(function(item){\r\n                item.isActive = false;\r\n            });\r\n            vm.diagramViewType = diagramViewType;\r\n            vm.diagramViewType.isActive = true;\r\n            updateChartData();\r\n        };\r\n\r\n        vm.chartServiceLoading = function(){\r\n            return AnalysisService.isLoading();\r\n        };\r\n\r\n        vm.transferSelectionToSearch = function(){\r\n            if (vm.selectedMonth == undefined || vm.selectedMonth == null || vm.selectedMonth === ''){\r\n                SearchService.getSearchConfiguration().startDate = null;\r\n                SearchService.getSearchConfiguration().endDate = null;\r\n            }else{\r\n                var monthSelected = _.findWhere(vm.monthRanges, {monthNumber: parseInt(vm.selectedMonth)});\r\n                SearchService.getSearchConfiguration().startDate = monthSelected.startMonth;\r\n                SearchService.getSearchConfiguration().endDate = monthSelected.endMonth;\r\n\r\n                if (monthSelected.monthNumber == 6){\r\n                    vm.showAfterButton = true;\r\n                    vm.showBeforeButton = false;\r\n                }else if (monthSelected.monthNumber == 0) {\r\n                    vm.showAfterButton = false;\r\n                    vm.showBeforeButton = true;\r\n                }else{\r\n                    vm.showAfterButton = true;\r\n                    vm.showBeforeButton = true;\r\n                }\r\n            }\r\n\r\n            updateChartData();\r\n        };\r\n\r\n        vm.monthBefore = function(){\r\n            var currentMonthNumber = parseInt(vm.selectedMonth);\r\n            currentMonthNumber = currentMonthNumber + 1;\r\n\r\n            if (currentMonthNumber == 6){\r\n                vm.showAfterButton = true;\r\n                vm.showBeforeButton = false;\r\n            }else{\r\n                vm.showAfterButton = true;\r\n                vm.showBeforeButton = true;\r\n            }\r\n\r\n            vm.selectedMonth = currentMonthNumber.toString();\r\n            vm.transferSelectionToSearch();\r\n        };\r\n\r\n        vm.monthAfter = function(){\r\n            var currentMonthNumber = parseInt(vm.selectedMonth);\r\n            currentMonthNumber = currentMonthNumber - 1;\r\n\r\n            if (currentMonthNumber == 0){\r\n                vm.showAfterButton = false;\r\n                vm.showBeforeButton = true;\r\n            }else{\r\n                vm.showAfterButton = true;\r\n                vm.showBeforeButton = true;\r\n            }\r\n\r\n            vm.selectedMonth = currentMonthNumber.toString();\r\n            vm.transferSelectionToSearch();\r\n        };\r\n\r\n        activate();\r\n\r\n        ////////////////\r\n\r\n        function activate() {\r\n\r\n        \tvar chartData = AnalysisService.getChartData();\r\n        \tif (chartData && chartData.length > 0 ){\r\n        \t\trefreshChart();\r\n\t\t\t}\r\n\r\n            updateChartData();\r\n            generateMonthRanges();\r\n        }\r\n\r\n        function updateChartData() {\r\n            if (vm.isSearchFiringActivated){\r\n                vm.isSearchFiringActivated = false;\r\n                AnalysisService.updateChartData(vm.diagramViewType.useAbsolutValues, vm.diagramType.diagramType).then(function(response){\r\n                    refreshChart();\r\n                    vm.isSearchFiringActivated = true;\r\n                }, function(response2){\r\n                    vm.isSearchFiringActivated = true;\r\n                });\r\n            }\r\n        }\r\n\r\n        function refreshChart(){\r\n            var chartData = AnalysisService.getChartData();\r\n            if (chartData){\r\n                vm.labels = chartData.xaxesValues;\r\n                vm.chartData = [];\r\n                vm.chartData.push(chartData.yaxesValues);\r\n            }\r\n\t\t}\r\n\r\n        function generateMonthRanges(){\r\n            var monthNames = ['Januar', 'Februar', 'Mrz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];\r\n            for (var i = 0; i < 7; i++) {\r\n                var currentDate = new moment();\r\n                currentDate = currentDate.subtract(i, 'months');\r\n                var currentDate2 = new moment();\r\n                currentDate2 = currentDate2.subtract(i, 'months');\r\n\r\n                var monthRange = {\r\n                    startMonth: currentDate.startOf('month').toDate().getTime(),\r\n                    endMonth: currentDate2.endOf('month').toDate().getTime(),\r\n                    monthName: monthNames[currentDate.month()] + ' ' + currentDate.year(),\r\n                    monthNumber: i\r\n                };\r\n\r\n                vm.monthRanges.push(monthRange);\r\n            }\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('AnalysisService', AnalysisService);\r\n\r\n    AnalysisService.$inject = ['$http','$q', 'NotificationService','SearchService','InvoiceService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction AnalysisService($http, $q, NotificationService, SearchService, InvoiceService, _) {\r\n\t\tvar base = {\r\n                chartsWithFilter: '/webapp/api/charts/withFilterBean',\r\n\t\t\t\tstatistics: '/webapp/api/statistics'\r\n\t\t\t},\r\n\t\t\tstatistics = [],\r\n\t\t\tchartData = [],\r\n\t\t\tisLoadingValue = false,\r\n\t\t\tservice = {\r\n                updateChartData: updateChartData,\r\n                getChartData: getChartData,\r\n\t\t\t\tisLoading: isLoading,\r\n\t\t\t\tsetIsLoading: setIsLoading,\r\n\t\t\t\tgetStatisticData: getStatisticData\r\n\t\t\t};\r\n\r\n\t\tactivate();\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction activate(){\r\n\t\t\tgetStatistics();\r\n\t\t}\r\n\r\n\t\tfunction getStatisticData(basicDataSubType){\r\n\t\t\tvar indexOfPosition = statistics.findIndex(function(item){\r\n\t\t\t\treturn item.basicDataSubType === basicDataSubType;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn statistics[indexOfPosition];\r\n\t\t}\r\n\r\n\t\tfunction isLoading() {\r\n\t\t\treturn isLoadingValue;\r\n\t\t}\r\n\r\n\t\tfunction setIsLoading(isLoadingValueTmp) {\r\n\t\t\tisLoadingValue = isLoadingValueTmp;\r\n\t\t}\r\n\r\n\t\tfunction updateChartData(useAbsolutValuesTmp, chartTypeTmp) {\r\n\t\t\tvar searchConfiguration = SearchService.getSearchConfiguration();\r\n\r\n            // if (SearchService.isSearchConfigurationDefaultOne()){\r\n\t\t\t    InvoiceService.clearCurrentPageReadyList();\r\n\t\t\t    InvoiceService.clearCurrentPageCheckList();\r\n                InvoiceService.setSearchMode(false);\r\n                InvoiceService.allInvoices();\r\n            // }else{\r\n            //     InvoiceService.clearCurrentPageReadyList();\r\n            //     InvoiceService.clearCurrentPageCheckList();\r\n            //     InvoiceService.setSearchMode(true);\r\n            //     // SearchService.search();\r\n\t\t\t\t// InvoiceService.allInvoices();\r\n            // }\r\n\r\n            var tmpSearchConfiguration = angular.copy(searchConfiguration);\r\n            tmpSearchConfiguration.standingOrder = false;\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\tisLoadingValue = true;\r\n\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: tmpSearchConfiguration,\r\n                    params: {\r\n                        useAbsolutValues: useAbsolutValuesTmp,\r\n                        chartType: chartTypeTmp\r\n                    },\r\n\t\t\t\t\turl: base.chartsWithFilter\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\tchartData = result.data;\r\n\t\t\t\t\t\tisLoadingValue = false;\r\n\r\n\t\t\t\t\t\tresolve(chartData);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\t$log.warn('Could not get chart data!', 'result', result);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getStatistics() {\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: base.statistics\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\tstatistics = result.data;\r\n\r\n\t\t\t\t\t\tresolve(statistics);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\t$log.warn('Could not get statistic data!', 'result', result);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getChartData(){\r\n\t\t\treturn chartData;\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('BillingCreateController', BillingCreateController);\r\n\r\n    BillingCreateController.$inject = ['$state','$stateParams','BillingService','SettingsService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BillingCreateController($state,$stateParams,BillingService,SettingsService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'BillingCreateController';\r\n\r\n        vm.switched = false;\r\n\r\n        vm.smtpMailServiceEnabled = false;\r\n\r\n        vm.toggleSwitch = function(){\r\n            vm.switched = !vm.switched;\r\n        };\r\n\r\n        if ($stateParams.userContact) {\r\n            vm.userContact = $stateParams.userContact;\r\n        }else{\r\n            $state.go('billings.processList');\r\n        }\r\n\r\n        vm.returnViewObject = {\r\n            view: 'billings.processList'\r\n        };\r\n\r\n        vm.billingConfig = {\r\n            costPayerMail: vm.userContact.email\r\n        };\r\n\r\n        if ($stateParams.sumToBePaid) {\r\n            vm.sumToBePaid = $stateParams.sumToBePaid;\r\n        }\r\n\r\n        if ($stateParams.billingListItem) {\r\n            vm.billingListItem = $stateParams.billingListItem;\r\n        }\r\n\r\n        vm.getCategoriesForInvoicePayer = function(billing){\r\n            vm.categoriesInvoicePayer = _.map(billing.invoiceCategoriesOfInvoicePayer, function(category){ return category.invoiceCategoryName; }).join(', ');\r\n            return vm.categoriesInvoicePayer;\r\n        };\r\n\r\n        vm.getCategoriesForCostPayer = function(billing){\r\n            vm.categoriesCostPayer = _.map(billing.invoiceCategoriesOfCostPayer, function(category){ return category.invoiceCategoryName; }).join(', ');\r\n            return vm.categoriesCostPayer;\r\n        };\r\n\r\n        vm.createBilling = function(){\r\n\r\n\t\t\tvm.billingConfig.startDate = null;\r\n\t\t\tvm.billingConfig.endDate = null;\r\n\r\n\t\t\tvm.billingConfig.userSelectionPaymentPersonTypeEnum= vm.userContact.paymentPersonTypeEnum;\r\n\t\t\tvm.billingConfig.userSelection = vm.userContact.paymentPersonId;\r\n\r\n\t\t\tif (vm.billingConfig.sendMailInvoicePayer == undefined || vm.billingConfig.sendMailInvoicePayer == null){\r\n                vm.billingConfig.sendMailInvoicePayer = false;\r\n\t\t\t}\r\n            if (vm.billingConfig.sendMailCostPayer == undefined || vm.billingConfig.sendMailCostPayer == null){\r\n                vm.billingConfig.sendMailCostPayer = false;\r\n            }\r\n\r\n            vm.lockBillingButton = true;\r\n            \r\n            BillingService.createBilling(vm.billingConfig).then(function(result){\r\n                $state.go('billings.processList')\r\n            });\r\n\r\n\r\n\r\n        };\r\n\r\n        activate();\r\n\r\n        function activate() {\r\n            SettingsService.get().then(function(response){\r\n                vm.smtpMailServiceEnabled = response.data.smtpMailServiceEnabled;\r\n\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('BillingDetailsController', BillingDetailsController);\r\n\r\n    BillingDetailsController.$inject = ['$state','$stateParams','BillingService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BillingDetailsController($state,$stateParams,BillingService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'BillingCreateController';\r\n\r\n        vm.selected = [];\r\n        \r\n        vm.billing = {};\r\n        \r\n        vm.switched = false;\r\n\r\n        if ($stateParams.billingId) {\r\n            vm.billing.billingId = $stateParams.billingId;\r\n        }else{\r\n            $state.go('billings.processList');\r\n        }\r\n\r\n        vm.returnViewObject = {\r\n            view: 'billings.details',\r\n            params: {\r\n                billingId: vm.billing.billingId\r\n            }\r\n        };\r\n        \r\n        vm.toggleSwitch = function(){\r\n          vm.switched = !vm.switched;  \r\n        };\r\n\r\n        vm.returnSumPaidSum = function(){\r\n\t\t\treturn vm.billing.sumPaid;\r\n        };\r\n\r\n        vm.archiveBilling = function(){\r\n            BillingService.archiveBilling(vm.billing.billingId).then(function(result){\r\n\t\t\t\tleaveState();\r\n            });\r\n        };\r\n\r\n        vm.firstAction = function(){\r\n            BillingService.billingUpdate(vm.billing.billingId, vm.billing.messageType).then(function(result){\r\n                getBilling();\r\n            });\r\n        };\r\n\r\n        vm.secondAction = function(){\r\n            BillingService.billingDelete(vm.billing.billingId).then(function(result){\r\n\t\t\t\tleaveState();\r\n            });\r\n        };\r\n\r\n        vm.getBillingReportUrl = function(){\r\n            return BillingService.billingReportUrl(vm.billing.billingId);\r\n        };\r\n        \r\n        vm.billingServiceLoading = function(){\r\n            return BillingService.isLoading();\r\n        };\r\n\r\n        vm.createCompensation = function(){\r\n            BillingService.createCompensation(vm.billing.billingId).then(\r\n                function(result){\r\n                    var params = {\r\n                        invoiceId: result.invoiceId\r\n                    };\r\n                    params.returnView = vm.returnViewObject;\r\n    \r\n                    $state.go('invoices.details', params);\r\n                }\r\n            )\r\n        };\r\n\r\n        vm.executeEquality = function(){\r\n            BillingService.executeEquality(vm.billing.billingId).then(function(result){\r\n                vm.billing = result;\r\n            });\r\n        };\r\n\r\n        activate();\r\n\r\n        ////////////////\r\n\r\n\t\tfunction leaveState() {\r\n\t\t\t$state.go('^.processList');\r\n\t\t}\r\n\r\n        function activate() {\r\n            getBilling();\r\n        }\r\n        \r\n        function getBilling() {\r\n            BillingService.getBilling(vm.billing.billingId).then(function(result){\r\n                vm.billing = result;\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('BillingProcessListController', BillingProcessListController);\r\n\r\n\tBillingProcessListController.$inject = ['$state','BillingService', 'UserService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BillingProcessListController($state,BillingService, UserService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'BillingProcessListController';\r\n\t\tvm.useArchived = false;\r\n\r\n\t\tvm.getGroupedBillingListItems = function(){\r\n\t\t\tvar groupedBillingListItems = BillingService.getBillingProcesses();\r\n\t\t\treturn groupedBillingListItems;\r\n\t\t};\r\n\r\n\t\tvm.getBillingListProcessItems = function(groupedBillingListItem){\r\n\t\t\tvar billingListProcessItems = groupedBillingListItem.billingListProcessItemDTOs;\r\n\t\t\treturn billingListProcessItems;\r\n\t\t};\r\n\r\n\t\tvm.checkReminderMessage = function(appUserId){\r\n\t\t\tBillingService.checkReminderMessage(appUserId);\r\n\t\t};\r\n\r\n\t\tvm.refreshArchived = function(){\r\n\t\t\tBillingService.setUseArchived(vm.useArchived);\r\n\t\t};\r\n\r\n\t\tvm.createBilling = function(billingListItem){\r\n\r\n\t\t\tvar paramsTransfer = {\r\n\t\t\t\tsumToBePaid: billingListItem.sumToBePaid,\r\n\t\t\t\tbillingListItem: billingListItem\r\n\t\t\t};\r\n\r\n\t\t\tUserService.currentUser().then(function(result){\r\n\t\t\t\tvar currentuser = result;\r\n\t\t\t\t\r\n\t\t\t\tif (billingListItem.invoicePayer.paymentPersonEnum === 'CONTACT'){\r\n\r\n\t\t\t\t\tvar foundCostDistribution = _.filter(currentuser.userContactDTOs, function(userContactDTO){ return (userContactDTO.userContactId === billingListItem.invoicePayer.payerId);});\r\n\t\t\t\t\tif (foundCostDistribution != null && foundCostDistribution != undefined && foundCostDistribution.length > 0){\r\n\t\t\t\t\t\tparamsTransfer.userContact = billingListItem.costPayer;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tparamsTransfer.userContact = billingListItem.invoicePayer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tparamsTransfer.userContact = billingListItem.costPayer;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$state.go('billings.create', paramsTransfer);\r\n\t\t\t});\r\n\t\t\t\r\n\r\n\t\t};\r\n\r\n\t\tvm.showCanBeCompensatedWarning = function(billingProcess){\r\n\t\t\treturn (billingProcess.sumToPay !== billingProcess.sumPaid &&\r\n\t\t\t(billingProcess.messageType === 'PAID' || billingProcess.messageType === 'PAYMENT_CONFIRMED' || billingProcess.messageType === 'FINISHED' || billingProcess.messageType === 'ARCHIVED'));\r\n\t\t};\r\n\t\t\r\n\t\tvm.showBillingPaidPart = function(groupedBillingListItem){\r\n\t\t\treturn (groupedBillingListItem.billingListItemDTO && (groupedBillingListItem.billingListItemDTO.sumToBePaid && groupedBillingListItem.billingListItemDTO.sumToBePaid !== 0));\r\n\t\t};\r\n\r\n\t\tvm.showSumToBeChecked = function(billingListItemDTO){\r\n            return (billingListItemDTO && (billingListItemDTO.sumToBeChecked && billingListItemDTO.sumToBeChecked >= 0));\r\n\t\t};\r\n\r\n\t\tvm.goToDetails = function(billingListItem){\r\n\t\t\tvar paramsTransfer = {\r\n\t\t\t\tbillingId: billingListItem.billingId\r\n\t\t\t};\r\n\r\n\t\t\t$state.go('billings.details', paramsTransfer)\r\n\t\t};\r\n\r\n        vm.billingServiceLoading = function(){\r\n            return BillingService.isLoading();\r\n        };\r\n\r\n\t\tvm.getBillingReportUrl = function(billingProcess){\r\n\t\t\treturn BillingService.billingReportUrl(billingProcess.billingId);\r\n\t\t};\r\n\r\n\t\tvm.archiveBilling = function(billingListProcessItem){\r\n\t\t\tBillingService.archiveBilling(billingListProcessItem.billingId);\r\n\t\t};\r\n\r\n\t\tvm.firstAction = function(billingListProcessItem){\r\n\t\t\tBillingService.billingUpdate(billingListProcessItem.billingId, billingListProcessItem.messageType);\r\n\t\t};\r\n\r\n\t\tvm.secondAction = function(billingListProcessItem){\r\n\t\t\tBillingService.billingDelete(billingListProcessItem.billingId);\r\n\t\t};\r\n\r\n\t\tvm.listBillingProcesses = function(){\r\n            BillingService.listBillingProcesses(vm.useArchived);\r\n\t\t};\r\n\r\n\t\tactivate();\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction activate() {\r\n            BillingService.listBillingProcesses(false);\r\n            vm.useArchived = BillingService.getUseArchived();\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('BillingService', BillingService);\r\n\r\n    BillingService.$inject = ['$http','$q','NotificationService', 'MessageService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BillingService($http, $q,NotificationService,MessageService, _) {\r\n\t\tvar base = {\r\n\t\t\t\tcreateBilling: '/webapp/api/billings/payment',\r\n                billingUdate: '/webapp/api/billings/{billingId}/payment',\r\n                billingDelete: '/webapp/api/billings/{billingId}',\r\n                billing: '/webapp/api/billings/{billingId}',\r\n                billingProcesses: '/webapp/api/billings/billingListItems/grouped',\r\n                billingReport: '/webapp/api/billings/{billingId}/downloadReport/Kostenuebersicht.pdf',\r\n                archive : '/webapp/api/billings/{billingId}/archive',\r\n                checkReminderMessage : '/webapp/api/billings/checkReminderMessage/{appUserId}',\r\n                createCompensation : '/webapp/api/billings/{billingId}/createCompensation',\r\n                executeEquality: '/webapp/api/billings/{billingId}/executeEquality'\r\n\t\t\t},\r\n            billingProcessList = [],\r\n\t\t\tbillingList = [],\r\n            isLoadingValue = false,\r\n            useArchived = false,\r\n\t\t\tservice = {\r\n                getBillings: getBillings,\r\n                getBilling: getBilling,\r\n                createBilling: createBilling,\r\n                billingUpdate: billingUpdate,\r\n                billingDelete: billingDelete,\r\n                isLoading: isLoading,\r\n                setIsLoading: setIsLoading,\r\n                getUseArchived: getUseArchived,\r\n                setUseArchived: setUseArchived,\r\n                getBillingProcesses: getBillingProcesses,\r\n                listBillingProcesses: listBillingProcesses,\r\n                billingReportUrl: billingReportUrl,\r\n                archiveBilling: archiveBilling,\r\n                checkReminderMessage: checkReminderMessage,\r\n                createCompensation: createCompensation,\r\n                executeEquality: executeEquality\r\n\t\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n        function getBillingProcesses(){\r\n            return billingProcessList;\r\n        }\r\n\r\n        function listBillingProcesses(){\r\n\r\n            var urlExtended = useArchived ? '?archived=true' : '';\r\n\r\n            isLoadingValue = true;\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'GET',\r\n                    url: base.billingProcesses + urlExtended\r\n                }).then(\r\n                    function(result) {\r\n                        billingProcessList = result.data;\r\n                        isLoadingValue = false;\r\n                        resolve(billingProcessList);\r\n                    },\r\n                    function(result) {\r\n                        isLoadingValue = false;\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function isLoading() {\r\n            return isLoadingValue;\r\n        }\r\n\r\n        function setIsLoading(isLoadingValueTmp) {\r\n            isLoadingValue = isLoadingValueTmp;\r\n        }\r\n\r\n        function getUseArchived() {\r\n            return useArchived;\r\n        }\r\n\r\n        function setUseArchived(useArchivedTmp) {\r\n            useArchived = useArchivedTmp;\r\n        }\r\n\r\n        function getBillings() {\r\n            return billingList;\r\n        }\r\n\r\n        function getBilling(billingId) {\r\n            isLoadingValue = true;\r\n\r\n            var url = base.billing.replace('{billingId}',billingId);\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'GET',\r\n                    url: url\r\n                }).then(\r\n                    function(result) {\r\n                        resolve(result.data);\r\n                        isLoadingValue = false;\r\n                    },\r\n                    function(result) {\r\n                        isLoadingValue = false;\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function createBilling(reportConfig) {\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: base.createBilling,\r\n                    data: reportConfig,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Abrechnung wurde erstellt!',5000);\r\n\r\n                        MessageService.list();\r\n                        listBillingProcesses();\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function executeEquality(billingId){\r\n\r\n            var url = base.executeEquality\r\n                .replace('{billingId}',billingId);\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: url,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Summen wurden gleichgesetzt!',5000);\r\n\r\n                        MessageService.list();\r\n                        listBillingProcesses();\r\n                        resolve(result.data);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function checkReminderMessage(appUserId) {\r\n\r\n            var url = base.checkReminderMessage\r\n                .replace('{appUserId}',appUserId);\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: url\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Nachricht wurde verschickt!',5000);\r\n\r\n                        MessageService.list();\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function createCompensation(billingId) {\r\n\r\n            var url = base.createCompensation\r\n                .replace('{billingId}',billingId);\r\n\r\n            return $q(function(resolve, reject) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: url\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        MessageService.list();\r\n                        NotificationService.create('Ausbalancierende Rechnung wurde gespeichert und kann noch bearbeitet werden!',8000);\r\n                        resolve(result.data);\r\n                    }, function(resultError){\r\n\r\n                        NotificationService.create('Ausbalancierende Rechnung konnte nicht erstellt werden!',5000);\r\n                        reject(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function archiveBilling(billingId) {\r\n\r\n            var url = base.archive\r\n                .replace('{billingId}',billingId);\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: url\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Abrechnung wurde archiviert!',5000);\r\n\r\n                        MessageService.list();\r\n                        listBillingProcesses();\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function billingUpdate(billingId, messageType){\r\n\r\n            var  billingPaymentBean = {};\r\n            billingPaymentBean.billingId = billingId;\r\n            if (messageType === 'TO_PAY'){\r\n                billingPaymentBean.billingStatusEnum = 'PAID';\r\n            }else if (messageType === 'PAID' || messageType === 'WAIT_FOR_PAYMENT'){\r\n                billingPaymentBean.billingStatusEnum = 'PAYMENT_CONFIRMED';\r\n            }else if (messageType === 'PAYMENT_CONFIRMED'){\r\n                billingPaymentBean.billingStatusEnum = 'FINISHED';\r\n            }\r\n\r\n            var url = base.billingUdate\r\n                .replace('{billingId}',billingId);\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'POST',\r\n                    url: url,\r\n                    data: billingPaymentBean,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                }).then(\r\n                    function(result) {\r\n                        listBillingProcesses().then(function(result3){\r\n                            NotificationService.create('Workflow-Status wurde gesetzt!',5000);\r\n                        });\r\n\r\n                        MessageService.list().then(function(result2){\r\n                            resolve(result2);\r\n                        });\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function billingReportUrl(billingId){\r\n            var url = base.billingReport.replace('{billingId}',billingId);\r\n            return url;\r\n        }\r\n\r\n        function billingDelete(object1Id){\r\n\r\n            var url = base.billingDelete\r\n                .replace('{billingId}',object1Id);\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'DELETE',\r\n                    url: url\r\n                }).then(\r\n                    function(result) {\r\n                        listBillingProcesses().then(function(result3){\r\n                            NotificationService.create('Abrechnung wurde gelscht!',5000);\r\n                        });\r\n\r\n                        MessageService.list().then(function(result2){\r\n                            resolve(result2);\r\n                        });\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('BudgetEditController', BudgetEditController);\r\n\r\n\tBudgetEditController.$inject = ['$timeout','$filter','$log','csrfToken', '$state','$stateParams','$scope','BudgetService','InvoiceService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BudgetEditController($timeout,$filter,$log,csrfToken,$state,$stateParams,$scope,BudgetService,InvoiceService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'BudgetEditController';\r\n\r\n\t\tvm.budget = {};\r\n\t\tvm.createMode = false;\r\n\r\n\t\tif ($stateParams.budgetId) {\r\n\t\t\tvm.budget.budgetId = $stateParams.budgetId;\r\n\t\t}else{\r\n\t\t\tvm.createMode = true;\r\n\t\t}\r\n\t\t\r\n\t\tvm.paymentTypeEnums = [];\r\n\t\tvm.budgetRepetionTypeEnums = [];\r\n\r\n\t\tvm.submitForm = function() {\r\n\r\n\t\t\tvm.budget.paymentTypeEnum = vm.budget.paymentTypeEnum !== '' && vm.budget.paymentTypeEnum !== undefined ? vm.budget.paymentTypeEnum : null;\r\n\r\n\t\t\tif (vm.createMode) {\r\n\t\t\t\tcreateBudget();\r\n\t\t\t} else {\r\n\t\t\t\tupdateBudget();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.getDialogId = function(customIdentifier){\r\n\t\t\tvar resultId = '#';\r\n\t\t\tif (customIdentifier != undefined){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.getDialogIdWithoutHash = function(customIdentifier){\r\n\t\t\tvar resultId = customIdentifier;\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvar goToOverview = function () {\r\n\t\t\t$state.go('budgets.list');\r\n\t\t};\r\n\r\n\t\tvm.removePersonFromList = function(payerDtoInput) {\r\n\t\t\tvar indexOfPosition = vm.budget.payerDTOS.findIndex(function (payerDTO) {\r\n\t\t\t\treturn payerDTO.id === payerDtoInput.id;\r\n\t\t\t});\r\n\r\n\t\t\tvm.budget.payerDTOS.splice(indexOfPosition, 1);\r\n\t\t};\r\n\r\n\t\tvm.removeCategoryFromList = function(categoryDtoInput) {\r\n\t\t\tvar indexOfPosition = vm.budget.invoiceCategoryDTOS.findIndex(function (categoryDTO) {\r\n\t\t\t\treturn categoryDTO.id === categoryDtoInput.id;\r\n\t\t\t});\r\n\r\n\t\t\tvm.budget.invoiceCategoryDTOS.splice(indexOfPosition, 1);\r\n\t\t};\r\n\r\n\t\tvm.addPersonToList = function (payer){\r\n\t\t\tvar budgetRecipient = {\r\n\t\t\t\t'id': payer.id,\r\n\t\t\t\t'displayName':payer.name,\r\n\t\t\t\t'paymentPersonTypeEnum':payer.type\r\n\t\t\t};\r\n\r\n\t\t\tvm.budget.payerDTOS.push(budgetRecipient);\r\n\t\t};\r\n\r\n\t\tvm.addCategoryToList = function (category){\r\n\t\t\tvm.budget.invoiceCategoryDTOS.push(category);\r\n\t\t};\r\n\r\n        vm.removeBudget = function() {\r\n            BudgetService.deleteBudget(vm.budget.budgetId).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tgoToOverview();\r\n\t\t\t\t}\r\n\t\t\t);\r\n        };\r\n\r\n        vm.deleteConfirmationMenu = [\r\n            ['Lchen besttigen', function ($itemScope, $event, color) {\r\n                vm.removeBudget();\r\n            }]\r\n        ];\r\n\r\n\t\tactivate();\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction generateUUID(){\r\n\t\t\tfunction s4() {\r\n\t\t\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t\t\t.toString(16)\r\n\t\t\t\t\t.substring(1);\r\n\t\t\t}\r\n\t\t\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n\t\t\t\ts4() + '-' + s4() + s4() + s4();\r\n\t\t}\r\n\r\n\t\tfunction getPaymentTypeEnums() {\r\n\t\t\tInvoiceService.paymentTypeEnumList().then(function(result) {\r\n\t\t\t\tvm.paymentTypeEnums = result.data;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getBudgetRepetitionTypeEnums() {\r\n\t\t\tBudgetService.budgetRepetitionTypeEnumList().then(function(result) {\r\n\t\t\t\tvm.budgetRepetionTypeEnums = result.data;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getBudget() {\r\n\t\t\tBudgetService.details(vm.budget.budgetId).then(function(response) {\r\n\t\t\t\tvm.budget = response.data;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction activate() {\r\n\r\n\t\t\tgetPaymentTypeEnums();\r\n\t\t\tgetBudgetRepetitionTypeEnums();\r\n\r\n\t\t\tif (vm.budget.budgetId) {\r\n\t\t\t\tgetBudget();\r\n\t\t\t}else{\r\n\t\t\t\tvar today = new Date();\r\n\t\t\t\tvm.budget.budgetId = generateUUID();\r\n\t\t\t\tvm.budget.payerDTOS = [];\r\n\t\t\t\tvm.budget.budgetRepetitionType = 'MONTH';\r\n\t\t\t\tvm.budget.invoiceCategoryDTOS = [];\r\n\t\t\t\tvm.budget.sum = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction createBudget() {\r\n\t\t\tBudgetService.createBudget(vm.budget).then(function(result){\r\n\t\t\t\tgoToOverview();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction updateBudget() {\r\n\t\t\tBudgetService.updateBudget(vm.budget.budgetId, vm.budget).then(function(result){\r\n\t\t\t\tgoToOverview();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('BudgetListController', BudgetListController);\r\n\r\n\tBudgetListController.$inject = ['$state','BudgetService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BudgetListController($state,BudgetService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'BudgetListController';\r\n\t\tvm.useArchived = false;\r\n\t\tvm.budgets = [];\r\n\r\n\t\tvm.newBudget = function(){\r\n\t\t\t$state.go('budgets.create');\r\n\t\t};\r\n\r\n        vm.budgetServiceLoading = function(){\r\n            return BudgetService.isLoading();\r\n        };\r\n\r\n\t\tvm.deleteBudget = function(budgetId){\r\n\t\t\tBudgetService.deleteBudget(budgetId);\r\n\t\t};\r\n\r\n\t\tvm.goToDetails = function(budgetId){\r\n\t\t\tvar paramsTransfer = {\r\n\t\t\t\tbudgetId: budgetId\r\n\t\t\t};\r\n\r\n\t\t\t$state.go('budgets.edit', paramsTransfer)\r\n\t\t};\r\n\r\n\t\tvm.displayNameForBudgetType = function(budgetType){\r\n\t\t\tvm.displayNames = {\r\n\t\t\t\t'WEEK': 'Woche',\r\n\t\t\t\t'MONTH': 'Monat'\r\n\t\t\t};\r\n\r\n\t\t\treturn vm.displayNames[budgetType];\r\n\t\t};\r\n\r\n\t\tactivate();\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction activate() {\r\n            BudgetService.listBudgets().then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.budgets = result;\r\n\t\t\t\t},\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.budgets = []\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('BudgetService', BudgetService);\r\n\r\n    BudgetService.$inject = ['$http','$q','NotificationService', 'MessageService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BudgetService($http, $q,NotificationService,MessageService, _) {\r\n\t\tvar base = {\r\n\t\t\t\tbudgets: '/webapp/api/budgets',\r\n\t\t\t\tcreateBudget: '/webapp/api/budgets',\r\n                budgetUdate: '/webapp/api/budgets/{budgetId}',\r\n                budgetDelete: '/webapp/api/budgets/{budgetId}'\r\n\t\t\t},\r\n\t\t\tbudgetList = [],\r\n            isLoadingValue = false,\r\n\t\t\tservice = {\r\n                listBudgets: listBudgets,\r\n                getBudgets: getBudgets,\r\n                details: details,\r\n                createBudget: createBudget,\r\n                updateBudget: updateBudget,\r\n                deleteBudget: deleteBudget,\r\n                isLoading: isLoading,\r\n                setIsLoading: setIsLoading,\r\n                budgetRepetitionTypeEnumList: budgetRepetitionTypeEnumList\r\n\t\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n        function isLoading() {\r\n            return isLoadingValue;\r\n        }\r\n\r\n        function setIsLoading(isLoadingValueTmp) {\r\n            isLoadingValue = isLoadingValueTmp;\r\n        }\r\n\r\n        function budgetRepetitionTypeEnumList() {\r\n            return $http({\r\n                method: 'GET',\r\n                url: base.budgets + \"/budgetRepetitionTypeEnums\"\r\n            });\r\n        }\r\n\r\n        function details(budgetId) {\r\n            return $http({\r\n                method: 'GET',\r\n                url: base.budgets + '/' + budgetId\r\n            });\r\n        }\r\n\r\n        function getBudgets() {\r\n            return budgetList;\r\n        }\r\n\r\n\t\tfunction listBudgets() {\r\n            isLoadingValue = true;\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'GET',\r\n                    url: base.budgets\r\n                }).then(\r\n                    function(result) {\r\n                        budgetList = result.data;\r\n                        isLoadingValue = false;\r\n                        resolve(budgetList);\r\n                    },\r\n                    function(result) {\r\n                        isLoadingValue = false;\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n\t\t}\r\n\r\n        function createBudget(budget) {\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: base.createBudget,\r\n                    data: budget,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Budget wurde erstellt!',5000);\r\n\r\n                        MessageService.list();\r\n                        listBudgets();\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function updateBudget(budgetId, budget){\r\n\r\n            var url = base.budgetUdate\r\n                .replace('{budgetId}',budgetId);\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'PUT',\r\n                    url: url,\r\n                    data: budget,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                }).then(\r\n                    function(result) {\r\n                        MessageService.list();\r\n                        listBudgets().then(function(result3){\r\n                            NotificationService.create('Budget aktualisiert!',5000);\r\n                            resolve(result.data);\r\n                        });\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function deleteBudget(object1Id){\r\n\r\n            var url = base.budgetDelete\r\n                .replace('{budgetId}',object1Id);\r\n\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'DELETE',\r\n                    url: url\r\n                }).then(\r\n                    function(result) {\r\n                        MessageService.list();\r\n                        listBudgets().then(function(result3){\r\n                            NotificationService.create('Budget wurde gelscht!',5000);\r\n                            resolve(null);\r\n                        });\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('BusinesspartnerService', BusinesspartnerService);\r\n\r\n\tBusinesspartnerService.$inject = ['$http','$q'];\r\n\r\n\t/* @ngInject */\r\n\tfunction BusinesspartnerService($http, $q) {\r\n\t\tvar base = {\r\n\t\t\t\tbusinesspartners: '/webapp/api/businesspartners',\r\n\t\t\t\tbusinesspartnerSearch: '/webapp/api/businesspartners/search',\r\n                autoCategory: '/autoCategory',\r\n\t\t\t},\r\n\t\t\tservice = {\r\n\t\t\t\tlist: list,\r\n\t\t\t\tgetOne: getOne,\r\n                getAutoCategory: getAutoCategory,\r\n\t\t\t\tgetBusinessPartners: getBusinessPartners,\r\n\t\t\t\tsearch: search,\r\n\t\t\t\tgetBusinessPartnerNewName: getBusinessPartnerNewName,\r\n\t\t\t\tcreate: create,\r\n\t\t\t\tremove: remove\r\n\t\t\t},\r\n\t\t\tbusinessPartnerNewName = null,\r\n\t\t\tbusinessPartners = [];\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction getBusinessPartners(){\r\n\t\t\treturn businessPartners;\r\n\t\t}\r\n\r\n\t\tfunction getBusinessPartnerNewName(){\r\n\t\t\treturn businessPartnerNewName;\r\n\t\t}\r\n\r\n\t\tfunction create(){\r\n\r\n\t\t\tvar businessPartnerDTO = {\r\n\t\t\t\tbusinessPartnerName: businessPartnerNewName\r\n\t\t\t};\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\turl: base.businesspartners,\r\n\t\t\t\t\tdata: businessPartnerDTO,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tbusinessPartners.push(result.data);\r\n\t\t\t\t\t\tbusinessPartnerNewName = null;\r\n\t\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction search(searchName) {\r\n\r\n\t\t\tvar businessPartnerDTO = {\r\n\t\t\t\tbusinessPartnerName: searchName\r\n\t\t\t};\r\n\r\n\t\t\t$http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: base.businesspartnerSearch,\r\n\t\t\t\tdata: businessPartnerDTO,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t}).then(function(response){\r\n\t\t\t\tbusinessPartners = response.data.businessPartnerDTOList;\r\n\t\t\t\tbusinessPartnerNewName = response.data.newUserName;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction list() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.businesspartners\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getOne(uuid) {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.businesspartners + '/' + uuid\r\n\t\t\t});\r\n\t\t}\r\n\r\n        function getAutoCategory(uuid) {\r\n            return $http({\r\n                method: 'GET',\r\n                url: base.businesspartners + '/' + uuid + base.autoCategory\r\n            });\r\n        }\r\n\r\n\t\tfunction remove(businessPartnerId){\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\treturn $http({\r\n\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\turl: base.businesspartners + '/' + businessPartnerId\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\r\n\t\t\t\t\t\tvar foundBusinessPartner = _.filter(businessPartners, function(businessPartner){ return (businessPartner.businessPartnerId === businessPartnerId);});\r\n\t\t\t\t\t\tif (foundBusinessPartner != null && foundBusinessPartner != undefined && foundBusinessPartner.length > 0){\r\n\t\t\t\t\t\t\tvar foundBusinessPartnerIndex = _.indexOf(businessPartners, foundBusinessPartner[0]);\r\n\r\n\t\t\t\t\t\t\tbusinessPartners.splice(foundBusinessPartnerIndex, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\t$log.warn('Could not delete business partner!','result',result);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msArticlesSelect', [])\r\n\t\t.component('msArticlesSelect', {\r\n\t\t\ttemplateUrl: 'app/components/ms-articles-select.html',\r\n\t\t\tbindings: {\r\n\t\t\t\tcallback: '=msCallback',\r\n\t\t\t\tdata: '=msArticleDialogData'\r\n\t\t\t},\r\n\t\t\tcontroller: ArticlesSelectController,\r\n\t\t\tcontrollerAs: 'vm'\r\n\t\t});\r\n\r\n\tArticlesSelectController.$inject = ['$filter','$log','$timeout','$http','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction ArticlesSelectController($filter,$log,$timeout,$http,_) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.showLoadingText = true;\r\n\r\n\t\tvar dataInput = vm.data();\r\n\r\n\t\tvm.articles = dataInput.articles ? dataInput.articles : [];\r\n\t\tvm.imageUrl = dataInput.imageUrl;\r\n\t\tvm.invoiceId = dataInput.invoiceId;\r\n\t\tvm.username = dataInput.username ? dataInput.username : 'Keine Eingabe';\r\n\r\n\t\tsetTimeout(function() {\r\n\t\t\t\tprepareAnalysis();\r\n\t\t\t}\r\n\t\t, 1000);\r\n\r\n\r\n\t\tconsole.log(\"article select started\");\r\n\r\n\t\tvm.calculateSum = function(){\r\n\t\t\tvm.sum = 0;\r\n\r\n\t\t\tvm.articles.forEach(function(item){\r\n\t\t\t\tvm.sum = vm.sum + item.price;\r\n\t\t\t});\r\n\r\n\t\t\tvar roundedString = vm.sum.toFixed(2);\r\n\t\t\tvm.sum = Number(roundedString);\r\n\t\t};\r\n\r\n\t\tvm.useThisSum = function() {\r\n\t\t\tvm.callback(vm.articles, vm.sum);\r\n\t\t};\r\n\r\n\t\tsetTimeout(function() {\r\n\t\t\tdocument.getElementById('imageTarget' + vm.invoiceId).addEventListener('click', function (event) {\r\n\t\t\t\tvar bounds=this.getBoundingClientRect();\r\n\t\t\t\tvar left=bounds.left;\r\n\t\t\t\tvar top=bounds.top;\r\n\t\t\t\tvar x = event.pageX - left;\r\n\t\t\t\tvar y = event.pageY - top;\r\n\t\t\t\tvar cw=this.clientWidth;\r\n\t\t\t\tvar ch=this.clientHeight;\r\n\t\t\t\tvar iw=this.naturalWidth;\r\n\t\t\t\tvar ih=this.naturalHeight;\r\n\t\t\t\tvar px=x/cw*iw;\r\n\t\t\t\tvar py=y/ch*ih;\r\n\r\n\t\t\t\tvar percentX = (px/iw).toPrecision(8);\r\n\t\t\t\tvar percentY = (py/ih).toPrecision(8);\r\n\r\n\t\t\t\tfindArticleNameAndSum(percentX, percentY);\r\n\t\t\t});\r\n\t\t}, 100);\r\n\r\n\t\tvm.calculateSum();\r\n\r\n\t\tvm.removeArticleFromList = function(article){\r\n\t\t\tvar indexOfPosition = vm.articles.findIndex(function(item){\r\n\t\t\t\treturn item === article;\r\n\t\t\t});\r\n\r\n\t\t\tvm.articles.splice(indexOfPosition,1);\r\n\r\n\t\t\tvm.calculateSum();\r\n\t\t};\r\n\r\n\t\tfunction findArticleNameAndSum(x, y) {\r\n\r\n\t\t\tvar httpConfiguration = {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: '/webapp/api/service/upload/'+vm.invoiceId+'/articleAnalysis?x='+x+'&y='+y\r\n\t\t\t};\r\n\r\n\t\t\t$http(httpConfiguration).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tconsole.log('Article name:'+result.data.name+' price:'+result.data.price);\r\n\t\t\t\t\tvm.articles.push(result.data);\r\n\r\n\t\t\t\t\tvm.calculateSum();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tfunction prepareAnalysis() {\r\n\r\n\t\t\tvar httpConfiguration = {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: '/webapp/api/service/upload/'+vm.invoiceId+'/articleAnalysisPreparement'\r\n\t\t\t};\r\n\r\n\t\t\t$http(httpConfiguration).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.showLoadingText = false;\r\n\t\t\t\t},\r\n\t\t\t\tfunction(error) {\r\n\t\t\t\t\tvm.showLoadingText = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msCostdistributioncalculate',[])\r\n\t\t.directive('msCostdistributioncalculate', msCostdistributioncalculate);\r\n\r\n\tmsCostdistributioncalculate.$inject = ['$document','$log'];\r\n\r\n\t/* @ngInject */\r\n\tfunction msCostdistributioncalculate($document,$log) {\r\n\t\tvar directive = {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplateUrl: 'app/components/ms-costdistribution-calculate.html',\r\n\t\t\tscope: {\r\n\t\t\t\tcostDistributionItem: '=msCostDistributionItem',\r\n\t\t\t\tcostDistributionItems: '=msCostDistributionItems',\r\n\t\t\t\tdialogId: '=msDialogId',\r\n\t\t\t\tupdateMethod:'=msUpdateMethod',\r\n\t\t\t\tsumCost: '=msSumCost'\r\n\t\t\t},\r\n\t\t\tlink: function link(scope, element, attrs, vm) {\r\n\r\n\t\t\t},\r\n\t\t\tcontroller: CostdistributioncalculateController,\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true\r\n\t\t};\r\n\r\n\t\treturn directive;\r\n\r\n\r\n\t}\r\n\r\n\tCostdistributioncalculateController.$inject = ['$filter','$log','CostdistributioncalculateService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction CostdistributioncalculateController($filter,$log,CostdistributioncalculateService) {\r\n\t\tvar vm = this;\r\n\r\n\t\tNumber.prototype.setScale = function(scale){\r\n\t\t\tvar pow = Math.pow(10,scale);\r\n\t\t\treturn +( Math.round(this * pow) / pow );\r\n\t\t};\r\n\r\n\t\tNumber.prototype.divide = function(number2, scale){\r\n\t\t\tvar divisionResult = this / number2;\r\n\t\t\treturn divisionResult.setScale(scale);\r\n\t\t};\r\n\r\n\t\tNumber.prototype.remainder = function(n){\r\n\t\t\treturn ((this%n)+n)%n;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.compareTo = function(number2){\r\n\t\t\tif (this < number2){\r\n\t\t\t\treturn -1;\r\n\t\t\t}else if (this > number2){\r\n\t\t\t\treturn 1;\r\n\t\t\t}else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tNumber.prototype.multiply = function(number2){\r\n\t\t\treturn this * number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.subtract = function(number2){\r\n\t\t\treturn this - number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.add = function(number2){\r\n\t\t\treturn this + number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.floor = function() {\r\n\t\t\treturn Math.floor(this);\r\n\t\t};\r\n\r\n\t\tvm.costDistributionPercentageTv = '0 %';\r\n\t\tvm.costDistributionQuotaTv = '0.0';\r\n\t\tvm.costDistributionFixedAmountEt = 0.0;\r\n\r\n\t\tvm.costDistributionItemTypeEnum = null;\r\n\r\n\t\tif (vm.sumCost == null || vm.sumCost == undefined){\r\n\t\t\tvm.sumCost = 0;\r\n\t\t}\r\n\r\n\t\tvm.updateMethod = function(){\r\n\t\t\tvm.currentValue = vm.costDistributionItem.value;\r\n\t\t\tvm.costDistributionItemTypeEnum = vm.costDistributionItem.costDistributionItemTypeEnum;\r\n\t\t\tcostDistributionItemsWithoutCurrentItemUpdate();\r\n\t\t\tvm.refreshAllViews();\r\n\r\n\t\t\tvm.updateCostDistributionItems();\r\n\t\t};\r\n\r\n\t\tvm.getDialogIdWithoutHash = function(){\r\n\t\t\tvar resultId = vm.dialogId;\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.updateCostDistributionItems = function(){\r\n\t\t\tvm.costDistributionItems.forEach(function(item){\r\n\t\t\t\titem.moneyValue = CostdistributioncalculateService.calculateAmountForCostDistributionItemPrecise(item, vm.costDistributionItems, vm.sumCost);\r\n\t\t\t})\r\n\t\t};\r\n\r\n\t\tvm.onProgressChanged = function(){\r\n\r\n\t\t\tif (vm.costDistributionItemsWithoutCurrentItem == undefined){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar percent = parseInt(vm.seekBar).divide(100, 30);\r\n\r\n\t\t\tif (vm.costDistributionItem.costDistributionItemTypeEnum === 'FIXED_AMOUNT') {\r\n\t\t\t\tvar maxAmountForOneCostDistributionItem = CostdistributioncalculateService.getMaxAmountForOneCostDistributionItem(vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\t\tvm.currentValue = maxAmountForOneCostDistributionItem.multiply(percent).setScale(2);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'QUOTA') {\r\n\t\t\t\tvar maxQuota = CostdistributioncalculateService.getCountWithoutFixed(vm.costDistributionItems);\r\n\t\t\t\tvar maxQuotaWeighted = CostdistributioncalculateService.getCountWeightedWithoutFixed(vm.costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\tvar maxQuotaSubtractMaxQuotaWeighted = maxQuota.subtract(maxQuotaWeighted);\r\n\r\n\t\t\t\tvm.currentValue = percent.multiply(maxQuotaSubtractMaxQuotaWeighted).setScale(1);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'PERCENT') {\r\n\t\t\t\tvar maxAmount = CostdistributioncalculateService.getMaxAmountForOneCostDistributionItem(vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\t\tvar amountOfPercentOfMaxAmount = percent.multiply(maxAmount);\r\n\t\t\t\tvar percentOfResult = amountOfPercentOfMaxAmount.divide(vm.sumCost, 2);\r\n\t\t\t\tvm.currentValue = percentOfResult;\r\n\t\t\t}\r\n\r\n\t\t\tupdateCostDistributionItem();\r\n\t\t\tvm.refreshAllViews('UNDEFINED');\r\n\r\n\t\t\tvm.updateCostDistributionItems();\r\n\t\t};\r\n\r\n\t\tfunction costDistributionItemsWithoutCurrentItemUpdate(){\r\n\t\t\tvm.costDistributionItemsWithoutCurrentItem = [];\r\n\t\t\tvm.costDistributionItems.forEach(function(item){\r\n\t\t\t\tvm.costDistributionItemsWithoutCurrentItem.push(item);\r\n\t\t\t});\r\n\r\n\t\t\tvar indexOfPosition = vm.costDistributionItems.findIndex(function(item){\r\n\t\t\t\treturn item.costDistributionItemId === vm.costDistributionItem.costDistributionItemId;\r\n\t\t\t});\r\n\t\t\tvm.costDistributionItemsWithoutCurrentItem.splice(indexOfPosition, 1);\r\n\t\t}\r\n\r\n\t\tfunction updateCostDistributionItem(){\r\n\t\t\tvm.costDistributionItem.value = vm.currentValue;\r\n\t\t}\r\n\r\n\t\tvm.refreshAllViews = function(costDistributionItemTypeEnum) {\r\n\r\n\t\t\tif (vm.sumCost == undefined){\r\n\t\t\t\tvm.sumCost = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (costDistributionItemTypeEnum != null && costDistributionItemTypeEnum != undefined) {\r\n\t\t\t\tif (costDistributionItemTypeEnum === 'FIXED_AMOUNT') {\r\n\t\t\t\t\tvm.refreshProgressBar();\r\n\t\t\t\t} else if (costDistributionItemTypeEnum === 'QUOTA') {\r\n\t\t\t\t\tvm.refreshFixedAmountEt();\r\n\t\t\t\t\tvm.refreshProgressBar();\r\n\t\t\t\t} else if (costDistributionItemTypeEnum === 'PERCENT') {\r\n\t\t\t\t\tvm.refreshFixedAmountEt();\r\n\t\t\t\t\tvm.refreshProgressBar();\r\n\t\t\t\t} else if (costDistributionItemTypeEnum === 'UNDEFINED') {\r\n\t\t\t\t\tvm.refreshFixedAmountEt();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvm.refreshFixedAmountEt();\r\n\t\t\t\tvm.refreshProgressBar();\r\n\t\t\t}\r\n\r\n\t\t\trefreshQuotaEt();\r\n\t\t\trefreshPercentageTv();\r\n\t\t};\r\n\r\n\t\tfunction refreshPercentageTv() {\r\n\t\t\tvar percentOfCurrentQuota = 0;\r\n\r\n\t\t\tif (vm.costDistributionItem.costDistributionItemTypeEnum === 'FIXED_AMOUNT') {\r\n\t\t\t\tpercentOfCurrentQuota = vm.currentValue.divide(vm.sumCost, 10).multiply(100).setScale(0);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'QUOTA') {\r\n\t\t\t\tvar percentForValue = CostdistributioncalculateService.calculatePercentForValue('QUOTA', vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\t\tpercentOfCurrentQuota = percentForValue.multiply(100).setScale(0);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'PERCENT') {\r\n\t\t\t\tpercentOfCurrentQuota = vm.currentValue.multiply(100).setScale(0);\r\n\t\t\t}\r\n\r\n\t\t\tvm.costDistributionPercentageTv = percentOfCurrentQuota.toFixed(0) + '%';\r\n\t\t}\r\n\r\n\t\tfunction refreshQuotaEt() {\r\n\t\t\tvar quotaForEt = CostdistributioncalculateService.calculateQuotaForValue(vm.costDistributionItem.costDistributionItemTypeEnum, vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\tvm.costDistributionQuotaTv = quotaForEt.toFixed(1);\r\n\t\t}\r\n\r\n\t\tvm.onQuotaCheckBoxClick = function() {\r\n\t\t\tvar quota = CostdistributioncalculateService.calculateQuotaForValue(vm.costDistributionItemTypeEnum, vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\tvm.currentValue = quota;\r\n\r\n\t\t\tvm.costDistributionItemTypeEnum = 'QUOTA';\r\n\r\n\t\t\tupdateCostDistributionItem();\r\n\r\n\t\t\tvm.refreshAllViews('QUOTA');\r\n\t\t};\r\n\r\n\t\tvm.onPercentCheckBoxClick = function() {\r\n\t\t\tvar percent = CostdistributioncalculateService.calculatePercentForValue(vm.costDistributionItemTypeEnum, vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\tvm.currentValue = percent;\r\n\r\n\t\t\tvm.costDistributionItemTypeEnum = 'PERCENT';\r\n\r\n\t\t\tupdateCostDistributionItem();\r\n\r\n\t\t\tvm.refreshAllViews('PERCENT');\r\n\t\t};\r\n\r\n\t\tvm.onFixedAmountCheckBoxClick = function() {\r\n\t\t\tvar fixedAmount = CostdistributioncalculateService.calculateAmountForValue(vm.costDistributionItemTypeEnum, vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\tvm.currentValue = fixedAmount;\r\n\r\n\t\t\tvm.costDistributionItemTypeEnum = 'FIXED_AMOUNT';\r\n\r\n\t\t\tupdateCostDistributionItem();\r\n\r\n\t\t\tvm.refreshAllViews('FIXED_AMOUNT');\r\n\t\t};\r\n\r\n\t\tvm.onFixedAmountTextChanged = function() {\r\n\t\t\tif (vm.costDistributionItemTypeEnum === 'FIXED_AMOUNT'){\r\n\t\t\t\tvm.currentValue = vm.costDistributionFixedAmountEt;\r\n\r\n\t\t\t\tupdateCostDistributionItem();\r\n\r\n\t\t\t\tvm.refreshAllViews('FIXED_AMOUNT');\r\n\r\n\t\t\t\tvm.updateCostDistributionItems();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.refreshFixedAmountEt = function() {\r\n\t\t\tvar fixedAmountForEt = CostdistributioncalculateService.calculateAmountForValue(vm.costDistributionItem.costDistributionItemTypeEnum, vm.currentValue, vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\tvm.costDistributionFixedAmountEt = fixedAmountForEt;\r\n\t\t\tvm.costDistributionItem.moneyValue = fixedAmountForEt;\r\n\t\t};\r\n\r\n\t\tvm.refreshProgressBar = function() {\r\n\r\n\t\t\tvar percentForProgressEt = 0;\r\n\r\n\t\t\tif (vm.costDistributionItem.costDistributionItemTypeEnum === 'FIXED_AMOUNT') {\r\n\t\t\t\tvar maxAmountForOneCostDistributionItem = CostdistributioncalculateService.getMaxAmountForOneCostDistributionItem(vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\t\tpercentForProgressEt = vm.currentValue.divide(maxAmountForOneCostDistributionItem, 10).multiply(100).setScale(0);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'QUOTA') {\r\n\t\t\t\tvar maxQuota = CostdistributioncalculateService.getCountWithoutFixed(vm.costDistributionItems);\r\n\t\t\t\tvar maxQuotaWeighted = CostdistributioncalculateService.getCountWeightedWithoutFixed(vm.costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\tvar maxQuotaSubtractMaxQuotaWeighted = maxQuota.subtract(maxQuotaWeighted);\r\n\r\n\t\t\t\tpercentForProgressEt = vm.currentValue.divide(maxQuotaSubtractMaxQuotaWeighted, 10).multiply(100).setScale(0);\r\n\t\t\t} else if (vm.costDistributionItem.costDistributionItemTypeEnum === 'PERCENT') {\r\n\t\t\t\tvar maxAmount = CostdistributioncalculateService.getMaxAmountForOneCostDistributionItem(vm.costDistributionItemsWithoutCurrentItem, vm.sumCost);\r\n\t\t\t\tvar amountOfPercent = vm.currentValue.multiply(vm.sumCost);\r\n\t\t\t\tvar percentOfResult = 0;\r\n\t\t\t\tif (maxAmount != 0){\r\n\t\t\t\t\tpercentOfResult  = amountOfPercent.divide(maxAmount, 3);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpercentForProgressEt = percentOfResult.multiply(100);\r\n\t\t\t}\r\n\r\n\t\t\tvm.seekBar = percentForProgressEt.setScale(0);\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msInputDate', [\r\n\t\t\t'moment-picker'\r\n\t\t])\r\n\t\t.component('msInputDate', {\r\n\t\t\ttemplateUrl: 'app/components/ms-input-date.html',\r\n\t\t\tbindings: {\r\n\t\t\t\tvalue: '=msValue',\r\n\t\t\t\trequired: '<?msRequired',\r\n\t\t\t\tdisabled: '<?msDisabled',\r\n\t\t\t\tsetNull: '<?msSetNull',\r\n\t\t\t\tcallback: '&?msOnChange'\r\n\t\t\t},\r\n\t\t\tcontroller: InputDateController,\r\n\t\t\tcontrollerAs: 'vm'\r\n\t\t});\r\n\r\n\tInputDateController.$inject = ['$element', '$log', '$scope', '_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InputDateController($element, $log, $scope, _) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.$onInit = function() {\r\n\t\t\t$scope.$watch('vm.value', function(newValue) {\r\n\t\t\t\tvm.timestamp = newValue;\r\n\t\t\t\tvm.date = timestampToDate(newValue);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.$onChanges = function(changes) {\r\n\t\t\tif (changes.required) {\r\n\t\t\t\tsetRequiredProperty(changes.required.currentValue);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.dateToTimestamp = function() {\r\n\t\t\tvm.timestamp = dateToTimestamp(vm.date);\r\n\t\t\tvm.value = vm.timestamp;\r\n\t\t\tif (angular.isFunction(vm.callback)) {\r\n\t\t\t\tvm.callback();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction timestampToDate(timestamp) {\r\n\t\t\tvar intTimestamp, date;\r\n\r\n\t\t\tif (!isNaN(timestamp) && timestamp != null && timestamp != undefined) {\r\n\t\t\t\tintTimestamp = parseInt(timestamp);\r\n\t\t\t\tdate = new Date(intTimestamp);\r\n\r\n\t\t\t\treturn date;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvm.setDateToNull = function(){\r\n\t\t\tif (vm.setNull === undefined || vm.setNull === true){\r\n\t\t\t\tvm.date = null;\r\n\t\t\t\tvm.timestamp = null;\r\n\t\t\t\tvm.value = vm.timestamp;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction setRequiredProperty(required) {\r\n\t\t\tif (required) {\r\n\t\t\t\t$element.attr('data-required','required');\r\n\t\t\t} else {\r\n\t\t\t\t$element.removeAttribute('data-required');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction dateToTimestamp(date) {\r\n\t\t\tif (angular.isDate(date)) {\r\n\t\t\t\treturn date.getTime();\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msInvoiceSummary', [\r\n\t\t\t'moment-picker'\r\n\t\t])\r\n\t\t.component('msInvoiceSummary', {\r\n\t\t\ttemplateUrl: 'app/components/ms-invoice-summary.html',\r\n\t\t\tbindings: {\r\n\t\t\t\tinvoice: '<msInvoice',\r\n                isStandingOrder: '<?msIsStandingOrder',\r\n                isReadyOnlyMode: '<?msReadOnly',\r\n                returnView: '=?msReturnView'\r\n\t\t\t},\r\n\t\t\tcontroller: InvoiceSummaryController,\r\n\t\t\tcontrollerAs: 'vm'\r\n\t\t});\r\n\r\n    InvoiceSummaryController.$inject = ['$timeout','$state','InvoiceService','CostdistributionitemService','InvoiceimageService','NotificationService','_', 'UserService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoiceSummaryController($timeout,$state,InvoiceService,CostdistributionitemService,InvoiceimageService,NotificationService,_,UserService) {\r\n        var vm = this;\r\n        vm.title = 'InvoiceSummaryController';\r\n\r\n        vm.costDistributionItems = [];\r\n        vm.payerName = '';\r\n        vm.paymentRecipientName = '';\r\n\r\n        vm.currentUser = {};\r\n\r\n        vm.hasInvoiceImageValue = false;\r\n\r\n        vm.repetionTypeEnums = [];\r\n        vm.paymentTypeEnums = [];\r\n\r\n        vm.standingOrder = {};\r\n        vm.originalStandingOrder = {};\r\n        vm.costDistributions = [];\r\n\r\n        vm.goToInvoice = function() {\r\n            // if (vm.invoice.invoiceStatusEnum !== 'ANALYZING'){\r\n\r\n                var params = {\r\n                    invoiceId: vm.invoice.invoiceId\r\n                };\r\n                if (vm.returnView != undefined){\r\n                    params.returnView = vm.returnView;\r\n                }\r\n                $state.go('invoices.details', params);\r\n            // }else{\r\n            //     NotificationService.create('Rechnung wird gerade analysiert! Bitte warten!',3000);\r\n            // }\r\n        };\r\n\r\n        vm.isReadOnlyMode = function(){\r\n            if (vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_CHECK_MODE' || vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_READY_MODE')\t{\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        };\r\n\r\n        vm.remove = function() {\r\n            if (vm.isStandingOrder){\r\n                vm.removeInvoiceTemplate();\r\n            }else{\r\n                vm.removeInvoice();\r\n            }\r\n        };\r\n\r\n        vm.getDialogId = function(customIdentifier){\r\n            var resultId = '#';\r\n            if (customIdentifier != undefined){\r\n                resultId = resultId + customIdentifier;\r\n            }\r\n            return resultId;\r\n        };\r\n\r\n        vm.getDialogIdWithoutHash = function(customIdentifier){\r\n            var resultId = customIdentifier;\r\n            return resultId;\r\n        };\r\n\r\n\r\n        vm.hasInvoiceImage = function(){\r\n            vm.hasInvoiceImageValue = !!vm.invoice.invoiceImageId;\r\n        };\r\n\r\n        vm.getInvoiceImageUrl = function(){\r\n            return InvoiceimageService.getInvoiceImageUrl(vm.invoice.invoiceImageId);\r\n        };\r\n\r\n        vm.removeInvoice = function() {\r\n            InvoiceService.remove(vm.invoice.invoiceId);\r\n            goToOverview();\r\n        };\r\n\r\n        vm.removeInvoiceTemplate = function() {\r\n            InvoiceService.deleteStandingOrder(vm.invoice.invoiceId);\r\n            goToOverview();\r\n        };\r\n\r\n        vm.isNullOrUndefined = function(value){\r\n            if (value === null || value === undefined){\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n\r\n        activate();\r\n\r\n        ////////////////\r\n\r\n        function generateUUID(){\r\n            function s4() {\r\n                return Math.floor((1 + Math.random()) * 0x10000)\r\n                    .toString(16)\r\n                    .substring(1);\r\n            }\r\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n                s4() + '-' + s4() + s4() + s4();\r\n        }\r\n\r\n        function getCurrentUser(todoAfter) {\r\n            UserService.currentUser().then(function(result) {\r\n                vm.currentUser = result;\r\n\r\n                if (todoAfter != undefined){\r\n                    todoAfter();\r\n                }\r\n            });\r\n        }\r\n\r\n        function toDoAfterCurrentUserGet(){\r\n\r\n            if (vm.invoice.mainFunctionEnum === 'INCOME'){\r\n                vm.invoice.paymentRecipientId = vm.currentUser.appUserId;\r\n                vm.invoice.paymentRecipientTypeEnum = 'USER';\r\n            }else{\r\n                vm.invoice.payerId = vm.currentUser.appUserId;\r\n                vm.invoice.payerTypeEnum = 'USER';\r\n            }\r\n            vm.originalInvoice = angular.copy(vm.invoice);\r\n        }\r\n\r\n        function activate() {\r\n\r\n            getCurrentUser();\r\n            getInvoice();\r\n\r\n            vm.standingOrder.invoiceTemplateId = vm.invoice.invoiceId;\r\n            vm.standingOrder.futureInvoiceTemplateId = generateUUID();\r\n            getStandingOrder();\r\n            getRepetitionTypeEnums();\r\n            getPaymentTypeEnums();\r\n        }\r\n\r\n        function refreshInvoiceData(){\r\n            // vm.isStandingOrder = false;\r\n            // if (vm.invoice.standingOrderInvoiceTemplateId === vm.invoice.invoiceId){\r\n            // \tvm.isStandingOrder = true;\r\n            // }\r\n\r\n            vm.hasInvoiceImage();\r\n\r\n            if (vm.invoice.paymentRecipientId != null){\r\n                vm.paymentRecipientName = vm.invoice.paymentRecipientDTO.displayName;\r\n            }\r\n\r\n            if (vm.invoice.payerId != null){\r\n                vm.payerName = vm.invoice.payerDTO.displayName;\r\n            }\r\n        }\r\n\r\n        function getInvoice() {\r\n            InvoiceService.details(vm.invoice.invoiceId).then(function(response) {\r\n                vm.invoice = response.data;\r\n\r\n                refreshInvoiceData();\r\n\r\n\t\t\t\tvm.costDistributionItems = vm.invoice.costDistributionItemDTOs;\r\n\t\t\t\tvm.originalCostDistributionItems = angular.copy(vm.costDistributionItems);\r\n\r\n                vm.originalInvoice = angular.copy(vm.invoice);\r\n            });\r\n        }\r\n\r\n        function getRepetitionTypeEnums() {\r\n            InvoiceService.repetitionTypeEnumList().then(function(result) {\r\n                vm.repetionTypeEnums = result.data;\r\n\r\n                if (vm.isStandingOrder){\r\n                    var foundRepetionTypeEnum = _.filter(vm.repetionTypeEnums, function(repetionTypeEnum){ return (repetionTypeEnum.name === 'ONCE');});\r\n                    if (foundRepetionTypeEnum != null && foundRepetionTypeEnum != undefined && foundRepetionTypeEnum.length > 0){\r\n                        var foundRepetionTypeEnumIndex = _.indexOf(vm.repetionTypeEnums, foundRepetionTypeEnum[0]);\r\n\r\n                        vm.repetionTypeEnums.splice(foundRepetionTypeEnumIndex, 1);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        function getPaymentTypeEnums() {\r\n            InvoiceService.paymentTypeEnumList().then(function(result) {\r\n                vm.paymentTypeEnums = result.data;\r\n            });\r\n        }\r\n\r\n        function getStandingOrder(){\r\n            if (vm.isStandingOrder){\r\n                $timeout(function(){\r\n                    InvoiceService.getStandingOrder(vm.invoice.invoiceId).then(function(result){\r\n                        vm.standingOrder.repetitionTypeEnum = result.repetitionTypeEnum;\r\n                        vm.standingOrder.startDate = result.startDate;\r\n\r\n                        vm.originalStandingOrder = angular.copy(vm.standingOrder);\r\n                    }, function(response){\r\n                        vm.standingOrder.startDate = new Date().getTime();\r\n                        vm.standingOrder.repetitionTypeEnum = 'MONTHLY';\r\n                        vm.originalStandingOrder = {\r\n                            repetitionTypeEnum: vm.standingOrder.repetitionTypeEnum,\r\n                            startDate: vm.standingOrder.startDate\r\n                        }\r\n\r\n                        vm.invoice.repetitionTypeEnum = vm.standingOrder.repetitionTypeEnum;\r\n                        vm.originalInvoice.repetitionTypeEnum = vm.standingOrder.repetitionTypeEnum;\r\n                    })\r\n                }, 100);\r\n            }else{\r\n                vm.originalStandingOrder = angular.copy(vm.standingOrder);\r\n            }\r\n        }\r\n\r\n        function getCostDistributionItems(){\r\n            CostdistributionitemService.listForInvoice(vm.invoice.invoiceId).then(\r\n                function(response) {\r\n                    vm.costDistributionItems = response.data;\r\n\r\n                    vm.originalCostDistributionItems = angular.copy(vm.costDistributionItems);\r\n                }, function(error){\r\n                }\r\n            );\r\n        }\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msInvoiceTable', [\r\n\t\t\t'moment-picker'\r\n\t\t])\r\n\t\t.component('msInvoiceTable', {\r\n\t\t\ttemplateUrl: 'app/components/ms-invoice-table.html',\r\n\t\t\tbindings: {\r\n\t\t\t\tinvoices: '<msInvoices',\r\n\t\t\t\tallowGoTo: '<?msAllowGoTo',\r\n\t\t\t\tuseSelection: '<msUseSelection',\r\n                selected : '=?msSelected',\r\n                detailViewId : '=?msDetailViewId',\r\n                tableViewId : '=?msTableViewId',\r\n                useDebtValue : '<?msUseDebt',\r\n                returnView: '=?msReturnView'\r\n\t\t\t},\r\n\t\t\tcontroller: InvoiceTableController,\r\n\t\t\tcontrollerAs: 'vm'\r\n\t\t});\r\n\r\n    InvoiceTableController.$inject = ['$filter','$state','$element', '$log', '$scope', 'InvoiceService', 'NotificationService', '_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoiceTableController($filter, $state, $element, $log, $scope, InvoiceService, NotificationService, _) {\r\n\t\tvar vm = this;\r\n\r\n\t\t$log.info('msInvoiceTable loaded');\r\n\r\n        vm.selectedInvoiceId = null;\r\n\r\n        vm.isInvoiceDetailsEnabled = function(invoiceId) {\r\n            if (vm.tableViewId !== undefined && vm.tableViewId != null){\r\n                return ((vm.tableViewId + '' + invoiceId) === vm.detailViewId);\r\n            }else{\r\n                return vm.selectedInvoiceId === invoiceId;\r\n            }\r\n\r\n        };\r\n\r\n        vm.goToInvoice = function(invoice) {\r\n\r\n        \tvm.allowGoTo = (vm.allowGoTo != undefined ? vm.allowGoTo : true);\r\n\r\n        \tif (vm.allowGoTo){\r\n                if (invoice.invoiceStatusEnum !== 'ANALYZING'){\r\n                    $state.go('invoices.details', {\r\n                        invoiceId: invoice.invoiceId\r\n                    });\r\n                }else{\r\n                    NotificationService.create('Rechnung wird gerade analysiert! Bitte warten!',3000);\r\n                }\r\n\t\t\t}\r\n        };\r\n\r\n        vm.toggleInvoiceDetails = function(invoice) {\r\n            var oldValue, currentValue, invoiceId = invoice.invoiceId;\r\n\r\n            if (vm.tableViewId !== undefined && vm.tableViewId != null){\r\n                oldValue = vm.detailViewId;\r\n                currentValue = (oldValue === (vm.tableViewId + '' + invoiceId)) ? null : invoiceId;\r\n                if (currentValue == null){\r\n                    vm.detailViewId = null;\r\n                }else{\r\n                    vm.detailViewId = vm.tableViewId + '' + currentValue;\r\n                }\r\n\r\n            }else{\r\n                oldValue = vm.selectedInvoiceId;\r\n                currentValue = (oldValue === invoiceId) ? null : invoiceId;\r\n                vm.selectedInvoiceId = currentValue;\r\n            }\r\n\r\n        };\r\n\r\n        vm.isSelected = function(item) {\r\n\r\n            var matchedRights = _.chain(vm.selected)\r\n                .intersection([item])\r\n                .value();\r\n\r\n            if (matchedRights.length > 0) {\r\n                return true\r\n            }else{\r\n                return false;\r\n            }\r\n        };\r\n\r\n        vm.toggleSelect = function(item) {\r\n            var index = _.indexOf(vm.selected, item);\r\n\r\n            if (index === -1) {\r\n                vm.selected.push(item);\r\n            } else {\r\n                vm.selected.splice(index, 1);\r\n            }\r\n        };\r\n\r\n        vm.invoiceServiceLoading = function(){\r\n            return InvoiceService.isLoading();\r\n        };\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msInvoicecategorieSelect',[])\r\n\t\t.directive('msInvoicecategorieSelect', msInvoicecategorieSelect);\r\n\r\n\tmsInvoicecategorieSelect.$inject = ['$document','$log','InvoicecategoriesService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction msInvoicecategorieSelect($document,$log,InvoicecategoriesService,_) {\r\n\t\tvar directive = {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplateUrl: 'app/components/ms-invoicecategorie-select.html',\r\n\t\t\tscope: {\r\n\t\t\t\tinvoiceCategories: '=msInvoiceCategories',\r\n\t\t\t\treturnInvoiceCategory: '=msReturnInvoiceCategory',\r\n\t\t\t\tdisabled: '<disabled',\r\n\t\t\t\tcurrentSelection: '=msCurrentSelection',\r\n\t\t\t\tdialogId: '=msDialogId',\r\n\t\t\t\thideSelectionButton: '=msHideSelectionButton',\r\n\t\t\t\texpenseType: '=msExpenseType',\r\n\t\t\t\thiddenSelButtonActivator: '=msHiddenSelButtonActivator'\r\n\t\t\t},\r\n\t\t\tlink: link,\r\n\t\t\tcontroller: InvoicecategorieSelectController,\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true\r\n\t\t};\r\n\r\n\t\treturn directive;\r\n\r\n\t\tfunction link(scope, element, attrs, vm) {\r\n            //\r\n\t\t\t// scope.$watch('InvoicecategoriesService.getParentInvoiceCategories()', function(newValue, oldValue) {\r\n\t\t\t// \tinitCategories();\r\n\t\t\t// });\r\n\t\t}\r\n\t}\r\n\r\n\tInvoicecategorieSelectController.$inject = ['$filter','$log','InvoicecategoriesService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoicecategorieSelectController($filter,$log,InvoicecategoriesService,_) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.newInvoiceCategoryName = '';\r\n\t\t\r\n\t\tvm.getParentInvoiceCategories = function()\r\n\t\t{\r\n\t\t\tif (!vm.categorieParentsFiltered){\r\n\t\t\t\treturn InvoicecategoriesService.getParentInvoiceCategories(vm.expenseType);\r\n\t\t\t}else{\r\n\t\t\t\treturn vm.categorieParentsFiltered;\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tvm.getDialogId = function(customIdentifier){\r\n\t\t\tvar resultId = '#' + vm.dialogId;\r\n\t\t\tif (customIdentifier){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n        vm.selectNone = function(){\r\n            vm.returnInvoiceCategory(null);\r\n        };\r\n\r\n\t\tvm.getDialogIdWithoutHash = function(customIdentifier){\r\n\t\t\tvar resultId = vm.dialogId;\r\n\t\t\tif (customIdentifier){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.findInvoiceCategoriesForParent = function(parentInvoiceCategory){\r\n\t\t\treturn _.filter(InvoicecategoriesService.getInvoiceCategories(), function(invoiceCategory){ return (invoiceCategory.parentInvoiceCategoryDTO != null && parentInvoiceCategory.invoiceCategoryId === invoiceCategory.parentInvoiceCategoryDTO.invoiceCategoryId);});\r\n\t\t};\r\n\r\n\t\tvm.selectInvoiceCategory = function(invoiceCategorie){\r\n\t\t\tvm.returnInvoiceCategory(invoiceCategorie);\r\n\t\t\tvm.invoiceCategorySearch = \"\";\r\n\t\t\tvm.refreshInvoiceParents();\r\n\t\t};\r\n\r\n\t\tvm.searchFilterForInvoiceCategories = function() {\r\n\t\t\treturn vm.searchMatcher(vm.invoiceCategorySearch);\r\n\t\t};\r\n\r\n\t\tvm.refreshInvoiceParents = function(){\r\n\t\t\tvm.categorieParentsFiltered = _.filter(InvoicecategoriesService.getParentInvoiceCategories(vm.expenseType), function(parentInvoiceCategory){\r\n\t\t\t\tvar hasChilds = false;\r\n\r\n\t\t\t\tvar childCategories = _.filter(InvoicecategoriesService.getInvoiceCategories(), function(invoiceCategory){ return (invoiceCategory.parentInvoiceCategoryDTO != null && parentInvoiceCategory.invoiceCategoryId === invoiceCategory.parentInvoiceCategoryDTO.invoiceCategoryId);});\r\n\t\t\t\tvar searchFilter = vm.searchFilterForInvoiceCategories();\r\n\r\n\t\t\t\tchildCategories.forEach(function(item){\r\n\t\t\t\t\tif (searchFilter(item)){\r\n\t\t\t\t\t\thasChilds = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn hasChilds;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.searchMatcher = function(searchInput){\r\n\t\t\tvar searchMatch = (searchInput ? new RegExp(\".*\" + searchInput + \".*\", 'i') : null);\r\n\t\t\treturn function(item) {\r\n\t\t\t\tif (searchMatch && !searchMatch.test(item.invoiceCategoryName)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t};\r\n\t\t\r\n\t\tvm.createInvoiceCategory = function(parentInvoiceCategory){\r\n\t\t\tInvoicecategoriesService.create(vm.newInvoiceCategoryName, parentInvoiceCategory.invoiceCategoryId).then(function(result){\r\n\t\t\t\tvm.refreshInvoiceParents();\r\n\t\t\t});\r\n\t\t\tvm.parentInvoiceCategoryAdding[parentInvoiceCategory.invoiceCategoryId] = false;\r\n\t\t};\r\n\r\n\t\tvm.removeInvoiceCategory = function(invoiceCategory){\r\n            InvoicecategoriesService.remove(invoiceCategory.invoiceCategoryId).then(function(result){\r\n                vm.refreshInvoiceParents();\r\n            });\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msPaymentpersonSelect',[])\r\n\t\t.directive('msPaymentpersonSelect', msPaymentpersonSelect);\r\n\r\n\tmsPaymentpersonSelect.$inject = ['$document','$log','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction msPaymentpersonSelect($document,$log,_) {\r\n\t\tvar directive = {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplateUrl: 'app/components/ms-paymentperson-select.html',\r\n\t\t\tscope: {\r\n\t\t\t\tappUsers: '=msUsers',\r\n\t\t\t\tuserContacts: '=msUsercontacts',\r\n\t\t\t\tbusinessPartners: '=msBusinesspartners',\r\n\t\t\t\tprojects: '=msProjects',\r\n\t\t\t\tcallbackPaymentPerson: '=msCallbackPaymentPerson',\r\n\t\t\t\tdialogId: '=msDialogId',\r\n\t\t\t\tdisabled: '<disabled',\r\n\t\t\t\tcurrentSelection: '=msCurrentSelection',\r\n\t\t\t\thideBusinessPartners: '=msHideBusinessPartners',\r\n\t\t\t\thideCurrentUser: '=msHideCurrentUser',\r\n                hideSelectionButton: '=msHideSelectionButton',\r\n\t\t\t\thiddenSelButtonActivator: '=msHiddenSelButtonActivator'\r\n\t\t\t},\r\n\t\t\tlink: link,\r\n\t\t\tcontroller: PaymentpersonSelectController,\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true\r\n\t\t};\r\n\r\n\t\treturn directive;\r\n\r\n\t\tfunction link(scope, element, attrs, vm) {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tPaymentpersonSelectController.$inject = ['$filter','$log','$timeout','UsercontactService','BusinesspartnerService', 'UserService', '_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction PaymentpersonSelectController($filter,$log,$timeout,UsercontactService, BusinesspartnerService, UserService, _) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.showDialog = false;\r\n\r\n\t\tvm.businessPartnerTimeoutRunning = false;\r\n\t\tvm.appUserTimeoutRunning = false;\r\n\r\n\t\tvm.currentUserId = null;\r\n\t\tUserService.currentUser().then(function(result) {\r\n\t\t\tvm.currentUserId = result.appUserId;\r\n\t\t});\r\n\r\n        vm.getUsers = function(){\r\n        \tvar appUsers= [];\r\n\r\n            if (vm.appUsers == undefined || vm.appUsers == null){\r\n\t\t\t\tUsercontactService.getUsers().forEach(function(appUser){\r\n\t\t\t\t\tappUsers.push(appUser);\r\n\t\t\t\t});\r\n            }else{\r\n\t\t\t\tappUsers = vm.appUsers;\r\n\t\t\t}\r\n\r\n\t\t\tif (vm.hideCurrentUser != undefined && vm.hideCurrentUser != null) {\r\n\t\t\t\tvar foundAppUser = _.filter(appUsers, function(appUser){ return (appUser.appUserId === vm.currentUserId && appUser.appUserContactId === undefined)});\r\n\t\t\t\tif (foundAppUser != null && foundAppUser != undefined && foundAppUser.length > 0){\r\n\t\t\t\t\tvar foundAppUserIndex = _.indexOf(appUsers, foundAppUser[0]);\r\n\t\t\t\t\tappUsers.splice(foundAppUserIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn appUsers;\r\n        };\r\n\r\n\t\tvm.getNewBusinessPartnerName = function(){\r\n\t\t\treturn BusinesspartnerService.getBusinessPartnerNewName();\r\n\t\t};\r\n\r\n\t\tvm.getFoundAppUser = function(){\r\n\t\t\treturn UsercontactService.getFoundAppUser();\r\n\t\t};\r\n\r\n\t\tvm.createNewBusinessPartner = function(){\r\n\t\t\tBusinesspartnerService.create().then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.selectBusinessPartner(result);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t};\r\n\r\n\t\tvm.createNewProject = function(){\r\n\t\t\tUsercontactService.createProject(vm.projectsSearch).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.selectProject(result);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tvm.createNewUserContact = function(){\r\n\t\t\tUsercontactService.createUserContact(vm.userContactsSearch).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.selectUserContact(result);\r\n\t\t\t\t}\r\n\t\t\t);;\r\n\t\t};\r\n\r\n\t\tvm.createNewAppUserContact = function(){\r\n\t\t\tUsercontactService.createAppUserContact().then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvm.selectUser(result);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tvm.removeBusinessPartner = function(businessPartner){\r\n\t\t\tBusinesspartnerService.remove(businessPartner.businessPartnerId);\r\n\t\t};\r\n\r\n\t\tvm.removeUserContact = function(userContact){\r\n\t\t\tUsercontactService.remove(userContact.userContactId);\r\n\t\t};\r\n\r\n\t\tvm.businessPartnerInputDone = function(){\r\n\t\t\tif (vm.businessPartnerTimeoutRunning == false){\r\n\t\t\t\tvm.businessPartnerTimeoutRunning = true;\r\n\t\t\t\t$timeout(function(){\r\n\t\t\t\t\tif (vm.businessPartnerInput.length > 1){\r\n\t\t\t\t\t\tBusinesspartnerService.search(vm.businessPartnerInput);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvm.businessPartnerTimeoutRunning = false;\r\n\t\t\t\t}, 400);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.appUserInputDone = function(){\r\n\t\t\tif (vm.appUserTimeoutRunning == false){\r\n\t\t\t\tvm.appUserTimeoutRunning = true;\r\n\t\t\t\t$timeout(function(){\r\n\t\t\t\t\tif (vm.usersSearch.length > 1){\r\n\t\t\t\t\t\tUsercontactService.searchForUser(vm.usersSearch);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvm.appUserTimeoutRunning = false;\r\n\t\t\t\t}, 400);\r\n\t\t\t}\r\n\t\t};\r\n\r\n        vm.getUserContacts = function(){\r\n            if (vm.userContacts == undefined || vm.userContacts == null){\r\n                return UsercontactService.getUserContacts();\r\n            }else{\r\n                return vm.userContacts;\r\n            }\r\n        };\r\n\r\n        vm.getProjects = function(){\r\n            if (vm.projects == undefined || vm.projects == null){\r\n                return UsercontactService.getProjects();\r\n            }else{\r\n                return vm.projects;\r\n            }\r\n        };\r\n\r\n        vm.getBusinessPartners = function(){\r\n            if (vm.businessPartners == undefined || vm.businessPartners == null){\r\n                return BusinesspartnerService.getBusinessPartners();\r\n            }else{\r\n                return vm.businessPartners;\r\n            }\r\n        };\r\n\r\n\t\tvm.getDialogId = function(customIdentifier){\r\n\t\t\tvar resultId = '#' + vm.dialogId;\r\n\t\t\tif (customIdentifier != undefined){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.getDialogIdWithoutHash = function(customIdentifier){\r\n\t\t\tvar resultId = vm.dialogId;\r\n\t\t\tif (customIdentifier != undefined){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.selectBusinessPartner = function(businessPartner){\r\n\t\t\tvm.callbackPaymentPerson({\r\n\t\t\t\tname: businessPartner.businessPartnerName,\r\n\t\t\t\tid: businessPartner.businessPartnerId,\r\n\t\t\t\ttype: 'BUSINESS_PARTNER'\r\n\t\t\t});\r\n\r\n\t\t\tvm.resetValues();\r\n\t\t};\r\n\r\n\t\tvm.selectUser = function(user){\r\n\r\n\t\t\tif (user.userContactId != undefined && user.userContactId != null){\r\n\t\t\t\tvm.callbackPaymentPerson({\r\n\t\t\t\t\tname: user.contactName,\r\n\t\t\t\t\tid: user.userContactId,\r\n\t\t\t\t\ttype: 'CONTACT',\r\n\t\t\t\t\tvirtualType: 'USER'\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tvm.callbackPaymentPerson({\r\n\t\t\t\t\tname: user.contactName,\r\n\t\t\t\t\tid: user.appUserId,\r\n\t\t\t\t\ttype: 'USER'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvm.resetValues();\r\n\t\t};\r\n\r\n\t\tvm.selectUserContact = function(userContact){\r\n\t\t\tvm.callbackPaymentPerson({\r\n\t\t\t\tname: userContact.contactName,\r\n\t\t\t\tid: userContact.userContactId,\r\n\t\t\t\ttype: 'CONTACT'\r\n\t\t\t});\r\n\t\t\tvm.resetValues();\r\n\t\t};\r\n\r\n\t\tvm.selectProject = function(project){\r\n\t\t\tvm.callbackPaymentPerson({\r\n\t\t\t\tname: project.contactName,\r\n\t\t\t\tid: project.userContactId,\r\n\t\t\t\ttype: 'CONTACT'\r\n\t\t\t});\r\n\t\t\tvm.resetValues();\r\n\t\t};\r\n\r\n        vm.selectNone = function(){\r\n            vm.callbackPaymentPerson(null);\r\n\t\t\tvm.resetValues();\r\n        };\r\n\r\n\t\tvm.searchFilterForBusinessPartners = function() {\r\n\t\t\tvar searchMatch = (vm.businessPartnerSearch ? new RegExp(\".*\" + vm.businessPartnerSearch + \".*\", 'i') : null);\r\n\t\t\treturn function(item) {\r\n\t\t\t\tif (searchMatch && !searchMatch.test(item.businessPartnerName)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvm.searchFilterForUsers = function() {\r\n\t\t\tvar searchMatch = (vm.usersSearch ? new RegExp(\".*\" + vm.usersSearch + \".*\", 'i') : null);\r\n\t\t\treturn function(item) {\r\n\t\t\t\tif (searchMatch && !searchMatch.test(item.contactName)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvm.searchFilterForUserContacts = function() {\r\n\t\t\tvar searchMatch = (vm.userContactsSearch ? new RegExp(\".*\" + vm.userContactsSearch + \".*\", 'i') : null);\r\n\t\t\treturn function(item) {\r\n\t\t\t\tif (searchMatch && !searchMatch.test(item.contactName)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvm.searchFilterForProjects = function() {\r\n\t\t\tvar searchMatch = (vm.projectsSearch ? new RegExp(\".*\" + vm.projectsSearch + \".*\", 'i') : null);\r\n\t\t\treturn function(item) {\r\n\t\t\t\tif (searchMatch && !searchMatch.test(item.contactName)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tvm.resetValues = function() {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tvm.businessPartnerInput = \"\";\r\n\t\t\t\t\tvm.userContactsSearch = \"\";\r\n\t\t\t\t\tvm.projectsSearch = \"\";\r\n\t\t\t\t\tvm.usersSearch = \"\";\r\n\r\n\t\t\t\t\tBusinesspartnerService.search('');\r\n\t\t\t\t\tUsercontactService.searchForUser('');\r\n\t\t\t\t}\r\n\t\t\t\t, 1000);\r\n\t\t};\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp.msSearchConfiguration',[])\r\n\t\t.directive('msSearchConfiguration', msSearchConfiguration);\r\n\r\n    msSearchConfiguration.$inject = ['$document','$log', '_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction msSearchConfiguration($document,$log, _) {\r\n\t\tvar directive = {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplateUrl: 'app/components/ms-search-configuration.html',\r\n\t\t\tscope: {\r\n                startSearch: '=msStartSearch'\r\n\t\t\t},\r\n\t\t\tlink: link,\r\n\t\t\tcontroller: SearchConfigurationController,\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true\r\n\t\t};\r\n\r\n\t\treturn directive;\r\n\r\n\t\tfunction link(scope, element, attrs, vm) {\r\n\r\n\t\t}\r\n\t}\r\n\r\n    SearchConfigurationController.$inject = ['$filter','$timeout','$log','SearchService','CostdistributionService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction SearchConfigurationController($filter,$timeout,$log,SearchService,CostdistributionService,_) {\r\n\t\tvar vm = this;\r\n\r\n        vm.payerPersonSearchConfiguration = 'payerPersonSearchConfiguration' + Math.floor(Math.random() * (10000000 - 1)) + 1;\r\n\t\tvm.paymentRecipientPersonSearchConfiguration = 'paymentRecipientPersonSearchConfiguration' + Math.floor(Math.random() * (10000000 - 1)) + 1;\r\n\t\tvm.costPayerSearchConfiguration = 'costPayerSearchConfiguration' + Math.floor(Math.random() * (10000000 - 1)) + 1;\r\n        vm.invoiceCategorySearchConfiguration = 'invoiceCategorySearchConfiguration' + Math.floor(Math.random() * (10000000 - 1)) + 1;\r\n\r\n        vm.repetitionTypeEnums = [\r\n            {enumName:null, displayName : 'Keine Auswahl'},\r\n            {enumName:'ONCE', displayName : 'Einmalig'},\r\n            {enumName:'MONTHLY', displayName : 'Monatlich'},\r\n            {enumName:'QUARTER', displayName : 'Vierteljhrlich'},\r\n            {enumName:'HALF_YEAR', displayName : 'Halbjhrlich'},\r\n            {enumName:'ANNUALLY', displayName : 'Jhrlich'}\r\n        ];\r\n\r\n        vm.booleanSelections = [\r\n            {enumName:null, displayName : 'Keine Auswahl'},\r\n            {enumName:true, displayName : 'Ja'},\r\n            {enumName:false, displayName : 'Nein'}\r\n        ];\r\n\r\n        vm.remarksTimeoutRunning = false;\r\n        vm.remarksInput = '';\r\n\r\n        vm.fullTextTimeoutRunning = false;\r\n        vm.fullTextInput = '';\r\n\r\n        vm.remarksInputDone = function(){\r\n            if (vm.remarksTimeoutRunning === false){\r\n                vm.remarksTimeoutRunning = true;\r\n                $timeout(function(){\r\n                    var searchConfiguration = SearchService.getSearchConfiguration();\r\n                    searchConfiguration.remarks = vm.remarksInput;\r\n                    vm.startSearch();\r\n                    vm.remarksTimeoutRunning = false;\r\n                }, 1000);\r\n            }\r\n        };\r\n\r\n        vm.fullTextInputDone = function(){\r\n            if (vm.fullTextTimeoutRunning === false){\r\n                vm.fullTextTimeoutRunning = true;\r\n                $timeout(function(){\r\n                    var searchConfiguration = SearchService.getSearchConfiguration();\r\n                    searchConfiguration.fullText = vm.fullTextInput;\r\n                    vm.startSearch();\r\n                    vm.fullTextTimeoutRunning = false;\r\n                }, 1000);\r\n            }\r\n        };\r\n\r\n        vm.getPayerPersonSelection = function(){\r\n\t\t\tvar searchConfiguration = SearchService.getSearchConfiguration();\r\n\t\t\tif (searchConfiguration.payerPerson !== undefined && searchConfiguration.payerPerson != null){\r\n\t\t\t\treturn searchConfiguration.payerPerson.payerName;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t};\r\n\r\n\t\tvm.getCostDistributions = function(){\r\n        \treturn CostdistributionService.getCostDistributions();\r\n        };\r\n\r\n\t\tvm.repairSearchConfiguration = function(){\r\n\t\t    SearchService.repairSearchConfiguration();\r\n        };\r\n\r\n\t\tvm.updateSearchConfiguration = function(){\r\n            SearchService.getSearchConfiguration();\r\n\r\n        };\r\n\r\n        vm.getPaymentRecipientPersonSelection = function(){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            if (searchConfiguration.paymentRecipientPerson != undefined && searchConfiguration.paymentRecipientPerson != null){\r\n                return searchConfiguration.paymentRecipientPerson.payerName;\r\n            }\r\n\r\n            return null;\r\n        };\r\n\r\n        vm.getCostPayerSelection = function(){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            if (searchConfiguration.costPayer != undefined && searchConfiguration.costPayer != null){\r\n                return searchConfiguration.costPayer.payerName;\r\n            }\r\n\r\n            return null;\r\n        };\r\n\r\n\t\tvm.setPayerPerson = function(payerPerson){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            if (payerPerson != null){\r\n                searchConfiguration.payerPerson = {};\r\n                searchConfiguration.payerPerson.payerId = payerPerson.id;\r\n                searchConfiguration.payerPerson.payerEnum = payerPerson.type;\r\n                searchConfiguration.payerPerson.payerName = payerPerson.name;\r\n            }else{\r\n                searchConfiguration.payerPerson = null;\r\n            }\r\n            vm.startSearch();\r\n\t\t};\r\n\r\n        vm.setPaymentRecipientPerson = function(paymentRecipientPerson){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            if (paymentRecipientPerson != null){\r\n                searchConfiguration.paymentRecipientPerson = {};\r\n                searchConfiguration.paymentRecipientPerson.payerId = paymentRecipientPerson.id;\r\n                searchConfiguration.paymentRecipientPerson.payerEnum = paymentRecipientPerson.type;\r\n                searchConfiguration.paymentRecipientPerson.payerName = paymentRecipientPerson.name;\r\n            }else{\r\n                searchConfiguration.paymentRecipientPerson = null;\r\n            }\r\n            vm.startSearch();\r\n        };\r\n\r\n        vm.setCostPayer = function(costPayer){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            if (costPayer != null){\r\n                searchConfiguration.costPayer = {};\r\n                searchConfiguration.costPayer.payerId = costPayer.id;\r\n                searchConfiguration.costPayer.payerEnum = costPayer.type;\r\n                searchConfiguration.costPayer.payerName = costPayer.name;\r\n            }else{\r\n                searchConfiguration.costPayer = null;\r\n            }\r\n            vm.startSearch();\r\n        };\r\n\r\n        vm.selectInvoiceCategory = function(invoiceCategory){\r\n            var searchConfiguration = SearchService.getSearchConfiguration();\r\n            searchConfiguration.invoiceCategoryDTO = invoiceCategory;\r\n            vm.startSearch();\r\n\t\t};\r\n\r\n        vm.costDistributionItems = function(){\r\n            return CostdistributionService.getCostDistributions();\r\n        };\r\n\r\n\t\tvm.getSearchConfiguration = function(){\r\n\t\t\treturn SearchService.getSearchConfiguration();\r\n\t\t};\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('CostdistributionService', CostdistributionService);\r\n\r\n\tCostdistributionService.$inject = ['$log','$q','$http', 'NotificationService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction CostdistributionService($log,$q,$http, NotificationService) {\r\n\t\tvar base = {\r\n\t\t\t\tinvoices: '/webapp/api/invoices',\r\n\t\t\t\tcostDistribution: '/webapp/api/costdistributions'\r\n\t\t\t},\r\n\t\t\tservice = {\r\n                list: list,\r\n                create: create,\r\n\t\t\t\tremove: remove,\r\n\t\t\t\tgetCostDistributions: getCostDistributions,\r\n                prepareItemForCostDistribution: prepareItemForCostDistribution\r\n\t\t\t},\r\n\t\t\tcostDistributions = [];\r\n\r\n\t\tactivate();\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction getCostDistributions(){\r\n\t\t\treturn costDistributions;\r\n\t\t}\r\n\r\n\t\tfunction activate(){\r\n            list().then(\r\n                function(response) {\r\n                    costDistributions = response.data;\r\n                }\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tfunction list(){\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.costDistribution\r\n\t\t\t});\r\n\t\t}\r\n\r\n        function remove(costDistributionId) {\r\n\r\n            return $q(function(resolve) {\r\n                return $http({\r\n                    method: 'DELETE',\r\n                    url: base.costDistribution + '/' + costDistributionId\r\n                }).then(\r\n                    function(result) {\r\n                        NotificationService.create('Kostenverteilungs-Vorlage wurde gelscht!',5000);\r\n                        resolve(null);\r\n                    },\r\n                    function(result) {\r\n                        $log.warn('Could not delete costdistribution!','result',result);\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function generateUUID(){\r\n            function s4() {\r\n                return Math.floor((1 + Math.random()) * 0x10000)\r\n                    .toString(16)\r\n                    .substring(1);\r\n            }\r\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n                s4() + '-' + s4() + s4() + s4();\r\n        }\r\n\r\n        function prepareItemForCostDistribution(costDistributionItem){\r\n\t\t\tcostDistributionItem.costDistributionItemId = generateUUID();\r\n\t\t\tcostDistributionItem.costDistributionId = null;\r\n\r\n            return costDistributionItem;\r\n        }\r\n\r\n\t\tfunction create(costDistribution, costDistributionItems) {\r\n\r\n\t\t\tcostDistribution.costDistributionItemDTOS = [];\r\n            costDistributionItems.forEach(function(item){\r\n                costDistribution.costDistributionItemDTOS.push(item);\r\n\t\t\t});\r\n\r\n        \tvar url = base.costDistribution + '/complete';\r\n\r\n            return $q(function(resolve) {\r\n                return $http({\r\n                    method: 'POST',\r\n                    url: url,\r\n                    data: costDistribution,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                }).then(\r\n                    function(result) {\r\n                        NotificationService.create('Kostenverteilungs-Vorlage wurde erstellt!',5000);\r\n                        costDistributions.push(result.data);\r\n                        resolve(result.data);\r\n                    },\r\n                    function(result) {\r\n                        $log.warn('Could not create costdistribution!','result',result);\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('CostdistributionitemService', CostdistributionitemService);\r\n\r\n\tCostdistributionitemService.$inject = ['$http'];\r\n\r\n\t/* @ngInject */\r\n\tfunction CostdistributionitemService($http) {\r\n\t\tvar base = {\r\n\t\t\t\tinvoices: '/webapp/api/invoices',\r\n\t\t\t\tcostDistributionItems: '/webapp/api/costdistributionitems'\r\n\t\t\t},\r\n\t\t\tservice = {\r\n\t\t\t\tlistForInvoice: listForInvoice,\r\n\t\t\t\tupdate: update\r\n\t\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction listForInvoice(id){\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.invoices + '/' + id + '/costdistributionitems'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction update(invoiceId,costDistributionItems) {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'PUT',\r\n\t\t\t\turl: base.invoices + '/' + invoiceId + '/costdistributionitems',\r\n\t\t\t\tdata: costDistributionItems,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('DashboardController', DashboardController);\r\n\r\n\tDashboardController.$inject = ['$state'];\r\n\r\n\t/* @ngInject */\r\n\tfunction DashboardController($state) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'DashboardController';\r\n\r\n\t\tactivate();\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction activate() {\r\n\t\t\t$state.go('invoices.list');\r\n\t\t}\r\n\t}\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('FileAnalysesController', FileAnalysesController);\r\n\r\n\tFileAnalysesController.$inject = ['FileUploader','$state','$timeout','NotificationService','InvoiceService','SearchService','csrfToken'];\r\n\r\n\t/* @ngInject */\r\n\tfunction FileAnalysesController(FileUploader,$state, $timeout,NotificationService, InvoiceService, SearchService, csrfToken) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'FileAnalysesController';\r\n\r\n\t\tvar uploader = vm.uploader = new FileUploader({\r\n\t\t\turl: '/webapp/api/service/upload/' + generateUUID(),\r\n\t\t\theaders : {},\r\n\t\t\talias: 'fileUpload'\r\n\t\t});\r\n\t\t\r\n\t\tvar csrf_token = getCookie(csrfToken);\r\n\t\tuploader.headers[csrfToken] = csrf_token;\r\n\r\n\t\t// FILTERS\r\n\r\n\t\t// a sync filter\r\n\t\tuploader.filters.push({\r\n\t\t\tname: 'syncFilter',\r\n\t\t\tfn: function(item /*{File|FileLikeObject}*/, options) {\r\n\t\t\t\tconsole.log('syncFilter');\r\n\t\t\t\treturn this.queue.length < 40;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// an async filter\r\n\t\t// uploader.filters.push({\r\n\t\t// \tname: 'asyncFilter',\r\n\t\t// \tfn: function(item /*{File|FileLikeObject}*/, options, deferred) {\r\n\t\t// \t\tconsole.log('asyncFilter');\r\n\t\t// \t\tsetTimeout(deferred.resolve, 1e3);\r\n\t\t// \t}\r\n\t\t// });\r\n\r\n\t\t// CALLBACKS\r\n\r\n\t\tuploader.onWhenAddingFileFailed = function(item /*{File|FileLikeObject}*/, filter, options) {\r\n\t\t\tconsole.info('onWhenAddingFileFailed', item, filter, options);\r\n\t\t};\r\n\t\tuploader.onAfterAddingFile = function(fileItem) {\r\n\t\t\tconsole.info('onAfterAddingFile', fileItem);\r\n\t\t};\r\n\t\tuploader.onAfterAddingAll = function(addedFileItems) {\r\n\t\t\tconsole.info('onAfterAddingAll', addedFileItems);\r\n\t\t};\r\n\t\tuploader.onBeforeUploadItem = function(item) {\r\n            item.url = '/webapp/api/service/upload/' + generateUUID();\r\n\t\t\tconsole.info('onBeforeUploadItem', item);\r\n\t\t};\r\n\t\tuploader.onProgressItem = function(fileItem, progress) {\r\n\t\t\tconsole.info('onProgressItem', fileItem, progress);\r\n\t\t};\r\n\t\tuploader.onProgressAll = function(progress) {\r\n\t\t\tconsole.info('onProgressAll', progress);\r\n\t\t};\r\n\t\tuploader.onSuccessItem = function(fileItem, response, status, headers) {\r\n\t\t\tNotificationService.create('Datei erfolgreich hochgeladen!',5000);\r\n\t\t\tconsole.info('onSuccessItem', fileItem, response, status, headers);\r\n\t\t};\r\n\t\tuploader.onErrorItem = function(fileItem, response, status, headers) {\r\n\t\t\tNotificationService.create('Fehler beim Upload! Ist die Datei beschdigt?',5000);\r\n\t\t\tconsole.info('onErrorItem', fileItem, response, status, headers);\r\n\t\t};\r\n\t\tuploader.onCancelItem = function(fileItem, response, status, headers) {\r\n\t\t\tconsole.info('onCancelItem', fileItem, response, status, headers);\r\n\t\t};\r\n\t\tuploader.onCompleteItem = function(fileItem, response, status, headers) {\r\n\t\t\tconsole.info('onCompleteItem', fileItem, response, status, headers);\r\n\t\t};\r\n\t\tuploader.onCompleteAll = function() {\r\n\t\t\tNotificationService.create('Datei(en) erfolgreich hochgeladen! Sie wird/werden nun im Hintergrund analysiert...',5000);\r\n\t\t\tSearchService.resetSearchConfiguration();\r\n\t\t\tInvoiceService.setSearchMode(false);\r\n\t\t\tInvoiceService.allInvoices();\r\n\t\t\t$timeout(function(){\r\n\t\t\t\t$state.go('invoices.list');\r\n\t\t\t}, 2000);\r\n\r\n\t\t\tconsole.info('onCompleteAll');\r\n\t\t};\r\n\r\n\t\tconsole.info('uploader', uploader);\r\n\r\n\t\tfunction generateUUID(){\r\n\t\t\tfunction s4() {\r\n\t\t\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t\t\t.toString(16)\r\n\t\t\t\t\t.substring(1);\r\n\t\t\t}\r\n\t\t\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n\t\t\t\ts4() + '-' + s4() + s4() + s4();\r\n\t\t}\r\n\r\n\t\tfunction getCookie(cname) {\r\n\t\t\tvar name = cname + \"=\";\r\n\t\t\tvar decodedCookie = decodeURIComponent(document.cookie);\r\n\t\t\tvar ca = decodedCookie.split(';');\r\n\t\t\tfor(var i = 0; i <ca.length; i++) {\r\n\t\t\t\tvar c = ca[i];\r\n\t\t\t\twhile (c.charAt(0) == ' ') {\r\n\t\t\t\t\tc = c.substring(1);\r\n\t\t\t\t}\r\n\t\t\t\tif (c.indexOf(name) == 0) {\r\n\t\t\t\t\treturn c.substring(name.length, c.length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('InvoicecategoriesService', InvoicecategoriesService);\r\n\r\n\tInvoicecategoriesService.$inject = ['$http', '$q'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoicecategoriesService($http, $q) {\r\n\t\tvar base = {\r\n\t\t\t\tinvoicecategories: '/webapp/api/invoicecategories',\r\n\t\t\t\tautoAttributes: '/autoAttributes'\r\n\t\t\t},\r\n\t\t\tservice = {\r\n\t\t\t\tlist: list,\r\n\t\t\t\tgetOne: getOne,\r\n                getAutoAttributes: getAutoAttributes,\r\n                getInvoiceCategories: getInvoiceCategories,\r\n                getParentInvoiceCategories: getParentInvoiceCategories,\r\n\t\t\t\tcreate: create,\r\n\t\t\t\tremove: remove\r\n\t\t\t},\r\n\t\t\tinvoiceCategories = [],\r\n            categorieParents = [];\r\n\r\n\t\tactivate();\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction activate(){\r\n            list();\r\n\t\t}\r\n\r\n\t\tfunction remove(invoiceCategoryId){\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\treturn $http({\r\n\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\turl: base.invoicecategories + '/' + invoiceCategoryId\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n                        list().then(function(result2){\r\n                            resolve(null);\r\n                        });\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\t$log.warn('Could not delete invoice category!','result',result);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction create(invoiceCategoryNameInput, parentInvoiceCategoryId){\r\n\r\n\t\t\tvar invoiceCategoryDTO = {\r\n\t\t\t\tinvoiceCategoryName: invoiceCategoryNameInput,\r\n\t\t\t\tparentInvoiceCategoryDTO: {\r\n\t\t\t\t\tinvoiceCategoryId: parentInvoiceCategoryId\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\treturn $http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\turl: base.invoicecategories,\r\n\t\t\t\t\tdata: invoiceCategoryDTO,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction (result) {\r\n\t\t\t\t\t\tlist().then(function(result2){\r\n\t\t\t\t\t\t\tresolve(result2.data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getInvoiceCategories(){\r\n\t\t\treturn invoiceCategories;\r\n\t\t}\r\n\r\n        function getParentInvoiceCategories(expenseType){\r\n\r\n\t\t\tif (!expenseType){\r\n\t\t\t\treturn categorieParents;\r\n\t\t\t}\r\n\r\n            return _.filter(categorieParents, function(invoiceCategory){ return (invoiceCategory.invoiceCategoryType === expenseType);});\r\n        }\r\n\r\n\t\tfunction list() {\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: base.invoicecategories\r\n\t\t\t\t}).then(function(result){\r\n\t\t\t\t\tinvoiceCategories = result.data;\r\n\t\t\t\t\tcategorieParents = _.filter(invoiceCategories, function(invoiceCategory){ return (invoiceCategory.parentInvoiceCategoryDTO === null);});\r\n\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getOne(uuid) {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.invoicecategories + '/' + uuid\r\n\t\t\t});\r\n\t\t}\r\n\r\n        function getAutoAttributes(uuid) {\r\n            return $http({\r\n                method: 'GET',\r\n                url: base.invoicecategories + '/' + uuid + base.autoAttributes\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('InvoiceimageService',InvoiceimageService);\r\n\r\n\tInvoiceimageService.$inject = ['$http'];\r\n\r\n\tfunction InvoiceimageService($http) {\r\n\t\tvar base = {\r\n\t\t\t\tinvoiceImages: '/webapp/api/invoices/image'\r\n\t\t\t},\r\n\t\t\tservice = {\r\n\t\t\t\tgetInvoiceImageUrl : getInvoiceImageUrl\r\n\t\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////\r\n\r\n\t\tfunction getInvoiceImageUrl(invoiceImageId) {\r\n\t\t\treturn base.invoiceImages + '/' + invoiceImageId;\r\n\t\t}\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('InvoiceEditController', InvoiceEditController);\r\n\r\n\tInvoiceEditController.$inject = ['$timeout','$filter','$log','csrfToken', 'FileUploader','$state','$stateParams','$scope','InvoiceService','BusinesspartnerService','UsercontactService','CostdistributionitemService','CostdistributioncalculateService','InvoiceimageService','InvoicecategoriesService','CostdistributionService', 'UserService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoiceEditController($timeout,$filter,$log,csrfToken,FileUploader,$state,$stateParams,$scope,InvoiceService,BusinesspartnerService,UsercontactService,CostdistributionitemService,CostdistributioncalculateService,InvoiceimageService,InvoicecategoriesService,CostdistributionService,UserService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'InvoiceEditController';\r\n\r\n\t\tvm.invoice = {};\r\n\t\tvm.invoice.articleDTOs = [];\r\n\t\tvm.createMode = false;\r\n\r\n        vm.mistakeMessage = '';\r\n\r\n        vm.imagePreview = null;\r\n\r\n\t\tvm.uploader = new FileUploader({\r\n\t\t\turl: '/webapp/api/invoices/image' ,\r\n\t\t\theaders : {},\r\n\t\t\talias: 'fileUpload'\r\n\t\t});\r\n\r\n\t\tif ($stateParams.returnView) {\r\n\t\t\tvm.returnView = $stateParams.returnView;\r\n\t\t}else{\r\n\t\t\tvm.returnView = 'invoices.list';\r\n\t\t}\r\n\r\n\t\tif ($stateParams.transactionType) {\r\n\t\t\tvm.invoice.mainFunctionEnum = $stateParams.transactionType;\r\n            vm.createMode = true;\r\n\t\t}else{\r\n\t\t\tvm.invoice.mainFunctionEnum = 'EXPENSE';\r\n\t\t}\r\n\r\n\t\tif ($stateParams.isStandingOrder) {\r\n\t\t\tvm.isStandingOrder = true;\r\n\t\t}else{\r\n\t\t\tvm.isStandingOrder = false;\r\n\t\t}\r\n\r\n\t\tvm.costDistributionItems = [];\r\n\t\tvm.payerName = '';\r\n\t\tvm.paymentRecipientName = '';\r\n\r\n\r\n\t\tvm.currentUser = {};\r\n\r\n\t\tvm.hasInvoiceImageValue = false;\r\n\t\tvm.loadingBarCategory = false;\r\n\r\n\t\tif ($stateParams.invoiceId) {\r\n\t\t\tvm.invoice.invoiceId = $stateParams.invoiceId;\r\n\t\t}\r\n\t\t\r\n\t\tvm.repetionTypeEnums = [];\r\n\t\tvm.paymentTypeEnums = [];\r\n\r\n\t\tvm.userSelectSearch = '';\r\n\r\n\t\tvm.standingOrder = {};\r\n\t\tvm.originalStandingOrder = {};\r\n\t\tvm.costDistributions = [];\r\n        vm.costDistributionsMenu = [];\r\n\r\n        vm.costDistributionsMenuOptions = [];\r\n\r\n        vm.selectedCostDistributionItemForArticleSelection = null;\r\n\r\n\t\tvm.submitForm = function() {\r\n\t\t\tif (!areChanges()){\r\n\t\t\t\tgoToOverview();\r\n\t\t\t}else{\r\n\t\t\t\tif (vm.createMode) {\r\n\t\t\t\t\tcreateInvoice();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tupdateInvoice();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.resetForm = function() {\r\n\t\t\tif (vm.invoice.invoiceId) {\r\n\t\t\t\tgetInvoice();\r\n\t\t\t} else {\r\n\t\t\t\tvm.invoice = {};\r\n\t\t\t}\r\n\r\n\t\t\t$scope.invoiceForm.$setPristine();\r\n\t\t\t$scope.invoiceForm.$setUntouched();\r\n\t\t};\r\n\r\n\t\tvm.repeatAnalysis = function() {\r\n            repeatAnalysis();\r\n\t\t};\r\n\r\n\t\tvm.getInvoice = function() {\r\n\t\t\treturn vm.invoice;\r\n\t\t};\r\n\r\n\t\tvm.addCostDistributionItemToList = function (payer){\r\n\t\t\tvar costDistributionItem = {\r\n\t\t\t\t'costDistributionItemId':generateUUID(),\r\n\t\t\t\t'costDistributionItemTypeEnum':'QUOTA',\r\n\t\t\t\t'position':vm.costDistributionItems.length,\r\n\t\t\t\t'value':1.0,\r\n\t\t\t\t'costPaid':0,\r\n\t\t\t\t'invoiceId':vm.invoice.invoiceId,\r\n                'payerId': payer.id,\r\n\t\t\t\t'paymentPersonName':payer.name,\r\n\t\t\t\t'paymentPersonTypeEnum':payer.type,\r\n\t\t\t\t'payerDTO':{\r\n\t\t\t\t\t'displayName':payer.name\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (payer.virtualType != undefined && payer.virtualType === 'USER'){\r\n                costDistributionItem.correctionStatus = 'CHECK'\r\n\t\t\t}else if (payer.type === 'CONTACT'){\r\n                costDistributionItem.correctionStatus = 'READY'\r\n            }else{\r\n                costDistributionItem.correctionStatus = 'IGNORE'\r\n            }\r\n\r\n\t\t\tvm.costDistributionItems.push(costDistributionItem);\r\n\r\n\t\t\tvm.updateCostDistributionItems();\r\n\t\t};\r\n\t\t\r\n\t\tvm.isReadOnlyMode = function(){\r\n\t\t\tif (vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_CHECK_MODE' || vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_READY_MODE')\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\tvm.generateStandingOrder = function (){\r\n\t\t\tInvoiceService.generateStandingOrder(vm.standingOrder, true);\r\n\t\t};\r\n\r\n\t\tvm.selectInvoiceCategory = function (invoiceCategory){\r\n\t\t\tvm.invoice.invoiceCategoryDTO = invoiceCategory;\r\n\r\n\t\t\tgetAttributesForCategory(vm.invoice.invoiceCategoryDTO.invoiceCategoryId);\r\n\t\t};\r\n\r\n\t\tvm.updateCostDistributionItems = function(){\r\n\t\t\tif (vm.invoice.sumOfInvoice != null && vm.invoice.sumOfInvoice != undefined){\r\n\t\t\t\tvm.costDistributionItems.forEach(function(item){\r\n\t\t\t\t\titem.moneyValue = CostdistributioncalculateService.calculateAmountForCostDistributionItemPrecise(item, vm.costDistributionItems, vm.invoice.sumOfInvoice);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.resetInvoice = function(){\r\n\t\t\tvm.costDistributionItems = angular.copy(vm.originalCostDistributionItems);\r\n\t\t\tvm.invoice = angular.copy(vm.originalInvoice);\r\n\r\n\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\tvm.standingOrder = angular.copy(vm.originalStandingOrder);\r\n\t\t\t}\r\n\r\n\t\t\trefreshInvoiceData();\r\n\t\t};\r\n\r\n\t\tvm.paymentRecipientTransfer = function (payer){\r\n            if (payer != null){\r\n                vm.invoice.paymentRecipientId = payer.id;\r\n                vm.invoice.paymentRecipientTypeEnum = payer.type;\r\n                vm.paymentRecipientName = payer.name;\r\n\r\n                if (payer.virtualType != undefined && payer.virtualType === 'USER'){\r\n                    vm.invoice.correctionStatus = 'CHECK'\r\n                }else if (payer.type === 'CONTACT'){\r\n                    vm.invoice.correctionStatus = 'READY'\r\n                }else{\r\n                    vm.invoice.correctionStatus = 'IGNORE'\r\n                }\r\n\r\n                if (payer.type === 'BUSINESS_PARTNER'){\r\n                    getCategoryForBusinessPartner(payer.id);\r\n                }\r\n            }else{\r\n                vm.invoice.paymentRecipientId = null;\r\n                vm.invoice.paymentRecipientTypeEnum = null;\r\n                vm.paymentRecipientName = null;\r\n            }\r\n\t\t};\r\n\r\n\t\tvm.showDialog = function(id){\r\n\t\t\t$(vm.getDialogId(id)).modal('show');\r\n\t\t};\r\n\r\n\t\tvm.updateCostDistributionItemDirectiveExec = function(id){\r\n\t\t\t$log.info(id);\r\n\t\t\t$log.info(vm.updateCostDistributionItemDirective);\r\n\t\t\tvm.updateCostDistributionItemDirective[id]();\r\n\t\t};\r\n\r\n\t\tvm.payerTransfer = function (payer){\r\n\t\t\tif (payer != null){\r\n                vm.invoice.payerId = payer.id;\r\n                vm.invoice.payerTypeEnum = payer.type;\r\n                vm.payerName = payer.name;\r\n\r\n\r\n                if (payer.virtualType != undefined && payer.virtualType === 'USER'){\r\n                    vm.invoice.correctionStatus = 'CHECK'\r\n                }else if (payer.type === 'CONTACT'){\r\n                    vm.invoice.correctionStatus = 'READY'\r\n                }else{\r\n                    vm.invoice.correctionStatus = 'IGNORE'\r\n                }\r\n\r\n                if (payer.type === 'BUSINESS_PARTNER'){\r\n                    getCategoryForBusinessPartner(payer.id);\r\n                }\r\n\t\t\t}else{\r\n                vm.invoice.payerId = null;\r\n                vm.invoice.payerTypeEnum = null;\r\n                vm.payerName = null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.remove = function() {\r\n\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\tvm.removeInvoiceTemplate();\r\n\t\t\t}else{\r\n\t\t\t\tvm.removeInvoice();\r\n\t\t\t}\r\n\t\t};\r\n\r\n        vm.removeImage = function() {\r\n\t\t\tvm.invoice.invoiceImageId = null;\r\n\t\t\tvm.hasInvoiceImage();\r\n\t\t\tvm.invoice.articleDTOs = [];\r\n\t\t\tvm.imagePreview = undefined;\r\n\t\t\tvm.uploader.clearQueue();\r\n        };\r\n\r\n\t\tvm.getDialogId = function(customIdentifier){\r\n\t\t\tvar resultId = '#';\r\n\t\t\tif (customIdentifier != undefined){\r\n\t\t\t\tresultId = resultId + customIdentifier;\r\n\t\t\t}\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.getDialogIdWithoutHash = function(customIdentifier){\r\n\t\t\tvar resultId = customIdentifier;\r\n\t\t\treturn resultId;\r\n\t\t};\r\n\r\n\t\tvm.showArticlesInvoiceDialog = function() {\r\n\t\t\tvm.showArticlesDialogForInvoice = true;\r\n\t\t\t$('#articlesModalDialogForInvoice').modal('show');\r\n\t\t};\r\n\r\n\t\tvm.hideArticlesInvoiceDialog = function() {\r\n\t\t\t$('#articlesModalDialogForInvoice').modal('hide');\r\n\t\t\tvm.showArticlesDialogForInvoice = false;\r\n\t\t};\r\n\r\n        vm.selectArticleInvoiceData = function(){\r\n            if (vm.showPaymentRecipient()){\r\n                return { username: vm.paymentRecipientName,\r\n\t\t\t\t\tinvoiceId: vm.invoice.invoiceId,\r\n\t\t\t\t\tarticles: vm.invoice.articleDTOs,\r\n\t\t\t\t\timageUrl: vm.getInvoiceImageUrl()};\r\n            }else if (vm.showPayer()){\r\n                return { username: vm.payerName,\r\n                    invoiceId: vm.invoice.invoiceId,\r\n                    articles: vm.invoice.articleDTOs,\r\n                    imageUrl: vm.getInvoiceImageUrl()};\r\n\t\t\t}\r\n        };\r\n\r\n        vm.callbackForArticlesSelectInvoice = function(articles, sum) {\r\n        \tvm.invoice.articleDTOs = articles;\r\n        \tvm.invoice.sumOfInvoice = sum;\r\n\r\n            vm.updateCostDistributionItems();\r\n\t\t\tvm.hideArticlesInvoiceDialog();\r\n\t\t};\r\n\r\n        vm.selectArticleCostDistributionItem = function(costDistributionItem){\r\n\t\t\tvm.selectedCostDistributionItemForArticleSelection = costDistributionItem;\r\n\t\t\tvm.showArticlesDialogForCostDistributionItem = true;\r\n            $('#articlesModalDialogCostDistributionItem').modal('show');\r\n        };\r\n\r\n        vm.hideSelectArticleCostDistributionItemDialog = function() {\r\n\t\t\t$('#articlesModalDialogCostDistributionItem').modal('hide');\r\n\t\t\tvm.showArticlesDialogForCostDistributionItem = false;\r\n\t\t};\r\n\r\n        vm.selectedArticleCostDistributionItemData = function(){\r\n\t\t\treturn { username: vm.selectedCostDistributionItemForArticleSelection.payerDTO.displayName,\r\n\t\t\t\tinvoiceId: vm.invoice.invoiceId,\r\n\t\t\t\tarticles: vm.selectedCostDistributionItemForArticleSelection.articleDTOs,\r\n\t\t\t\timageUrl: vm.getInvoiceImageUrl()};\r\n        };\r\n\r\n        vm.callbackForArticlesSelectCostDistributionItem = function(articles, sum) {\r\n            vm.selectedCostDistributionItemForArticleSelection.articleDTOs = articles;\r\n            vm.selectedCostDistributionItemForArticleSelection.moneyValue = sum;\r\n            vm.selectedCostDistributionItemForArticleSelection.value = sum;\r\n            vm.selectedCostDistributionItemForArticleSelection.costDistributionItemTypeEnum = 'FIXED_AMOUNT';\r\n\r\n            vm.updateCostDistributionItems();\r\n\t\t\tvm.hideSelectArticleCostDistributionItemDialog();\r\n        };\r\n\r\n\t\tvm.showPaymentRecipient = function(){\r\n\t\t\treturn (vm.invoice.mainFunctionEnum === 'EXPENSE' && !vm.invoice.reverseInvoice) || (vm.invoice.mainFunctionEnum !== 'EXPENSE' && vm.invoice.reverseInvoice);\r\n\t\t};\r\n\r\n\t\tvm.showPayer = function(){\r\n\t\t\treturn (vm.invoice.mainFunctionEnum === 'INCOME' && !vm.invoice.reverseInvoice) || (vm.invoice.mainFunctionEnum !== 'INCOME' && vm.invoice.reverseInvoice);\r\n\t\t};\r\n\r\n\t\tvm.removeCostDistributionItemFromList = function(costDistributionItem){\r\n\t\t\tvar indexOfPosition = vm.costDistributionItems.findIndex(function(item){\r\n\t\t\t\treturn item.costDistributionItemId === costDistributionItem.costDistributionItemId;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvm.costDistributionItems.splice(indexOfPosition,1);\r\n\r\n\t\t\tvar sum = vm.invoice.sumOfInvoice;\r\n\r\n            if (vm.costDistributionItems.length === 1){\r\n\r\n                var lastCostDistributionItem = vm.costDistributionItems[0];\r\n\r\n                var futureSumOfCostDistributionItem = CostdistributioncalculateService.calculateAmountForCostDistributionItemPrecise(lastCostDistributionItem, vm.costDistributionItems, vm.invoice.sumOfInvoice);\r\n\r\n                if (futureSumOfCostDistributionItem > sum){\r\n                    var costDistributionItemTypeEnum = lastCostDistributionItem.costDistributionItemTypeEnum;\r\n\r\n                    if ('FIXED_AMOUNT' === costDistributionItemTypeEnum){\r\n                        lastCostDistributionItem.value = sum;\r\n                    }else if ('PERCENT' === costDistributionItemTypeEnum){\r\n                        lastCostDistributionItem.value = 100;\r\n                    }else if ('QUOTA' === costDistributionItemTypeEnum){\r\n                        lastCostDistributionItem.value = 1;\r\n                    }\r\n\r\n                    lastCostDistributionItem.moneyValue = sum;\r\n                }\r\n            }\r\n\r\n\t\t\tvm.updateCostDistributionItems();\r\n\t\t};\r\n\r\n\r\n\r\n\t\tvm.hasInvoiceImage = function(){\r\n\t\t\tvm.hasInvoiceImageValue = !!vm.invoice.invoiceImageId;\r\n\t\t};\r\n\r\n\t\tvm.getInvoiceImageUrl = function(){\r\n\t\t\tif (vm.imagePreview) {\r\n\t\t\t\treturn vm.imagePreview;\r\n\t\t\t}\r\n\r\n\t\t\treturn InvoiceimageService.getInvoiceImageUrl(vm.invoice.invoiceImageId);\r\n\t\t};\r\n\r\n\t\tvm.goToOverview = function() {\r\n\t\t\tgoToOverview();\r\n\t\t};\r\n\r\n        vm.removeInvoice = function() {\r\n            InvoiceService.remove(vm.invoice.invoiceId);\r\n            goToOverview();\r\n        };\r\n\r\n\t\tvm.removeInvoiceTemplate = function() {\r\n\t\t\tInvoiceService.deleteStandingOrder(vm.invoice.invoiceId);\r\n\t\t\tgoToOverview();\r\n\t\t};\r\n\r\n        vm.isNullOrUndefined = function(value){\r\n        \tif (value === null || value === undefined){\r\n        \t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n        vm.setCorrectionStatus = function(correctionStatus) {\r\n        \t(vm.isNullOrUndefined(vm.correctionStatus)) ? vm.correctionStatus = correctionStatus : vm.correctionStatus = null;\r\n        \tupdateInvoice();\r\n        };\r\n\r\n        vm.setCostPaidStatus = function(paymentItem){\r\n            if (!paymentItem.costPaid || paymentItem.costPaid === 0){\r\n                paymentItem.costPaid = paymentItem.moneyValue;\r\n            }else{\r\n                paymentItem.costPaid = 0;\r\n            }\r\n\t\t};\r\n\r\n        vm.setInvoiceCostPaidStatus = function(paymentItem){\r\n            if (!paymentItem.costPaid || paymentItem.costPaid === 0){\r\n                paymentItem.costPaid = paymentItem.sumOfInvoice;\r\n            }else{\r\n                paymentItem.costPaid = 0;\r\n            }\r\n        };\r\n\r\n        vm.showPaymentRecipientPaymentPersonHasPaidButton = function(){\r\n            if (vm.invoice.paymentRecipientTypeEnum != null &&\r\n                (vm.invoice.paymentRecipientTypeEnum === 'CONTACT' || vm.invoice.paymentRecipientTypeEnum === 'USER') &&\r\n                !(vm.invoice.paymentRecipientId === vm.invoice.createdById)){\r\n                return true;\r\n            }else {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        vm.showPayerPaymentPersonHasPaidButton = function(){\r\n            if (vm.invoice.payerTypeEnum != null &&\r\n                (vm.invoice.payerTypeEnum === 'CONTACT' || vm.invoice.payerTypeEnum === 'USER') &&\r\n                !(vm.invoice.payerId === vm.invoice.createdById)){\r\n                return true;\r\n            }else {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        vm.showCostPaymentPersonHasPaidButton = function(costDistributionItem){\r\n            if ((costDistributionItem.paymentPersonTypeEnum != null &&\r\n                (costDistributionItem.paymentPersonTypeEnum === 'CONTACT' || costDistributionItem.paymentPersonTypeEnum === 'USER')) &&\r\n                costDistributionItem.payerId !== vm.invoice.createdById &&\r\n\t\t\t\tvm.invoice.sumOfInvoice !== 0){\r\n                return true;\r\n            }else {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        vm.paymentItemPersonHasPaid = function(paymentItem){\r\n\t\t\tif ((paymentItem.costPaid == null && paymentItem.moneyValue != 0) ||\r\n\t\t\t\t(paymentItem.costPaid != null && paymentItem.costPaid != paymentItem.moneyValue != 0)){\r\n\t\t\t\treturn false;\r\n\t\t\t}else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n        };\r\n\r\n        vm.invoicePaymentItemPersonHasPaid = function(paymentItem){\r\n            if ((paymentItem.costPaid == null && paymentItem.sumOfInvoice != 0) ||\r\n                (paymentItem.costPaid != null && paymentItem.costPaid != paymentItem.sumOfInvoice != 0)){\r\n                return false;\r\n            }else{\r\n                return true;\r\n            }\r\n        };\r\n\r\n\t\tvm.createNewCostDistributionItem = function (){\r\n\r\n\t\t\tvm.costDistributionItems.push({\r\n            'costDistributionItemId':generateUUID(),\r\n            'costDistributionItemTypeEnum':'QUOTA',\r\n            'position':vm.costDistributionItems.length,\r\n            'value':1.0,\r\n            'costPaid':0,\r\n            'invoiceId':vm.invoice.invoiceId,\r\n            'correctionStatus':'READY',\r\n            'payerId' : vm.currentUser.appUserId,\r\n            'payerTypeEnum' : 'USER',\r\n            'paymentPersonName':vm.currentUser.appUserName,\r\n            'paymentPersonTypeEnum':'USER',\r\n            'payerDTO':{\r\n                'displayName':vm.currentUser.appUserName\r\n            }\r\n        });\r\n\r\n\t\t\tvm.updateCostDistributionItems();\r\n\r\n            vm.originalCostDistributionItems = angular.copy(vm.costDistributionItems);\r\n\t\t};\r\n\r\n        vm.correctDateAndRepetitionForStandingOrder = function(){\r\n            var hasChangesInDate = (vm.originalStandingOrder.startDate != vm.standingOrder.startDate);\r\n\r\n            if (hasChangesInDate){\r\n            \tvm.invoice.dateOfInvoice = vm.standingOrder.startDate;\r\n\t\t\t}else{\r\n            \tvm.invoice.dateOfInvoice = vm.originalInvoice.dateOfInvoice;\r\n\t\t\t}\r\n\r\n\t\t\tvm.invoice.repetitionTypeEnum = vm.standingOrder.repetitionTypeEnum;\r\n\t\t};\r\n\r\n        vm.areChanges = function(){\r\n\t\t\treturn areChanges();\r\n\t\t};\r\n\r\n        vm.useCostDistribution = function(costDistribution){\r\n            vm.costDistributionItems = [];\r\n            costDistribution.costDistributionItemDTOS.forEach(function(innerItem){\r\n                var newCostDistributionItem = CostdistributionService.prepareItemForCostDistribution(angular.copy(innerItem));\r\n                vm.costDistributionItems.push(newCostDistributionItem);\r\n            });\r\n\r\n            vm.costDistributionItems.forEach(function(innerItem){\r\n                innerItem.moneyValue = CostdistributioncalculateService.calculateAmountForCostDistributionItemPrecise(innerItem, vm.costDistributionItems, vm.invoice.sumOfInvoice);\r\n                innerItem.invoiceId = vm.invoice.invoiceId;\r\n            });\r\n\t\t};\r\n\r\n        vm.createCostDistributionRequest = function(){\r\n        \tvar tmpCostDistribution = {\r\n        \t\tname: vm.newCostDistributionName\r\n            };\r\n            CostdistributionService.create(tmpCostDistribution, vm.costDistributionItems).then(function(result){\r\n                vm.newCostDistributionName = null;\r\n                vm.costDistributions.push(result);\r\n\t\t\t});\r\n\t\t};\r\n\r\n        vm.removeCostDistribution = function(costDistributionInput){\r\n            CostdistributionService.remove(costDistributionInput.costDistributionId).then(function(result){\r\n                var foundCostDistribution = _.filter(vm.costDistributions, function(costDistribution){ return (costDistribution.costDistributionId === costDistributionInput.costDistributionId);});\r\n                if (foundCostDistribution != null && foundCostDistribution != undefined && foundCostDistribution.length > 0){\r\n                    var foundCostDistributionIndex = _.indexOf(vm.costDistributions, foundCostDistribution[0]);\r\n\r\n                    vm.costDistributions.splice(foundCostDistributionIndex, 1);\r\n                }\r\n\t\t\t})\r\n\t\t};\r\n\r\n        vm.sendMistakeMessage = function(){\r\n        \tInvoiceService.sendMistakeMessage(vm.invoice.invoiceId, vm.mistakeMessage).then(function(result){\r\n                vm.mistakeMessage = '';\r\n\t\t\t});\r\n\t\t};\r\n\r\n        vm.useStandardCostDistribution = function(){\r\n        \tvm.costDistributionItems = [];\r\n\r\n            vm.costDistributionItems.push({\r\n\t\t\t\t'costDistributionItemId':generateUUID(),\r\n\t\t\t\t'costDistributionItemTypeEnum':'QUOTA',\r\n\t\t\t\t'position':vm.costDistributionItems.length,\r\n\t\t\t\t'value':1.0,\r\n\t\t\t\t'costPaid':0,\r\n\t\t\t\t'invoiceId':vm.invoice.invoiceId,\r\n\t\t\t\t'correctionStatus':'READY',\r\n\t\t\t\t'payerId' : vm.currentUser.appUserId,\r\n\t\t\t\t'payerTypeEnum' : 'USER',\r\n\t\t\t\t'paymentPersonName':vm.currentUser.appUserName,\r\n\t\t\t\t'paymentPersonTypeEnum':'USER',\r\n\t\t\t\t'payerDTO':{\r\n\t\t\t\t\t'displayName':vm.currentUser.appUserName\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n            vm.updateCostDistributionItems();\r\n        };\r\n\r\n        vm.deleteConfirmationMenu = [\r\n            ['Lchen besttigen', function ($itemScope, $event, color) {\r\n                vm.remove();\r\n            }]\r\n        ];\r\n\r\n\t\tactivate();\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction areChanges(){\r\n            var isStandingOrderEqual = true;\r\n\r\n            if (vm.imagePreview) {\r\n            \treturn true;\r\n\t\t\t}\r\n\r\n            if (vm.isStandingOrder){\r\n                isStandingOrderEqual = (vm.originalStandingOrder.startDate == vm.standingOrder.startDate && vm.originalStandingOrder.repetitionTypeEnum == vm.standingOrder.repetitionTypeEnum);\r\n            }\r\n            var isAllAnotherEqual = (angular.equals(vm.originalCostDistributionItems, vm.costDistributionItems) && angular.equals(vm.originalInvoice, vm.invoice));\r\n            if ((isStandingOrderEqual && isAllAnotherEqual) || (vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_CHECK_MODE' || vm.invoice.invoiceWorkflowMode === 'EXTERNAL_USER_READY_MODE')){\r\n\t\t\t\treturn false;\r\n            }\r\n            return true;\r\n\t\t}\r\n\r\n\t\tfunction generateUUID(){\r\n\t\t\tfunction s4() {\r\n\t\t\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t\t\t.toString(16)\r\n\t\t\t\t\t.substring(1);\r\n\t\t\t}\r\n\t\t\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n\t\t\t\ts4() + '-' + s4() + s4() + s4();\r\n\t\t}\r\n\r\n\t\tfunction getCurrentUser(todoAfter) {\r\n\t\t\tUserService.currentUser().then(function(result) {\r\n\t\t\t\tvm.currentUser = result;\r\n\r\n\t\t\t\tif (todoAfter != undefined){\r\n\t\t\t\t\ttodoAfter();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction toDoAfterCurrentUserGet(){\r\n\t\t\tvm.createNewCostDistributionItem();\r\n\r\n\t\t\tif (vm.invoice.mainFunctionEnum === 'INCOME'){\r\n\t\t\t\tvm.invoice.paymentRecipientId = vm.currentUser.appUserId;\r\n\t\t\t\tvm.invoice.paymentRecipientTypeEnum = 'USER';\r\n\t\t\t}else{\r\n\t\t\t\tvm.invoice.payerId = vm.currentUser.appUserId;\r\n\t\t\t\tvm.invoice.payerTypeEnum = 'USER';\r\n\t\t\t}\r\n            vm.originalInvoice = angular.copy(vm.invoice);\r\n\t\t}\r\n\r\n\t\tfunction activate() {\r\n\r\n\t\t\tif (vm.invoice.invoiceId) {\r\n\t\t\t\tgetCurrentUser();\r\n\t\t\t\tgetInvoice();\r\n\r\n\r\n\t\t\t}else{\r\n\t\t\t\tvar today = new Date();\r\n\t\t\t\tvm.invoice.dateOfInvoice = today.getTime();\r\n\t\t\t\tvm.invoice.invoiceId = generateUUID();\r\n\t\t\t\tif (vm.isStandingOrder){\r\n                    vm.invoice.invoiceStatusEnum = 'CHECK';\r\n\t\t\t\t}else{\r\n                    vm.invoice.invoiceStatusEnum = 'READY';\r\n\t\t\t\t}\r\n\t\t\t\tvm.invoice.invoiceSource = 'MANUAL';\r\n\t\t\t\tvm.invoice.repetitionTypeEnum = 'ONCE';\r\n\t\t\t\tvm.invoice.paymentTypeEnum = 'NOT_DEFINED';\r\n\t\t\t\tgetCurrentUser(toDoAfterCurrentUserGet);\r\n\t\t\t\tvm.invoice.sumOfInvoice = 0;\r\n\t\t\t\tvm.invoice.costPaid = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvm.uploader = new FileUploader({\r\n\t\t\t\turl: '/webapp/api/invoices/image/' + vm.invoice.invoiceId,\r\n\t\t\t\theaders : {},\r\n\t\t\t\talias: 'fileUpload'\r\n\t\t\t});\r\n\r\n\t\t\tvar csrf_token = getCookie(csrfToken);\r\n\t\t\tvm.uploader.headers[csrfToken] = csrf_token;\r\n\r\n\t\t\tvm.uploader.filters.push({\r\n\t\t\t\tname: 'syncFilter',\r\n\t\t\t\tfn: function(item /*{File|FileLikeObject}*/, options) {\r\n\t\t\t\t\tconsole.log('syncFilter');\r\n\t\t\t\t\treturn this.queue.length < 2;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvm.uploader.onAfterAddingFile = function(fileItem) {\r\n\r\n\t\t\t\tfor(var i = 0; i < vm.uploader.queue.length - 1; i++) {\r\n\t\t\t\t\tvm.uploader.queue[0].remove();\r\n\t\t\t\t}\r\n\t\t\t\tvm.uploader.progress = 0;\r\n\r\n\t\t\t\tconsole.info('onAfterAddingFile', fileItem);\r\n\t\t\t\tvar reader = new FileReader();\r\n\t\t\t\treader.onload = function(){\r\n\t\t\t\t\tvm.imagePreview = reader.result;\r\n\t\t\t\t};\r\n\t\t\t\treader.readAsDataURL(fileItem._file);\r\n\r\n\t\t\t\t$timeout(function(){\r\n\t\t\t\t\tvm.hasInvoiceImage();\r\n\t\t\t\t}, 500);\r\n\r\n\t\t\t\tvm.invoice.invoiceImageId = undefined;\r\n\t\t\t};\r\n\t\t\tvm.uploader.onSuccessItem = function(fileItem, response, status, headers) {\r\n\t\t\t\tconsole.info('onSuccessItem', fileItem, response, status, headers);\r\n\t\t\t\tvm.invoice.invoiceImageId = response.invoiceImageId;\r\n\t\t\t\tvm.originalInvoice.invoiceImageId = response.invoiceImageId;\r\n\t\t\t\tvm.hasInvoiceImage();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tvm.standingOrder.invoiceTemplateId = vm.invoice.invoiceId;\r\n\t\t\tvm.standingOrder.futureInvoiceTemplateId = generateUUID();\r\n\t\t\tgetStandingOrder();\r\n\t\t\tgetRepetitionTypeEnums();\r\n\t\t\tgetPaymentTypeEnums();\r\n\t\t\tgetCostDistributions();\r\n\t\t\thasScanRight();\r\n\t\t}\r\n\r\n\t\tfunction getPaymentPerson(id, type){\r\n\t\t\tif (type === 'BUSINESS_PARTNER'){\r\n\t\t\t\tBusinesspartnerService.getOne(id).then(\r\n\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\tvm.payerName = response.data.businessPartnerName;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}else if (type === 'USER' || type === 'CONTACT' || type === 'PROJECT'){\r\n\t\t\t\tUsercontactService.getOne(id).then(\r\n\t\t\t\t\tfunction(response) {\r\n\t\t\t\t\t\tvm.payerName = response.data.contactName;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar goToOverview = function () {\r\n\t\t\tif (angular.isObject(vm.returnView)){\r\n\t\t\t\t$state.go(vm.returnView.view, vm.returnView.params);\r\n\t\t\t}else{\r\n\t\t\t\t$state.go(vm.returnView);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction refreshInvoiceData(){\r\n\t\t\t// vm.isStandingOrder = false;\r\n\t\t\t// if (vm.invoice.standingOrderInvoiceTemplateId === vm.invoice.invoiceId){\r\n\t\t\t// \tvm.isStandingOrder = true;\r\n\t\t\t// }\r\n\r\n\t\t\tvm.hasInvoiceImage();\r\n\r\n\t\t\tif (vm.invoice.paymentRecipientId != null){\r\n\t\t\t\tvm.paymentRecipientName = vm.invoice.paymentRecipientDTO.displayName;\r\n\t\t\t}\r\n\r\n\t\t\tif (vm.invoice.payerId != null){\r\n\t\t\t\tvm.payerName = vm.invoice.payerDTO.displayName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getInvoice() {\r\n\t\t\tInvoiceService.details(vm.invoice.invoiceId).then(function(response) {\r\n\t\t\t\tvm.invoice = response.data;\r\n\r\n\t\t\t\trefreshInvoiceData();\r\n\r\n\t\t\t\tgetCostDistributionItems();\r\n\r\n\t\t\t\tvm.originalInvoice = angular.copy(vm.invoice);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction createInvoice() {\r\n\t\t\tInvoiceService.create(vm.invoice, vm.costDistributionItems).then(function(result){\r\n\t\t\t\tif (vm.imagePreview) {\r\n\t\t\t\t\tvm.uploader.uploadAll();\r\n\t\t\t\t}\r\n\t\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\t\tInvoiceService.generateStandingOrder(vm.standingOrder, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgoToOverview();\r\n\t\t}\r\n\r\n\t\tfunction updateInvoice() {\r\n\t\t\tInvoiceService.update(vm.invoice, vm.correctionStatus, vm.costDistributionItems).then(function(result){\r\n\t\t\t\tif (vm.imagePreview) {\r\n\t\t\t\t\tvm.uploader.uploadAll();\r\n\t\t\t\t} else if(vm.originalInvoice.invoiceImageId && !vm.invoice.invoiceImageId) {\r\n\t\t\t\t\tInvoiceService.deleteInvoiceImage(vm.invoice.invoiceId);\r\n\t\t\t\t}\r\n\t\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\t\tInvoiceService.updateStandingOrder(vm.invoice.invoiceId, vm.standingOrder);\r\n\t\t\t\t}\r\n\t\t\t});\r\n            goToOverview();\r\n\t\t}\r\n\r\n        function repeatAnalysis() {\r\n            InvoiceService.repeatAnalysis(vm.invoice.invoiceId).then(function(result){\r\n\r\n            });\r\n            goToOverview();\r\n        }\r\n\r\n\t\tfunction getRepetitionTypeEnums() {\r\n\t\t\tInvoiceService.repetitionTypeEnumList().then(function(result) {\r\n\t\t\t\tvm.repetionTypeEnums = result.data;\r\n\r\n\t\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\t\tvar foundRepetionTypeEnum = _.filter(vm.repetionTypeEnums, function(repetionTypeEnum){ return (repetionTypeEnum.name === 'ONCE');});\r\n\t\t\t\t\tif (foundRepetionTypeEnum != null && foundRepetionTypeEnum != undefined && foundRepetionTypeEnum.length > 0){\r\n\t\t\t\t\t\tvar foundRepetionTypeEnumIndex = _.indexOf(vm.repetionTypeEnums, foundRepetionTypeEnum[0]);\r\n\r\n\t\t\t\t\t\tvm.repetionTypeEnums.splice(foundRepetionTypeEnumIndex, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getPaymentTypeEnums() {\r\n\t\t\tInvoiceService.paymentTypeEnumList().then(function(result) {\r\n\t\t\t\tvm.paymentTypeEnums = result.data;\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction getStandingOrder(){\r\n\t\t\tif (vm.isStandingOrder){\r\n\t\t\t\t$timeout(function(){\r\n\t\t\t\t\tInvoiceService.getStandingOrder(vm.invoice.invoiceId).then(function(result){\r\n\t\t\t\t\t\tvm.standingOrder.repetitionTypeEnum = result.repetitionTypeEnum;\r\n\t\t\t\t\t\tvm.standingOrder.startDate = result.startDate;\r\n\r\n\t\t\t\t\t\tvm.originalStandingOrder = angular.copy(vm.standingOrder);\r\n\t\t\t\t\t}, function(response){\r\n\t\t\t\t\t\tvm.standingOrder.startDate = new Date().getTime();\r\n\t\t\t\t\t\tvm.standingOrder.repetitionTypeEnum = 'MONTHLY';\r\n\t\t\t\t\t\tvm.originalStandingOrder = {\r\n\t\t\t\t\t\t\trepetitionTypeEnum: vm.standingOrder.repetitionTypeEnum,\r\n\t\t\t\t\t\t\tstartDate: vm.standingOrder.startDate\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tvm.invoice.repetitionTypeEnum = vm.standingOrder.repetitionTypeEnum;\r\n\t\t\t\t\t\tvm.originalInvoice.repetitionTypeEnum = vm.standingOrder.repetitionTypeEnum;\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 400);\r\n\t\t\t}else{\r\n\t\t\t\tvm.originalStandingOrder = angular.copy(vm.standingOrder);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        function getCategoryForBusinessPartner(businessPartnerId) {\r\n\t\t\tvm.loadingBarCategory = true;\r\n            return BusinesspartnerService.getAutoCategory(businessPartnerId).then(function(result) {\r\n                vm.invoice.invoiceCategoryDTO = result.data;\r\n\t\t\t\tvm.loadingBarCategory = false;\r\n\r\n                getAttributesForCategory(vm.invoice.invoiceCategoryDTO.invoiceCategoryId);\r\n\r\n            },function(result) {\r\n\t\t\t\tvm.invoice.invoiceCategoryDTO = null;\r\n\t\t\t\tvm.loadingBarCategory = false;\r\n\r\n\t\t\t});\r\n        }\r\n\r\n        function getAttributesForCategory(invoiceCategoryId) {\r\n\r\n            InvoicecategoriesService.getAutoAttributes(invoiceCategoryId).then(function(result) {\r\n\r\n                var costDistributionItems = result.data['costDistributionItems'];\r\n\t\t\t\tif (costDistributionItems != null && costDistributionItems != undefined){\r\n\t\t\t\t\tvm.costDistributionItems = costDistributionItems;\r\n\r\n                    vm.costDistributionItems.forEach(function(item){\r\n                        item.moneyValue = CostdistributioncalculateService.calculateAmountForCostDistributionItemPrecise(item, vm.costDistributionItems, vm.invoice.sumOfInvoice);\r\n\t\t\t\t\t\titem.costDistributionItemId = generateUUID();\r\n\t\t\t\t\t\titem.costDistributionId = null;\r\n                        item.invoiceId = vm.invoice.invoiceId;\r\n                    });\r\n\t\t\t\t}\r\n\r\n                var repetitionTypeEnum = result.data['repetitionTypeEnum'];\r\n                if (repetitionTypeEnum != null && repetitionTypeEnum != undefined){\r\n                    vm.invoice.repetitionTypeEnum = repetitionTypeEnum;\r\n                }\r\n\r\n                var specialType = result.data['isSpecialType'];\r\n                if (specialType != null && specialType != undefined){\r\n                    vm.invoice.specialType = specialType;\r\n                }\r\n\r\n            });\r\n        }\r\n\r\n\t\tfunction getCostDistributionItems(){\r\n\t\t\tCostdistributionitemService.listForInvoice(vm.invoice.invoiceId).then(\r\n\t\t\t\tfunction(response) {\r\n\t\t\t\t\tvm.costDistributionItems = response.data;\r\n\r\n\t\t\t\t\tvm.originalCostDistributionItems = angular.copy(vm.costDistributionItems);\r\n\t\t\t\t}, function(error){\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n        function getCostDistributions(){\r\n            vm.costDistributions = CostdistributionService.getCostDistributions();\r\n        }\r\n\r\n\t\tfunction hasScanRight(){\r\n\r\n\t\t\tUserService.hasUserRight('OCR').then(function(result) {\r\n\t\t\t\tvm.hasScanRight = result;\r\n\t\t\t});\r\n\t\t}\r\n\r\n        function getCookie(cname) {\r\n            var name = cname + \"=\";\r\n            var decodedCookie = decodeURIComponent(document.cookie);\r\n            var ca = decodedCookie.split(';');\r\n            for(var i = 0; i <ca.length; i++) {\r\n                var c = ca[i];\r\n                while (c.charAt(0) == ' ') {\r\n                    c = c.substring(1);\r\n                }\r\n                if (c.indexOf(name) == 0) {\r\n                    return c.substring(name.length, c.length);\r\n                }\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('InvoiceListController', InvoiceListController);\r\n\r\n\tInvoiceListController.$inject = ['$log','$scope','$filter','$state','$stateParams','InvoiceService', 'SearchService', 'NotificationService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoiceListController($log, $scope,$filter,$state,$stateParams,InvoiceService, SearchService, NotificationService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'InvoiceListController';\r\n\t\tvm.showCheckList = false;\r\n\t\tvm.showReadyList = false;\r\n\t\tvm.isLoadingReadyList = false;\r\n\r\n\t\tvm.toggleFilter = false;\r\n\r\n\t\tvm.selected = [];\r\n\r\n\t\tvm.goToInvoice = function(invoice) {\r\n\t\t\tif (invoice.invoiceStatusEnum !== 'ANALYZING'){\r\n\t\t\t\t$state.go('^.details', {\r\n\t\t\t\t\tinvoiceId: invoice.invoiceId\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tNotificationService.create('Rechnung wird gerade analysiert! Bitte warten!',3000);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.setViewMode = function(viewMode){\r\n\t\t\tInvoiceService.setViewMode(viewMode);\r\n\t\t};\r\n\r\n\t\tvm.getInvoices = function(mode){\r\n\t\t\tvar invoices = InvoiceService.getInvoices(mode);\r\n\t\t\treturn invoices;\r\n\t\t};\r\n\r\n\t\tvm.viewMode = function(viewInput){\r\n\t\t\tvar view = InvoiceService.getViewMode();\r\n\r\n\t\t\tif (view === viewInput){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\r\n\t\t\t// if ((InvoiceService.invoiceListCheck == undefined || InvoiceService.invoiceListCheck.length == 0) && (InvoiceService.invoiceListReady != undefined && InvoiceService.invoiceListReady.length > 0)){\r\n\t\t\t// \tvm.showCheckList = false;\r\n\t\t\t// \tvm.showReadyList = true;\r\n\t\t\t// }\r\n\t\t\t//\r\n\t\t\t// if (view != undefined){\r\n\t\t\t// \tif (view != null){\r\n\t\t\t// \t\tif (view === 'CHECK'){\r\n\t\t\t// \t\t\tvm.showCheckList = true;\r\n\t\t\t// \t\t\tvm.showReadyList = false;\r\n\t\t\t// \t\t}else if (view === 'READY'){\r\n\t\t\t// \t\t\tvm.showCheckList = false;\r\n\t\t\t// \t\t\tvm.showReadyList = true;\r\n\t\t\t// \t\t}\r\n\t\t\t// \t}\r\n\t\t\t// }else{\r\n\t\t\t// \tInvoiceService.viewMode = 'CHECK';\r\n\t\t\t// \tvm.showCheckList = true;\r\n\t\t\t// \tvm.showReadyList = false;\r\n\t\t\t// }\r\n\t\t};\r\n\r\n\t\tvm.getIsScrollingDisabled = function(){\r\n\t\t\treturn InvoiceService.getIsScrollingDisabled();\r\n\t\t};\r\n\r\n        vm.toggleFilterView = function(){\r\n        \tvm.toggleFilter = !vm.toggleFilter;\r\n\t\t};\r\n\r\n\t\tvm.toggleExportView = function(){\r\n\t\t\tvm.showCsvExport = !vm.showCsvExport;\r\n\t\t\tif (vm.showCsvExport){\r\n\t\t\t\tvm.toggleFilter = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.getCsvExportUrl = function() {\r\n\t\t\tvar jsonString = JSON.stringify(SearchService.getSearchConfiguration());\r\n\t\t\tvar objJsonB64 = btoa(jsonString);\r\n\r\n\t\t\treturn '/webapp/api/export/withFilter/export.csv?invoiceStatusEnum='+ InvoiceService.getViewMode() + '&filter=' + objJsonB64;\r\n\t\t};\r\n\r\n        vm.setCorrectionStatusForSelection = function(){\r\n        \tInvoiceService.updateCorrectionStatus(vm.selected, 'READY').then(function(result){\r\n        \t\tvm.selected = [];\r\n\t\t\t})\r\n\t\t};\r\n\r\n        vm.startSearch = function(){\r\n\t\t\tvm.refreshInvoiceList();\r\n        };\r\n\r\n        vm.invoiceServiceLoading = function(){\r\n\t\t\treturn InvoiceService.isLoading();\r\n\t\t};\r\n\t\t\r\n\t\tvm.refreshInvoices = function(){\r\n\t\t\tSearchService.resetSearchConfiguration();\r\n\r\n\t\t\tvm.refreshInvoiceList();\r\n\t\t};\r\n\r\n\t\tvm.refreshInvoiceList = function(){\r\n\t\t\tInvoiceService.clearCurrentPageReadyList();\r\n\t\t\tInvoiceService.clearCurrentPageCheckList();\r\n\r\n\t\t\tInvoiceService.setSearchMode(false);\r\n\t\t\tInvoiceService.setIsScrollingDisabled(true);\r\n\t\t\tInvoiceService.allInvoices().then(function(){\r\n\t\t\t\tif (!InvoiceService.getIsScrollingDisabled()){\r\n\t\t\t\t\t$scope.$emit('readyList:filtered');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\t\r\n\t\tvm.showMoreReadyList = function(){\r\n\t\t\tif (!InvoiceService.isSearchMode() && !InvoiceService.getIsScrollingDisabled() && InvoiceService.getViewMode() === 'READY'){\r\n                vm.isLoadingReadyList = true;\r\n\t\t\t\t$log.warn('Invoice list showMoreReadyList');\r\n\t\t\t\tInvoiceService.setIsScrollingDisabled(true);\r\n                InvoiceService.addValueToCurrentPageReadyList();\r\n                InvoiceService.readyInvoicesList().then(function (resolve) {\r\n                    vm.isLoadingReadyList = false;\r\n                }, function (resolve) {\r\n                    vm.isLoadingReadyList = false;\r\n                });;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.showMoreCheckList = function(){\r\n            if (!InvoiceService.isSearchMode()){\r\n                InvoiceService.addValueToCurrentPageCheckList();\r\n                InvoiceService.checkInvoicesList();\r\n            }\r\n\t\t};\r\n\r\n\t\tvm.newExpense = function(){\r\n\t\t\t$state.go('^.create', {\r\n\t\t\t\ttransactionType: 'EXPENSE'\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.newIncome = function(){\r\n\t\t\t$state.go('^.create', {\r\n\t\t\t\ttransactionType: 'INCOME'\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.newFileAnalysis = function(){\r\n\t\t\t$state.go('fileanalyses.upload');\r\n\t\t};\r\n\r\n\t\tvm.otherMenuOptions = [\r\n            ['Einnahme', function ($itemScope, $event, color) {\r\n                vm.newIncome();\r\n\t\t\t}],['Ausgabe', function ($itemScope, $event, color) {\r\n\t\t\t\tvm.newExpense();\r\n\t\t\t}]\r\n        ];\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('InvoiceService', InvoiceService);\r\n\r\n\tInvoiceService.$inject = ['$log','$http','$q','CostdistributionitemService','NotificationService','SearchService','_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction InvoiceService($log, $http, $q, CostdistributionitemService,NotificationService,SearchService, _) {\r\n\t\tvar base = {\r\n\t\t\t\tinvoices: '/webapp/api/invoices',\r\n\t\t\t\tinvoicesWithFilterBean: '/webapp/api/search/withFilterBean',\r\n                invoiceImages: '/webapp/api/invoices/image',\r\n\t\t\t\tstandingOrders: '/webapp/api/standingOrders',\r\n\t\t\t\tstandingOrderInvoiceTemplates: '/webapp/api/standingOrders/invoiceTemplates',\r\n\t\t\t\tdeleteStandingOrders: '/webapp/api/standingOrders/deleteByInvoiceTemplate',\r\n                invoiceAnalysis: '/webapp/api/service/upload'\r\n\t\t\t},\r\n\t\t\tinvoiceListCheck = [],\r\n\t\t\tinvoiceListReady = [],\r\n\t\t\tinvoiceListReadyRaw = [],\r\n\t\t\tviewMode = 'CHECK',\r\n\t\t\tinvoiceListStandingOrder = [],\r\n\t\t\tisLoadingValue = false,\r\n\t\t\tcurrentPageReadyList = 0,\r\n\t\t\tcurrentPageCheckList = 0,\r\n\t\t\tuseSearchMode = false,\r\n\t\t\tisScrollingDisabled = true,\r\n\t\t\tservice = {\r\n\t\t\t\tlist: list,\r\n\t\t\t\tcreate: create,\r\n\t\t\t\tdetails: details,\r\n\t\t\t\tupdate: update,\r\n\t\t\t\tremove: remove,\r\n                sendMistakeMessage: sendMistakeMessage,\r\n\t\t\t\tdeleteInvoiceImage: deleteInvoiceImage,\r\n\t\t\t\trepetitionTypeEnumList: repetitionTypeEnumList,\r\n\t\t\t\tpaymentTypeEnumList: paymentTypeEnumList,\r\n\t\t\t\tgetInvoices: getInvoices,\r\n\t\t\t\tgetIsScrollingDisabled: getIsScrollingDisabled,\r\n\t\t\t\tsetIsScrollingDisabled: setIsScrollingDisabled,\r\n\t\t\t\tgetInvoicesReadyRawList: getInvoicesReadyRawList,\r\n                setInvoices: setInvoices,\r\n\t\t\t\tisLoading: isLoading,\r\n                setIsLoading: setIsLoading,\r\n\t\t\t\tgenerateStandingOrder: generateStandingOrder,\r\n\t\t\t\tdeleteStandingOrder: deleteStandingOrder,\r\n\t\t\t\tupdateStandingOrder: updateStandingOrder,\r\n\t\t\t\tgetStandingOrder: getStandingOrder,\r\n\t\t\t\tallInvoices: allInvoices,\r\n\t\t\t\taddValueToCurrentPageReadyList: addValueToCurrentPageReadyList,\r\n\t\t\t\taddValueToCurrentPageCheckList: addValueToCurrentPageCheckList,\r\n\t\t\t\treadyInvoicesList: readyInvoicesList,\r\n\t\t\t\tcheckInvoicesList: checkInvoicesList,\r\n                clearCurrentPageReadyList: clearCurrentPageReadyList,\r\n                clearCurrentPageCheckList: clearCurrentPageCheckList,\r\n\t\t\t\tisSearchMode : isSearchMode,\r\n                setSearchMode : setSearchMode,\r\n                updateCorrectionStatus: updateCorrectionStatus,\r\n\t\t\t\tgetViewMode: getViewMode,\r\n\t\t\t\tsetViewMode: setViewMode,\r\n                repeatAnalysis:  repeatAnalysis,\r\n\t\t\t\tpollingProcessRecursive: pollingProcessRecursive\r\n\t\t\t};\r\n\r\n\t\tallInvoices();\r\n\t\t\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction getViewMode(){\r\n\t\t\treturn viewMode;\r\n\t\t}\r\n\r\n\t\tfunction setViewMode(viewModeInput){\r\n\t\t\tviewMode = viewModeInput;\r\n\t\t}\r\n\r\n\t\tfunction isSearchMode(){\r\n\t\t\treturn useSearchMode;\r\n\t\t}\r\n\r\n        function setSearchMode(searchModeInput){\r\n            useSearchMode = searchModeInput;\r\n        }\r\n\r\n        function clearCurrentPageReadyList(){\r\n            currentPageReadyList = 0;\r\n        }\r\n\r\n        function clearCurrentPageCheckList(){\r\n            currentPageReadyList = 0;\r\n        }\r\n\r\n\t\tfunction addValueToCurrentPageReadyList(){\r\n\t\t\tcurrentPageReadyList = currentPageReadyList + 1;\r\n\t\t}\r\n\r\n\t\tfunction addValueToCurrentPageCheckList(){\r\n\t\t\tcurrentPageCheckList = currentPageCheckList + 1;\r\n\t\t}\r\n\r\n        function isLoading() {\r\n            return isLoadingValue;\r\n        }\r\n\t\t\r\n\t\tfunction getIsScrollingDisabled(){\r\n\t\t\treturn isScrollingDisabled;\r\n\t\t}\r\n\t\t\r\n\t\tfunction setIsScrollingDisabled(value){\r\n\t\t\tisScrollingDisabled = value;\r\n\t\t}\r\n\r\n        function setIsLoading(isLoadingValueTmp) {\r\n            isLoadingValue = isLoadingValueTmp;\r\n        }\r\n\r\n\t\tfunction getInvoicesReadyRawList() {\r\n\t\t\treturn invoiceListReadyRaw;\r\n\t\t}\r\n\r\n\t\tfunction pollingProcessRecursive(invoiceId, currentIteration){\r\n\r\n\t\t\tvar sleeptimes = [3,1,1,1,1,2,3,4,4,5,5,5];\r\n\r\n\t\t\tvar currentSleepTime = sleeptimes[currentIteration] * 1000;\r\n\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tdetails(invoiceId).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tif (result.data.invoiceStatusEnum !== 'ANALYZING') {\r\n\t\t\t\t\t\t\tsearchAndUpdateInvoiceInList(result.data);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif (currentIteration < sleeptimes.length - 1){\r\n\t\t\t\t\t\t\t\tpollingProcessRecursive(invoiceId, currentIteration + 1);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t, currentSleepTime);\r\n\r\n\t\t}\r\n\t\t\r\n        function getInvoices(mode) {\r\n\t\t\tif (mode === 'CHECK'){\r\n\t\t\t\treturn invoiceListCheck;\r\n\t\t\t}else if (mode === 'READY'){\r\n\t\t\t\treturn invoiceListReady;\r\n\t\t\t}else if (mode === 'STANDING_ORDER'){\r\n\t\t\t\treturn invoiceListStandingOrder;\r\n\t\t\t}\r\n\t\t\treturn [];\r\n        }\r\n\r\n        function setInvoices(invoiceListTmp) {\r\n\t\t\tvar invoiceListTmp2 = [];\r\n\t\t\tinvoiceListTmp.forEach(function(item){\r\n\t\t\t\tinvoiceListTmp2.push(item);\r\n\t\t\t});\r\n\t\t\tdistributeInvoices(invoiceListTmp2);\r\n        }\r\n\r\n        function sendMistakeMessage(invoiceId, message){\r\n\r\n\t\t\tvar messageDTO = {\r\n\t\t\t\tmessage: message\r\n\t\t\t};\r\n\r\n            return $http({\r\n                method: 'POST',\r\n                url: base.invoices + '/' + invoiceId + '/mistake',\r\n                data: messageDTO,\r\n                headers: {\r\n                    'Content-Type': 'application/json;charset=UTF-8'\r\n                }\r\n            }).then(\r\n                function(result) {\r\n                    NotificationService.create('Fehler erfolgreich gemeldet!',5000);\r\n                },\r\n                function(result) {\r\n                    NotificationService.create('Fehlermeldung nicht erfolgreich!',5000);\r\n                    $log.warn('Could not get create mistake message!','result',result);\r\n                    isLoadingValue = false;\r\n                }\r\n            );\r\n        }\r\n\r\n\t\tfunction generateStandingOrder(standingOrder, deleteInvoiceTemplate){\r\n\r\n\t\t\tvar url = deleteInvoiceTemplate ? base.standingOrders + '?deleteInvoiceTemplate=true' : base.standingOrders;\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: url,\r\n\t\t\t\tdata: standingOrder,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t}).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Dauerauftrag erfolgreich erstellt!',5000);\r\n\t\t\t\t\tallInvoices();\r\n\t\t\t\t},\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Fehler bei Erstellung des Dauerauftrags!',5000);\r\n\t\t\t\t\t$log.warn('Could not get create standing order!','result',result);\r\n\t\t\t\t\tisLoadingValue = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tfunction deleteStandingOrder(invoiceTemplateId){\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\turl: base.deleteStandingOrders + '/' + invoiceTemplateId\r\n\t\t\t}).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvar foundInvoice = _.filter(invoiceListStandingOrder, function(invoice){ return (invoice.invoiceId === invoiceTemplateId);});\r\n\t\t\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0){\r\n\t\t\t\t\t\tvar foundInvoiceIndex = _.indexOf(invoiceListStandingOrder, foundInvoice[0]);\r\n\r\n\t\t\t\t\t\tinvoiceListStandingOrder.splice(foundInvoiceIndex, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tNotificationService.create('Dauerauftrag wurde gelscht!',5000);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Fehler beim Lschen von Dauerauftrag!',5000);\r\n\t\t\t\t\t$log.warn('Could not delete standing order!','result',result);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n        function deleteInvoiceImage(invoiceId){\r\n            return $http({\r\n                method: 'DELETE',\r\n                url: base.invoiceImages + '/' + invoiceId\r\n            }).then(\r\n                function(result) {\r\n\r\n                },\r\n                function(result) {\r\n                    NotificationService.create('Fehler beim Lschen von Bild!',5000);\r\n                    $log.warn('Could not delete standing order!','result',result);\r\n                }\r\n            );\r\n        }\r\n\r\n        function repeatAnalysis(invoiceId){\r\n            return $http({\r\n                method: 'POST',\r\n                url: base.invoiceAnalysis + '/' + invoiceId + '/repeatAnalysis'\r\n            }).then(\r\n                function(result) {\r\n                    searchAndRemoveInvoiceInList(invoiceId);\r\n                    distributeInvoice(result.data);\r\n\r\n                    NotificationService.create('Bild wird nochmal analysiert!',5000);\r\n                },\r\n                function(result) {\r\n                    NotificationService.create('Fehler bei Analyse vom Bild!',5000);\r\n                    $log.warn('Could not analyze image!','result',result);\r\n                }\r\n            );\r\n        }\r\n\r\n\t\tfunction distributeInvoices(invoiceList){\r\n\t\t\tinvoiceListCheck = _.filter(invoiceList, function(invoice){ return ((invoice.invoiceWorkflowMode === 'EXTERNAL_USER_CHECK_MODE' || invoice.invoiceWorkflowMode === 'CREATED_USER_CHECK_MODE') && invoice.standingOrderInvoiceTemplateId !== invoice.invoiceId);});\r\n\r\n\t\t\tvar invoiceListReadyTmp = _.filter(invoiceList, function(invoice){ return ((invoice.invoiceWorkflowMode === 'EXTERNAL_USER_READY_MODE' || invoice.invoiceWorkflowMode === 'CREATED_USER_READY_MODE') && invoice.standingOrderInvoiceTemplateId !== invoice.invoiceId);});\r\n\t\t\tvar invoiceListReadyTmpSorted = _.sortBy(invoiceListReadyTmp, function(o) {\r\n\t\t\t\tvar dateOfInvoice = new Date(o.dateOfInvoice);\r\n\t\t\t\treturn dateOfInvoice; }\r\n\t\t\t).reverse();\r\n\t\t\tinvoiceListReady = itemsGroupedByMonth(invoiceListReadyTmpSorted);\r\n\r\n\t\t\tinvoiceListStandingOrder = _.filter(invoiceList, function(invoice){ return (invoice.standingOrderInvoiceTemplateId === invoice.invoiceId);});\r\n\t\t}\r\n\r\n\t\tfunction distributeInvoice(invoiceInput){\r\n\r\n\t\t\tif ((invoiceInput.invoiceWorkflowMode === 'EXTERNAL_USER_READY_MODE' || invoiceInput.invoiceWorkflowMode === 'CREATED_USER_READY_MODE') && invoiceInput.standingOrderInvoiceTemplateId !== invoiceInput.invoiceId){\r\n\t\t\t\tinvoiceListReadyRaw.push(invoiceInput);\r\n\t\t\t\tinvoiceListReady = distributeReadyInvoices(invoiceListReadyRaw);\r\n\t\t\t\treturn invoiceListReadyRaw;\r\n\t\t\t}else if ((invoiceInput.invoiceWorkflowMode === 'EXTERNAL_USER_CHECK_MODE' || invoiceInput.invoiceWorkflowMode === 'CREATED_USER_CHECK_MODE') && invoiceInput.standingOrderInvoiceTemplateId !== invoiceInput.invoiceId){\r\n\t\t\t\tinvoiceListCheck.push(invoiceInput);\r\n\t\t\t\treturn invoiceListCheck;\r\n\t\t\t}else if (invoiceInput.standingOrderInvoiceTemplateId === invoiceInput.invoiceId){\r\n\t\t\t\tinvoiceListStandingOrder.push(invoiceInput);\r\n\t\t\t\treturn invoiceListStandingOrder;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction distributeReadyInvoices(invoiceList){\r\n\t\t\tvar invoicesListReadyTmp = [];\r\n\r\n\t\t\tinvoiceList.forEach(function(item){\r\n\t\t\t\tinvoicesListReadyTmp.push(item);\r\n\t\t\t});\r\n\r\n\t\t\tvar invoiceListReadyTmpSorted = _.sortBy(invoicesListReadyTmp, function(o) {\r\n\t\t\t\tvar dateOfInvoice = new Date(o.dateOfInvoice);\r\n\t\t\t\treturn dateOfInvoice; }\r\n\t\t\t).reverse();\r\n\t\t\treturn itemsGroupedByMonth(invoiceListReadyTmpSorted);\r\n\t\t}\r\n\r\n\t\tfunction itemsGroupedByMonth (items) {\r\n\r\n\t\t\tvar groups = [],\r\n\t\t\t\tgroupsTmp = [],\r\n\t\t\t\titemGroupedByMonths = [],\r\n\t\t\t\tmonthLabels = ['Januar','Februar','Mrz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'];\r\n\r\n\t\t\tfor (var i = 0; i < items.length; i++) {\r\n\t\t\t\tvar dateOfInvoiceTmp = items[i].dateOfInvoice;\r\n\t\t\t\tvar intTimestamp = parseInt(dateOfInvoiceTmp);\r\n\t\t\t\tvar dateOfInvoice = new Date(intTimestamp);\r\n\r\n\t\t\t\tvar tmpKey = (dateOfInvoice.getMonth() + ' ' +dateOfInvoice.getFullYear()).toString();\r\n\t\t\t\tvar tmpKeyObject = {month:dateOfInvoice.getMonth(), year: dateOfInvoice.getFullYear(), key: tmpKey};\r\n\r\n\t\t\t\tvar groupsTmpFilter = _.filter(groupsTmp, function(groupTmp){ return groupTmp.key === tmpKey; });\r\n\t\t\t\tif (groupsTmpFilter.length == 0){\r\n\t\t\t\t\tgroupsTmp.push(tmpKeyObject);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (groups[tmpKey] == undefined){\r\n\t\t\t\t\tgroups[tmpKey] = [];\r\n\t\t\t\t}\r\n\t\t\t\tgroups[tmpKey].push(items[i]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (var j = 0; j < groupsTmp.length; j++) {\r\n\t\t\t\tvar groupLabel = monthLabels[groupsTmp[j].month] + ' ' + groupsTmp[j].year;\r\n\t\t\t\tvar groupSum = 0;\r\n\t\t\t\tgroups[groupsTmp[j].key].forEach(function(item){\r\n\t\t\t\t\tgroupSum = groupSum + item.moneyValue;\r\n\t\t\t\t});\r\n\t\t\t\tvar pow = Math.pow(10,2);\r\n\t\t\t\tgroupSum = +( Math.round(groupSum * pow) / pow );\r\n\t\t\t\titemGroupedByMonths.push({\r\n\t\t\t\t\tgroupLabel: groupLabel,\r\n\t\t\t\t\titems: groups[groupsTmp[j].key],\r\n\t\t\t\t\tgroupSum: groupSum\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn itemGroupedByMonths;\r\n\t\t}\r\n\r\n\t\tfunction allInvoices(){\r\n\r\n\t\t\tcurrentPageReadyList = 0;\r\n\t\t\tcurrentPageCheckList = 0;\r\n\r\n\t\t\tinvoiceListCheck = [];\r\n\t\t\tinvoiceListReadyRaw = [];\r\n\t\t\tinvoiceListStandingOrder = [];\r\n\r\n\t\t\tisLoadingValue = true;\r\n\t\t\t\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\tvar invoiceListReadyRawSize = invoiceListReadyRaw.length;\r\n\t\t\t\tvar invoiceListReadyRawTmp = [];\r\n                var currentPageReadyListTmp = angular.copy(currentPageReadyList);\r\n                var invoiceListReadyRawOriginalCopy = [];\r\n                invoiceListReadyRaw.forEach(function(item){\r\n                    invoiceListReadyRawOriginalCopy.push(item);\r\n                });\r\n\t\t\t\t$q.all([list(true, null, invoiceListStandingOrder), list(false, 'READY', invoiceListReady, currentPageReadyListTmp, undefined, invoiceListReadyRawSize, invoiceListReadyRawTmp, invoiceListReadyRawOriginalCopy), list(false, 'CHECK', invoiceListCheck, currentPageCheckList)])\r\n\t\t\t\t\t.then(function (result) {\r\n\t\t\t\t\t\tisLoadingValue = false;\r\n\r\n\t\t\t\t\t\tif ((invoiceListCheck == undefined || invoiceListCheck.length == 0) && (invoiceListReadyRaw != undefined && invoiceListReadyRaw.length >= 0)){\r\n\t\t\t\t\t\t\tviewMode = 'READY';\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tviewMode = 'CHECK';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}, function (error) {\r\n\t\t\t\t\t\tisLoadingValue = false;\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction readyInvoicesList(){\r\n            var invoiceListReadyRawTmp = [];\r\n            var currentPageReadyListTmp = angular.copy(currentPageReadyList);\r\n            var invoiceListReadyRawSize = invoiceListReadyRaw.length;\r\n            var invoiceListReadyRawOriginalCopy = [];\r\n            invoiceListReadyRaw.forEach(function(item){\r\n                invoiceListReadyRawOriginalCopy.push(item);\r\n            });\r\n\t\t\treturn list(false, 'READY', invoiceListReady, currentPageReadyListTmp, undefined, invoiceListReadyRawSize, invoiceListReadyRawTmp, invoiceListReadyRawOriginalCopy);\r\n\t\t}\r\n\r\n\t\tfunction checkInvoicesList(){\r\n\t\t\treturn list(false, 'CHECK', invoiceListCheck, currentPageCheckList);\r\n\t\t}\r\n\r\n\t\tfunction list(onlyStandingOrder, invoiceStatusEnum, invoiceList, currentPage, counter, invoiceListReadyRawCounter, invoiceListReadyRawTmp, invoiceListReadyRawOriginalCopy) {\r\n\r\n\t\t\tvar searchFilterBean = SearchService.getSearchConfiguration();\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: base.invoicesWithFilterBean,\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tonlyStandingOrder: onlyStandingOrder,\r\n\t\t\t\t\tinvoiceStatusEnum: invoiceStatusEnum,\r\n\t\t\t\t\tpageNumber: currentPage\r\n\t\t\t\t},\r\n\t\t\t\tdata: searchFilterBean,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t}).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tvar invoiceListTmp = result.data;\r\n\r\n\t\t\t\t\tif (invoiceStatusEnum != null && invoiceStatusEnum === 'READY'){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tinvoiceListTmp = result.data.invoiceDTOs;\r\n\t\t\t\t\tcurrentPage = result.data.currentPage;\r\n\r\n\t\t\t\t\tinvoiceListTmp.forEach(function(item){\r\n\t\t\t\t\t\tinvoiceListReadyRawTmp.push(item);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tinvoiceListReadyRawTmp.forEach(function(item){\r\n\t\t\t\t\t\t\tinvoiceListReadyRawOriginalCopy.push(item);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tinvoiceListReadyRaw = [];\r\n\t\t\t\t\t\tinvoiceListReadyRawOriginalCopy.forEach(function(item){\r\n\t\t\t\t\t\t\tinvoiceListReadyRaw.push(item);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcurrentPageReadyList = currentPage;\r\n\r\n\t\t\t\t\t\tinvoiceListReady = distributeReadyInvoices(invoiceListReadyRaw);\r\n\r\n\t\t\t\t\t\tisScrollingDisabled = false;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tinvoiceListTmp.forEach(function(item){\r\n\t\t\t\t\t\t\tif (item.invoiceStatusEnum === 'ANALYZING'){\r\n\t\t\t\t\t\t\t\tpollingProcessRecursive(item.invoiceId, 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinvoiceList.push(item);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\t$log.warn('Could not get invoices!','result',result);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tfunction repetitionTypeEnumList() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.invoices + \"/repetitionTypeEnums\"\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction paymentTypeEnumList() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.invoices + \"/paymentTypeEnums\"\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction create(invoice, costDistributionItems) {\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\tvar httpConfiguration = {\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\turl: base.invoices + '/' + invoice.invoiceId,\r\n\t\t\t\t\tdata: invoice,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t$http(httpConfiguration).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tCostdistributionitemService.update(result.data.invoiceId, costDistributionItems).then(function(resultCostItems){\r\n\t\t\t\t\t\t\tdetails(result.data.invoiceId).then(function(detailsInvoice){\r\n\t\t\t\t\t\t\t\tdistributeInvoice(detailsInvoice.data);\r\n\t\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tNotificationService.create('Rechnung wurde erstellt!',5000);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction details(invoiceId) {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.invoices + '/' + invoiceId\r\n\t\t\t});\r\n\t\t}\r\n\r\n        function updateCorrectionStatus(invoices, correctionStatus) {\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'POST',\r\n                    url: base.invoices + '/setCorrectionStatus',\r\n                    data: invoices,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    },\r\n                    params: {\r\n                        setWorkflow: correctionStatus\r\n                    }\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n\r\n                    \tresult.data.forEach(function(item){\r\n                            searchAndRemoveInvoiceInList(item.invoiceId);\r\n                            distributeInvoice(item);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tNotificationService.create('Status wurde aktualisiert!',5000);\r\n\t\t\t\t\t\tresolve(null);\r\n\r\n                    }, function(result){\r\n                        NotificationService.create('Fehler whrend der Aktualisierung!',5000);\r\n                        allInvoices();\r\n                    }\r\n                );\r\n            });\r\n\r\n        }\r\n\r\n\t\tfunction update(invoice, correctionStatus, costDistributionItems) {\r\n\r\n\t\t\tinvoice.costDistributionItemDTOs = costDistributionItems;\r\n\t\t\t\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'PUT',\r\n                    url: base.invoices + '/' + invoice.invoiceId,\r\n                    data: invoice,\r\n                    headers: {\r\n                        'Content-Type': 'application/json;charset=UTF-8'\r\n                    }\r\n                };\r\n\r\n                if (correctionStatus != undefined && correctionStatus != null){\r\n                    httpConfiguration.params = {\r\n                        setWorkflow: correctionStatus\r\n                    };\r\n                }\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n\r\n\t\t\t\t\t\tif (correctionStatus != undefined && correctionStatus != null){\r\n\r\n\t\t\t\t\t\t\tsearchAndRemoveInvoiceInList(invoice.invoiceId);\r\n\t\t\t\t\t\t\tdistributeInvoice(result.data);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tsearchAndUpdateInvoiceInList(result.data);\r\n\r\n\t\t\t\t\t\t\tNotificationService.create('Rechnung wurde aktualisiert!',5000);\r\n\t\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t\t}\r\n\r\n                    }, function(result){\r\n\t\t\t\t\t\tNotificationService.create('Fehler whrend der Aktualisierung!',5000);\r\n\t\t\t\t\t\tallInvoices();\r\n\t\t\t\t\t}\r\n                );\r\n            });\r\n\t\t}\r\n\r\n\t\tfunction updateStandingOrder(invoiceTemplateId, standingOrder) {\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\tvar httpConfiguration = {\r\n\t\t\t\t\tmethod: 'PUT',\r\n\t\t\t\t\turl: base.standingOrderInvoiceTemplates + '/' + invoiceTemplateId,\r\n\t\t\t\t\tdata: standingOrder,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t$http(httpConfiguration).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tNotificationService.create('Dauerauftrag wurde aktualisiert!',5000);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}, function(result){\r\n\t\t\t\t\t\tNotificationService.create('Fehler whrend der Aktualisierung!',5000);\r\n\t\t\t\t\t\tallInvoices();\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getStandingOrder(invoiceTemplateId) {\r\n\r\n\t\t\treturn $q(function(resolve, error) {\r\n\t\t\t\tvar httpConfiguration = {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: base.standingOrderInvoiceTemplates + '/' + invoiceTemplateId,\r\n\t\t\t\t};\r\n\r\n\t\t\t\t$http(httpConfiguration).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t\t}, function(result){\r\n\t\t\t\t\t\terror(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction remove(invoiceId) {\r\n\r\n            return $q(function(resolve) {\r\n                return $http({\r\n                    method: 'DELETE',\r\n                    url: base.invoices + '/' + invoiceId\r\n                }).then(\r\n                    function(result) {\r\n\t\t\t\t\t\tsearchAndRemoveInvoiceInList(invoiceId);\r\n                        NotificationService.create('Rechnung wurde gelscht!',5000);\r\n\r\n                        resolve(null);\r\n                    },\r\n                    function(result) {\r\n                        $log.warn('Could not delete invoice!','result',result);\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n\t\t}\r\n\r\n\t\tfunction searchAndRemoveInvoiceInList(invoiceId){\r\n\r\n\t\t\tvar foundInvoiceIndex, foundInvoice;\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListCheck, function(invoice){ return (invoice.invoiceId === invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0){\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListCheck, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListCheck.splice(foundInvoiceIndex, 1);\r\n\t\t\t\tinvoiceListCheck[foundInvoiceIndex];\r\n\t\t\t}\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListReadyRaw, function(invoice){ return (invoice.invoiceId === invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0){\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListReadyRaw, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListReadyRaw.splice(foundInvoiceIndex, 1);\r\n\t\t\t\tinvoiceListReady[foundInvoiceIndex];\r\n\t\t\t\tinvoiceListReady = distributeReadyInvoices(invoiceListReadyRaw);\r\n\t\t\t}\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListStandingOrder, function(invoice){ return (invoice.invoiceId === invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0){\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListStandingOrder, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListStandingOrder.splice(foundInvoiceIndex, 1);\r\n\t\t\t\tinvoiceListStandingOrder[foundInvoiceIndex];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction searchAndUpdateInvoiceInList(invoice){\r\n\r\n\t\t\tvar foundInvoiceIndex, foundInvoiceIndex, foundInvoice;\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListCheck, function(invoiceTmp){ return (invoiceTmp.invoiceId === invoice.invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0) {\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListCheck, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListCheck[foundInvoiceIndex] = invoice;\r\n\t\t\t}\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListReadyRaw, function(invoiceTmp){ return (invoiceTmp.invoiceId === invoice.invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0) {\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListReadyRaw, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListReadyRaw[foundInvoiceIndex] = invoice;\r\n\t\t\t\tinvoiceListReady = distributeReadyInvoices(invoiceListReadyRaw);\r\n\t\t\t}\r\n\r\n\t\t\tfoundInvoice = _.filter(invoiceListStandingOrder, function(invoiceTmp){ return (invoiceTmp.invoiceId === invoice.invoiceId);});\r\n\t\t\tif (foundInvoice != null && foundInvoice != undefined && foundInvoice.length > 0) {\r\n\t\t\t\tfoundInvoiceIndex = _.indexOf(invoiceListStandingOrder, foundInvoice[0]);\r\n\r\n\t\t\t\tinvoiceListStandingOrder[foundInvoiceIndex] = invoice;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('MessageService', MessageService);\r\n\r\n    MessageService.$inject = ['$http','$q','NotificationService', '_', 'SettingsService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction MessageService($http, $q, NotificationService, _, SettingsService) {\r\n\t\tvar base = {\r\n\t\t\t\tmessages: '/webapp/api/messages',\r\n                invoices: '/webapp/api/invoices',\r\n                deleteMessage: '/webapp/api/basicdata'\r\n            \r\n\t\t\t},\r\n\t\t\tmessagesList = [],\r\n\t\t\tservice = {\r\n\t\t\t\tlist: list,\r\n                getMessages: getMessages,\r\n                problemSolved: problemSolved,\r\n                deleteMessage: deleteMessage\r\n\t\t\t};\r\n\r\n        listWithCheck();\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n        function getMessages() {\r\n            return messagesList;\r\n        }\r\n\r\n        function listWithCheck() {\r\n            SettingsService.isCustomized().then(function(response){\r\n                if (response.data.value){\r\n                    list();\r\n                }\r\n            });\r\n        }\r\n\r\n\t\tfunction list() {\r\n            return $q(function(resolve) {\r\n                $http({\r\n                    method: 'GET',\r\n                    url: base.messages\r\n                }).then(\r\n                    function(result) {\r\n                        var tmpMessageList = result.data;\r\n\r\n                        messagesList = [];\r\n\r\n                        tmpMessageList.forEach(function(item){\r\n                           var tmpItem = item;\r\n                           var tmpItemMessageParsed = JSON.parse(tmpItem.value);\r\n\r\n                            tmpItem.subject = tmpItemMessageParsed.subject;\r\n                            tmpItem.message = tmpItemMessageParsed.message;\r\n                            tmpItem.messageType = tmpItemMessageParsed.messageType;\r\n\r\n                            messagesList.push(tmpItem);\r\n                        });\r\n                        resolve(messagesList);\r\n                    }\r\n                );\r\n            });\r\n\t\t}\r\n        \r\n        function deleteMessage(basicDataId) {\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'DELETE',\r\n                    url: base.deleteMessage + '/' + basicDataId\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n                        NotificationService.create('Nachricht wurde gelscht!',5000);\r\n                        list();\r\n                        resolve(null);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\r\n        function problemSolved(basicDataId) {\r\n\r\n            return $q(function(resolve) {\r\n                var httpConfiguration = {\r\n                    method: 'DELETE',\r\n                    url: base.invoices + '/' + basicDataId + '/problemSolved'\r\n                };\r\n\r\n                $http(httpConfiguration).then(\r\n                    function(result) {\r\n\r\n                        var foundMessage = _.filter(messagesList, function(message){ return (message.basicDataId === basicDataId);});\r\n                        if (foundMessage != null && foundMessage != undefined && foundMessage.length > 0){\r\n                            var foundMessageIndex = _.indexOf(messagesList, foundMessage[0]);\r\n\r\n                            messagesList.splice(foundMessageIndex, 1);\r\n                            resolve(messagesList[foundMessageIndex]);\r\n                        }\r\n\r\n                        NotificationService.create('Nachricht wurde gelscht!',5000);\r\n                        resolve(result);\r\n                    }\r\n                );\r\n            });\r\n        }\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.directive('msNotification', msNotification);\r\n\r\n\tmsNotification.$inject = ['$rootScope','$compile','$timeout'];\r\n\r\n\t/* @ngInject */\r\n\tfunction msNotification($rootScope,$compile,$timeout) {\r\n\t\tvar directive = {\r\n\t\t\trestrict: 'E',\r\n\t\t\ttemplate: '<div class=\"notifications\"></div>',\r\n\t\t\treplace: true,\r\n\t\t\tlink: link,\r\n\t\t\tcontroller: NotificationController,\r\n\t\t\tcontrollerAs: 'vm',\r\n\t\t\tbindToController: true,\r\n\t\t};\r\n\r\n\t\treturn directive;\r\n\r\n\t\tfunction link(scope, element, attrs) {\r\n\t\t\tvar container = angular.element(element),\r\n\t\t\t\tduration = attrs.duration ? attrs.duration : 3000,\r\n\t\t\t\tremoveDelay = attrs.removeDelay ? attrs.removeDelay : 200;\r\n\r\n\t\t\t$rootScope.$on('createNotification', function(event, received) {\r\n\t\t\t\tvar toastId = generateUUID();\r\n\r\n\t\t\t\tvar template = '<div class=\"float-right w-100\"><div class=\"toast m-2 float-right\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\" id=\"'+toastId+'\"><div class=\"toast-header\"><div class=\"mr-auto\">Hinweis</div></div><div class=\"toast-body\"><b>'+ received.content+ '</b></div></div></div>',\r\n\t\t\t\t\tnotification = angular.element($compile(template)(scope));\r\n\r\n\t\t\t\tcontainer.append(notification);\r\n\r\n\t\t\t\t$(\"#\"+toastId).toast({\r\n\t\t\t\t\tdelay: (received.duration ? received.duration : duration) - 1000\r\n\t\t\t\t}).toast('show');\r\n\r\n\t\t\t\t$timeout(function() {\r\n\t\t\t\t\tnotification.attr('hidden','hidden');\r\n\r\n\t\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t\t$(\"#\"+toastId).toast('hide');\r\n\t\t\t\t\t\tnotification.remove();\r\n\t\t\t\t\t}, removeDelay, false);\r\n\t\t\t\t}, received.duration ? received.duration : duration, false);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction generateUUID(){\r\n\t\t\tfunction s4() {\r\n\t\t\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t\t\t.toString(16)\r\n\t\t\t\t\t.substring(1);\r\n\t\t\t}\r\n\t\t\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n\t\t\t\ts4() + '-' + s4() + s4() + s4();\r\n\t\t}\r\n\t}\r\n\r\n\t/* @ngInject */\r\n\tfunction NotificationController() {\r\n\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('NotificationService', NotificationService);\r\n\r\n\tNotificationService.$inject = ['$log','$rootScope','$translate'];\r\n\r\n\t/* @ngInject */\r\n\tfunction NotificationService($log,$rootScope,$translate) {\r\n\t\tvar service = {\r\n\t\t\tcreate: create\r\n\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction create(content, duration) {\r\n\t\t\t$translate(content).then(function(translatedContent) {\r\n\t\t\t\t$rootScope.$broadcast('createNotification', {\r\n\t\t\t\t\t'content': translatedContent,\r\n\t\t\t\t\t'duration': duration\r\n\t\t\t\t});\r\n\t\t\t}, function(translationKey) {\r\n\t\t\t\t$log.error('No translation available:',translationKey);\r\n\t\t\t\t$rootScope.$broadcast('createNotification', {\r\n\t\t\t\t\t'content': content,\r\n\t\t\t\t\t'duration': duration\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('CostdistributioncalculateService', CostdistributioncalculateService);\r\n\r\n\tCostdistributioncalculateService.$inject = [];\r\n\r\n\t/* @ngInject */\r\n\tfunction CostdistributioncalculateService() {\r\n\t\tvar service = {\r\n\t\t\t\tgetMaxQuotaForOneCostDistributionItem: getMaxQuotaForOneCostDistributionItem,\r\n\t\t\t\tgetMaxAmountForOneQuota: getMaxAmountForOneQuota,\r\n\t\t\t\tgetMaxAmountForOneCostDistributionItem: getMaxAmountForOneCostDistributionItem,\r\n\t\t\t\tgetCountWeightedWithoutFixed: getCountWeightedWithoutFixed,\r\n\t\t\t\tcalculateQuotaForValue: calculateQuotaForValue,\r\n\t\t\t\tcalculateAmountForValue: calculateAmountForValue,\r\n\t\t\t\tcalculatePercentForValue: calculatePercentForValue,\r\n\t\t\t\tgetCountWithoutFixed: getCountWithoutFixed,\r\n\t\t\t\tgetCountOfFixedAmount: getCountOfFixedAmount,\r\n\t\t\t\tgetCountOfPercent: getCountOfPercent,\r\n\t\t\t\tcalculateAmountForCostDistributionItem: calculateAmountForCostDistributionItem,\r\n\t\t\t\tcalculateAmountForCostDistributionItemPrecise: calculateAmountForCostDistributionItemPrecise\r\n\t\t\t};\r\n\r\n\t\tNumber.prototype.setScale = function(scale){\r\n\t\t\tvar pow = Math.pow(10,scale);\r\n\t\t\treturn +( Math.round(this * pow) / pow );\r\n\t\t};\r\n\r\n\t\tNumber.prototype.divide = function(number2, scale){\r\n\t\t\tvar divisionResult = this / number2;\r\n\t\t\treturn divisionResult.setScale(scale);\r\n\t\t};\r\n\r\n\t\tNumber.prototype.remainder = function(n){\r\n\t\t\treturn ((this%n)+n)%n;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.compareTo = function(number2){\r\n\t\t\tif (this < number2){\r\n\t\t\t\treturn -1;\r\n\t\t\t}else if (this > number2){\r\n\t\t\t\treturn 1;\r\n\t\t\t}else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tNumber.prototype.multiply = function(number2){\r\n\t\t\treturn this * number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.subtract = function(number2){\r\n\t\t\treturn this - number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.add = function(number2){\r\n\t\t\treturn this + number2;\r\n\t\t};\r\n\r\n\t\tNumber.prototype.floor = function() {\r\n\t\t\treturn Math.floor(this);\r\n\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction getCalculatedRestSum(sum, costDistributionItems){\r\n\t\t\tvar restSumTmp;\r\n\r\n\t\t\tvar sumOfAllCostDistributions = 0;\r\n\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem){\r\n\t\t\t\tsumOfAllCostDistributions = sumOfAllCostDistributions.add(calculateAmountForCostDistributionItem(tmpCostDistributionItem, costDistributionItems, sum));\r\n\t\t\t});\r\n\r\n\t\t\trestSumTmp = sum.subtract(sumOfAllCostDistributions);\r\n\r\n\t\t\treturn restSumTmp;\r\n\t\t}\r\n\r\n\t\tfunction getMaxQuotaForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem){\r\n\t\t\tvar maxQuota = getCountWithoutFixed(costDistributionItemsWithoutCurrentItem).add(1);\r\n\t\t\tvar maxQuotaWeighted = getCountWeightedWithoutFixed(costDistributionItemsWithoutCurrentItem);\r\n\t\t\tvar maxQuotaForOneCostDistributionItem = maxQuota.subtract(maxQuotaWeighted);\r\n\r\n\t\t\treturn maxQuotaForOneCostDistributionItem;\r\n\t\t}\r\n\r\n\t\tfunction getMaxAmountForOneQuota(costDistributionItemsWithoutCurrentItem, sum){\r\n\t\t\tvar maxAmountForOneCostDistributionItem = getMaxAmountForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem, sum);\r\n\t\t\tvar countWithoutFixed = getCountWithoutFixed(costDistributionItemsWithoutCurrentItem).add(1);\r\n\r\n\t\t\tvar result = maxAmountForOneCostDistributionItem.divide(countWithoutFixed, 50);\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tfunction getMaxAmountForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem, sum){\r\n\t\t\tvar amountWithoutFixed = 0;\r\n\t\t\tcostDistributionItemsWithoutCurrentItem.forEach(function(tmpCostDistributionItem1) {\r\n\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum === 'FIXED_AMOUNT' || tmpCostDistributionItem1.costDistributionItemTypeEnum === 'PERCENT'){\r\n\t\t\t\t\tamountWithoutFixed = amountWithoutFixed + calculateAmountForCostDistributionItem(tmpCostDistributionItem1, costDistributionItemsWithoutCurrentItem, sum);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar sumOfCostDistributionItemsWithoutFixedAmount = sum.subtract(amountWithoutFixed);\r\n\t\t\treturn sumOfCostDistributionItemsWithoutFixedAmount;\r\n\t\t}\r\n\t\t\r\n\t\tfunction getCountWeightedWithoutFixed(costDistributionItemsWithoutCurrentItem){\r\n\t\t\tvar countWeightedWithoutFixed = 0;\r\n\t\t\tcostDistributionItemsWithoutCurrentItem.forEach(function(tmpCostDistributionItem1) {\r\n\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum === 'QUOTA') {\r\n\t\t\t\t\tcountWeightedWithoutFixed = countWeightedWithoutFixed + tmpCostDistributionItem1.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn countWeightedWithoutFixed;\r\n\t\t}\r\n\r\n\t\tfunction calculateQuotaForValue(costDistributionItemTypeOfValue, value, costDistributionItemsWithoutCurrentItem, sum){\r\n\t\t\tvar quotaForEt = 0;\r\n\t\t\tif (costDistributionItemTypeOfValue === 'FIXED_AMOUNT') {\r\n\r\n\t\t\t\tvar quotaWeighted = 0;\r\n\t\t\t\tif (value.compareTo(0) == 1){\r\n\r\n\r\n\t\t\t\t\tvar maxQuotaForOneCostDistributionItemTmp = getMaxQuotaForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\t\tvar maxAmountForOneQuota = calculateAmountForValue('QUOTA', maxQuotaForOneCostDistributionItemTmp, costDistributionItemsWithoutCurrentItem, sum);\r\n\r\n\t\t\t\t\tvar valueForCalculating = value;\r\n\r\n\t\t\t\t\tif (value.compareTo(maxAmountForOneQuota) == 1){\r\n\t\t\t\t\t\tvalueForCalculating = maxAmountForOneQuota;\r\n\t\t\t\t\t}else if (value.compareTo(0) == -1 || value.compareTo(0) == 0){\r\n\t\t\t\t\t\tvalueForCalculating = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (valueForCalculating.compareTo(0) != 0){\r\n\t\t\t\t\t\tvar percentOfMaxAmountForOneQuota = valueForCalculating.divide(maxAmountForOneQuota, 50);\r\n\t\t\t\t\t\tvar maxQuotaForOneCostDistributionItem = getMaxQuotaForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\t\t\tquotaWeighted = percentOfMaxAmountForOneQuota.multiply(maxQuotaForOneCostDistributionItem).setScale(1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tquotaForEt = quotaWeighted;\r\n\t\t\t} else if (costDistributionItemTypeOfValue === 'QUOTA') {\r\n\t\t\t\tquotaForEt = value.setScale(50);\r\n\t\t\t} else if (costDistributionItemTypeOfValue === 'PERCENT') {\r\n\t\t\t\tquotaWeighted = 0;\r\n\t\t\t\tif (value.compareTo(0) == 1){\r\n\r\n\t\t\t\t\tmaxQuotaForOneCostDistributionItemTmp = getMaxQuotaForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\t\tmaxAmountForOneQuota = calculateAmountForValue('QUOTA', maxQuotaForOneCostDistributionItemTmp, costDistributionItemsWithoutCurrentItem, sum);\r\n\r\n\t\t\t\t\tvalueForCalculating = calculateAmountForValue('PERCENT', value, costDistributionItemsWithoutCurrentItem, sum);\r\n\r\n\t\t\t\t\tif (value.compareTo(maxAmountForOneQuota) == 1){\r\n\t\t\t\t\t\tvalueForCalculating = maxAmountForOneQuota;\r\n\t\t\t\t\t}else if (value.compareTo(0) == -1 || value.compareTo(0) == 0){\r\n\t\t\t\t\t\tvalueForCalculating = 0;\r\n\t\t\t\t\t}else if (valueForCalculating.compareTo(maxAmountForOneQuota) == 1 || valueForCalculating.compareTo(maxAmountForOneQuota) == 0){\r\n\t\t\t\t\t\tvalueForCalculating = maxAmountForOneQuota;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (valueForCalculating.compareTo(0) != 0){\r\n\t\t\t\t\t\tpercentOfMaxAmountForOneQuota = valueForCalculating.divide(maxAmountForOneQuota, 50);\r\n\t\t\t\t\t\tmaxQuotaForOneCostDistributionItem = getMaxQuotaForOneCostDistributionItem(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\t\t\tquotaWeighted = percentOfMaxAmountForOneQuota.multiply(maxQuotaForOneCostDistributionItem).setScale(1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tquotaForEt = quotaWeighted;\r\n\t\t\t} else if (costDistributionItemTypeOfValue === 'REST') {\r\n\t\t\t\tvar maxQuota = getCountWithoutFixed(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\tvar maxQuotaWeighted = getCountWeightedWithoutFixed(costDistributionItemsWithoutCurrentItem);\r\n\t\t\t\tquotaForEt = maxQuota.subtract(maxQuotaWeighted);\r\n\t\t\t}\r\n\r\n\t\t\treturn  quotaForEt.setScale(1);\r\n\t\t}\r\n\r\n\t\tfunction calculateAmountForValue(costDistributionItemTypeOfValue, value, costDistributionItemsWithoutCurrentItem, sum){\r\n\t\t\tvar calculateAmountForValue = 0;\r\n\r\n\t\t\tif (costDistributionItemTypeOfValue === 'QUOTA'){\r\n\t\t\t\tvar maxAmountForOneQuota = getMaxAmountForOneQuota(costDistributionItemsWithoutCurrentItem, sum);\r\n\r\n\t\t\t\tif (maxAmountForOneQuota.compareTo(0) == -1){\r\n\t\t\t\t\tmaxAmountForOneQuota = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar quotaOfCostDistributionItem = value.multiply(maxAmountForOneQuota).setScale(2);\r\n\t\t\t\tcalculateAmountForValue = quotaOfCostDistributionItem;\r\n\t\t\t}else if (costDistributionItemTypeOfValue === 'FIXED_AMOUNT'){\r\n\r\n\t\t\t\tcalculateAmountForValue = value;\r\n\t\t\t}else if (costDistributionItemTypeOfValue === 'PERCENT'){\r\n\t\t\t\tvar amountForQuota = sum.multiply(value).setScale(2);\r\n\t\t\t\tcalculateAmountForValue = amountForQuota;\r\n\t\t\t}else if (costDistributionItemTypeOfValue === 'REST') {\r\n\r\n\t\t\t\tvar sumOfAllCostDistributionItemsWithoutRest = 0;\r\n\t\t\t\tcostDistributionItemsWithoutCurrentItem.forEach(function(tmpCostDistributionItem){\r\n\t\t\t\t\tif (tmpCostDistributionItem.costDistributionItemTypeEnum != 'REST'){\r\n\t\t\t\t\t\tsumOfAllCostDistributionItemsWithoutRest.add(calculateAmountForCostDistributionItem(tmpCostDistributionItem, costDistributionItemsWithoutCurrentItem, sum));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar restSum = sum.subtract(sumOfAllCostDistributionItemsWithoutRest);\r\n\t\t\t\tcalculateAmountForValue = restSum;\r\n\t\t\t}\r\n\r\n\t\t\treturn calculateAmountForValue.setScale(2);\r\n\t\t}\r\n\r\n\t\tfunction calculatePercentForValue(costDistributionItemTypeOfValue, value, costDistributionItemsWithoutCurrentItem, sum){\r\n\t\t\tvar resultPercent = 0;\r\n\r\n\t\t\tif (costDistributionItemTypeOfValue === 'QUOTA'){\r\n\t\t\t\tvar amountForQuota = calculateAmountForValue('QUOTA', value, costDistributionItemsWithoutCurrentItem, sum);\r\n\t\t\t\tvar percent = amountForQuota.divide(sum, 30);\r\n\t\t\t\tresultPercent = percent;\r\n\t\t\t}else if (costDistributionItemTypeOfValue === 'FIXED_AMOUNT'){\r\n\t\t\t\tpercent = value.divide(sum, 2);\r\n\t\t\t\tresultPercent = percent;\r\n\t\t\t}else if (costDistributionItemTypeOfValue === 'PERCENT'){\r\n\t\t\t\tresultPercent = value;\r\n\t\t\t}\r\n\r\n\t\t\treturn resultPercent.setScale(2);\r\n\t\t}\r\n\r\n\t\tfunction getCountWithoutFixed(costDistributionItems){\r\n\t\t\tvar countWithoutFixed = 0;\r\n\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem1){\r\n\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum === 'QUOTA'){\r\n\t\t\t\t\tcountWithoutFixed = countWithoutFixed.add(1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn countWithoutFixed;\r\n\t\t}\r\n\r\n\t\tfunction getCountOfFixedAmount(costDistributionItems){\r\n\t\t\tvar getCountOfFixed = 0;\r\n\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem1){\r\n\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum === 'FIXED_AMOUNT'){\r\n\t\t\t\t\tgetCountOfFixed = getCountOfFixed.add(1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn getCountOfFixed;\r\n\t\t}\r\n\r\n\t\tfunction getCountOfPercent(costDistributionItems){\r\n\t\t\tvar getCountOfPercent = 0;\r\n\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem1){\r\n\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum === 'PERCENT'){\r\n\t\t\t\t\tgetCountOfPercent = getCountOfPercent.add(1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn getCountOfPercent;\r\n\t\t}\r\n\r\n\t\tfunction calculateAmountForCostDistributionItem(costDistributionItem, costDistributionItems, sum){\r\n\t\t\tvar costDistributionItemsWithoutCurrentItem = [];\r\n\t\t\tcostDistributionItems.forEach(function(item){\r\n\t\t\t\tcostDistributionItemsWithoutCurrentItem.push(item);\r\n\t\t\t});\r\n\r\n\t\t\tvar indexOfPosition = costDistributionItems.findIndex(function(item){\r\n\t\t\t\treturn item.costDistributionItemId === costDistributionItem.costDistributionItemId;\r\n\t\t\t});\r\n\t\t\tcostDistributionItemsWithoutCurrentItem.splice(indexOfPosition, 1);\r\n\r\n\t\t\treturn calculateAmountForValue(costDistributionItem.costDistributionItemTypeEnum, costDistributionItem.value, costDistributionItemsWithoutCurrentItem, sum).setScale(2);\r\n\t\t}\r\n\r\n\t\tfunction isCostDistributionComplete(costDistributionItems, sum){\r\n\r\n\t\t\tif (costDistributionItems.length == 0){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar countWeightedWithoutFixed = getCountWeightedWithoutFixed(costDistributionItems);\r\n\t\t\tvar countWithoutFixed = getCountWithoutFixed(costDistributionItems);\r\n\t\t\tvar countOfFixed = getCountOfFixedAmount(costDistributionItems);\r\n\t\t\tvar countOfPercent = getCountOfPercent(costDistributionItems);\r\n\r\n\t\t\tif (countWithoutFixed.compareTo(0) == 1){\r\n\t\t\t\treturn countWithoutFixed.compareTo(countWeightedWithoutFixed) == 0;\r\n\t\t\t}else{\r\n\t\t\t\tif (countOfFixed.compareTo(0) == 0 && countOfPercent.compareTo(0) == 1){\r\n\t\t\t\t\tvar sumOfPercent = 0;\r\n\t\t\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem){\r\n\t\t\t\t\t\tsumOfPercent = sumOfPercent.add(tmpCostDistributionItem.value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn sumOfPercent.compareTo(1) == 0;\r\n\t\t\t\t}else if (countOfFixed.compareTo(0) == 1 && countOfPercent.compareTo(0) == 0){\r\n\t\t\t\t\tvar sumOfFixedAmount = 0;\r\n\t\t\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem){\r\n\t\t\t\t\t\tsumOfFixedAmount = sumOfFixedAmount.add(tmpCostDistributionItem.value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn sumOfFixedAmount.compareTo(sum) == 0;\r\n\t\t\t\t}else if (countOfFixed.compareTo(0) == 1 && countOfPercent.compareTo(0) == 1){\r\n\t\t\t\t\tvar sumOfMixed = 0;\r\n\t\t\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem){\r\n\t\t\t\t\t\tsumOfMixed = calculateAmountForCostDistributionItem(tmpCostDistributionItem, costDistributionItems, sum);\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn sumOfMixed.compareTo(sum) == 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction calculateAmountForCostDistributionItemPrecise(costDistributionItem, costDistributionItems, sum){\r\n\t\t\tvar resultAmount;\r\n\r\n\t\t\tvar costDistributionItemsWithoutCurrentItem = [];\r\n\t\t\tcostDistributionItems.forEach(function(item){\r\n\t\t\t\tcostDistributionItemsWithoutCurrentItem.push(item);\r\n\t\t\t});\r\n\r\n\t\t\tvar indexOfPosition = costDistributionItems.findIndex(function(item){\r\n\t\t\t\treturn item.costDistributionItemId === costDistributionItem.costDistributionItemId;\r\n\t\t\t});\r\n\t\t\tcostDistributionItemsWithoutCurrentItem.splice(indexOfPosition, 1);\r\n\r\n\t\t\tif (isCostDistributionComplete(costDistributionItems, sum)){\r\n\t\t\t\tvar countCostDistributionItemsIncludeQuota = 0;\r\n\t\t\t\tvar counter = 0;\r\n\t\t\t\tvar costDistributionPosition = -1;\r\n\r\n\t\t\t\tvar costDistributionItemQuotaList = [];\r\n\r\n\t\t\t\tcostDistributionItems.forEach(function(tmpCostDistributionItem1){\r\n\t\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemTypeEnum !== 'FIXED_AMOUNT'){\r\n\r\n\t\t\t\t\t\tcountCostDistributionItemsIncludeQuota = countCostDistributionItemsIncludeQuota + 1;\r\n\r\n\t\t\t\t\t\tif (tmpCostDistributionItem1.costDistributionItemId === costDistributionItem.costDistributionItemId){\r\n\t\t\t\t\t\t\tcostDistributionPosition=counter;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcostDistributionItemQuotaList.push(tmpCostDistributionItem1);\r\n\r\n\t\t\t\t\t\tcounter++;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (countCostDistributionItemsIncludeQuota > 1){\r\n\t\t\t\t\tvar calculatedRestSum = getCalculatedRestSum(sum, costDistributionItems);\r\n\t\t\t\t\tresultAmount = calculateAmountForValue(costDistributionItem.costDistributionItemTypeEnum, costDistributionItem.value, costDistributionItemsWithoutCurrentItem, sum).setScale(2);\r\n\r\n\t\t\t\t\tif (calculatedRestSum.compareTo(0) == -1 || calculatedRestSum.compareTo(0) == 1){\r\n\r\n\t\t\t\t\t\tvar rest = calculatedRestSum;\r\n\r\n\t\t\t\t\t\tvar corrector = 1;\r\n\r\n\t\t\t\t\t\tif (rest.compareTo(0) == -1){\r\n\t\t\t\t\t\t\tcorrector = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar restAmountForOneCostDistributionItem = calculatedRestSum.multiply(corrector).multiply(100).divide(countCostDistributionItemsIncludeQuota,50).floor();\r\n\t\t\t\t\t\tvar remainder = calculatedRestSum.multiply(corrector).multiply(100).remainder(countCostDistributionItemsIncludeQuota);\r\n\r\n\t\t\t\t\t\trestAmountForOneCostDistributionItem = restAmountForOneCostDistributionItem.multiply(corrector);\r\n\t\t\t\t\t\tremainder = remainder.multiply(corrector);\r\n\r\n\t\t\t\t\t\tresultAmount = resultAmount.add(restAmountForOneCostDistributionItem.divide(100, 2));\r\n\r\n\t\t\t\t\t\tfor(var i = 0; i < remainder.multiply(corrector).setScale(0); i++){\r\n\t\t\t\t\t\t\tif (i == costDistributionPosition){\r\n\t\t\t\t\t\t\t\tresultAmount = resultAmount.add(0.01.multiply(corrector));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresultAmount = resultAmount.setScale(2);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tresultAmount = calculateAmountForValue(costDistributionItem.costDistributionItemTypeEnum, costDistributionItem.value, costDistributionItemsWithoutCurrentItem, sum).setScale(2);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tresultAmount = calculateAmountForValue(costDistributionItem.costDistributionItemTypeEnum, costDistributionItem.value, costDistributionItemsWithoutCurrentItem, sum).setScale(2);\r\n\t\t\t}\r\n\r\n\t\t\treturn resultAmount;\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('SearchService', SearchService);\r\n\r\n    SearchService.$inject = ['$http','$log','NotificationService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction SearchService($http, $log,NotificationService) {\r\n\t\tvar base = {\r\n                searchBase: '/webapp/api/search/withFilterBean'\r\n            },\r\n\t\t\tservice = {\r\n\t\t\t\tsearch: search,\r\n\t\t\t\tgetSearchConfiguration: getSearchConfiguration,\r\n                setSearchConfiguration: setSearchConfiguration,\r\n                resetSearchConfiguration: resetSearchConfiguration,\r\n                repairSearchConfiguration: repairSearchConfiguration,\r\n                isSearchConfigurationDefaultOne: isSearchConfigurationDefaultOne\r\n\t\t\t},\r\n            defaultSearchConfiguration = {\r\n                incomeMainFunctionEnum: true,\r\n                expenseMainFunctionEnum: true,\r\n                repetitionTypeEnum : null,\r\n                costDistributionId: null,\r\n                specialType: null,\r\n                paymentRecipientPerson: null,\r\n                costPayer: null,\r\n                payerPerson: null,\r\n                invoiceCategoryDTO: null,\r\n                startDate: null,\r\n                endDate: null,\r\n                remarks: null,\r\n                fullText: null\r\n            },\r\n            searchConfiguration = {\r\n                incomeMainFunctionEnum: true,\r\n                expenseMainFunctionEnum: true,\r\n                repetitionTypeEnum : null,\r\n                costDistributionId: null,\r\n                specialType: null,\r\n                paymentRecipientPerson: null,\r\n                costPayer: null,\r\n                payerPerson: null,\r\n                invoiceCategoryDTO: null,\r\n                startDate: null,\r\n                endDate: null,\r\n                remarks: null,\r\n                fullText: null\r\n            };\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n        function resetSearchConfiguration(){\r\n            searchConfiguration = angular.copy(defaultSearchConfiguration);\r\n        }\r\n        \r\n        function setSearchConfiguration(searchConfigurationInput){\r\n            searchConfiguration = searchConfigurationInput;\r\n        }\r\n\r\n        function isSearchConfigurationDefaultOne(){\r\n            if (searchConfiguration.startDate == undefined || searchConfiguration.startDate == NaN){\r\n                searchConfiguration.startDate = null;\r\n            }\r\n            if (searchConfiguration.endDate == undefined || searchConfiguration.endDate == NaN){\r\n                searchConfiguration.endDate = null;\r\n            }\r\n            return angular.equals(searchConfiguration, defaultSearchConfiguration);\r\n        }\r\n\r\n\t\tfunction getSearchConfiguration(){\r\n\t\t\treturn searchConfiguration;\r\n\t\t}\r\n\t\t\r\n\t\tfunction repairSearchConfiguration(){\r\n            if (searchConfiguration.repetitionTypeEnum === ''){\r\n                searchConfiguration.repetitionTypeEnum = null;\r\n            }\r\n            if (searchConfiguration.costDistributionId === ''){\r\n                searchConfiguration.costDistributionId = null;\r\n            }\r\n            if (searchConfiguration.specialType === ''){\r\n                searchConfiguration.specialType = null;\r\n            }\r\n            if (searchConfiguration.remarks === ''){\r\n                searchConfiguration.remarks = null;\r\n            }\r\n        }\r\n\r\n\t\tfunction search(){\r\n            // InvoiceService.setIsLoading(true);\r\n\r\n            return $http({\r\n                method: 'POST',\r\n                url: base.searchBase,\r\n                data: searchConfiguration,\r\n                headers: {\r\n                    'Content-Type': 'application/json;charset=UTF-8'\r\n                }\r\n            }).then(\r\n                function(result) {\r\n                    var invoiceList = result.data;\r\n\r\n                    // InvoiceService.setInvoices(invoiceList);\r\n                    // InvoiceService.setIsLoading(false);\r\n                },\r\n                function(result) {\r\n                    $log.warn('Could not get invoices!','result',result);\r\n                    // InvoiceService.setIsLoading(false);\r\n                }\r\n            );\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('ProfileController', ProfileController);\r\n\r\n    ProfileController.$inject = ['UserService', 'NotificationService', 'SettingsService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction ProfileController(UserService, NotificationService, SettingsService) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.currentUser = {};\r\n\t\tvm.mailSendEnabled = false;\r\n\r\n\t\tvm.submitForm = function(){\r\n            UserService.update(vm.currentUser);\r\n\t\t};\r\n\r\n\t\tvm.sendPasswordResetMail = function(){\r\n\t\t\tUserService.sendPassword(vm.currentUser.email).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Eine E-Mail zur Passwort-nderung wurde verschickt.',5000);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(error) {\r\n\t\t\t\t\tNotificationService.create('Leider ist ein unerwarteter Fehler aufgetreten.',8000);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tactivate();\r\n\r\n        function activate(){\r\n\t\t\tUserService.currentUser().then(function(response){\r\n\t\t\t\tvm.currentUser = response;\r\n\t\t\t});\r\n\r\n\t\t\tSettingsService.mailSendEnabled().then(function(responseMail){\r\n\t\t\t\tvm.mailSendEnabled = responseMail.data.value;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('SettingsService', SettingsService);\r\n\r\n\tSettingsService.$inject = ['$http','NotificationService'];\r\n\r\n\t\tfunction SettingsService($http,NotificationService) {\r\n\t\t\tvar base = {\r\n                \tsettings: '/webapp/api/settings'\r\n            \t},\r\n\t\t\t\tservice = {\r\n                    getInit: getInit,\r\n\t\t\t\t\tupdateInit: updateInit,\r\n\t\t\t\t\tget: get,\r\n\t\t\t\t\tupdate: update,\r\n\t\t\t\t\tsendTestMail: sendTestMail,\r\n\t\t\t\t\tscansioEnabled: scansioEnabled,\r\n\t\t\t\t\tmailSendEnabled: mailSendEnabled,\r\n\t\t\t\t\tisCustomized: isCustomized,\r\n\t\t\t\t\tversionCheck: versionCheck\r\n\t\t\t\t};\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////\r\n\r\n\t\tfunction updateInit(setupData){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'PUT',\r\n\t\t\t\tdata: setupData,\r\n\t\t\t\turl: base.settings + '/initSetupData'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction getInit() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings + '/initSetupData'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction versionCheck() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings + '/searchForUpdate'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction update(setupData){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'PUT',\r\n\t\t\t\tdata: setupData,\r\n\t\t\t\turl: base.settings\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction sendTestMail(setupData){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tdata: setupData,\r\n\t\t\t\turl: base.settings + '/sendTestMail'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction get() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction scansioEnabled() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings + '/scansioEnabled'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction mailSendEnabled() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings + '/mailSendEnabled'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction isCustomized() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.settings + '/isCustomized'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('SetupController', SetupController);\r\n\r\n    SetupController.$inject = ['$http', '$state', 'SettingsService', 'NotificationService','UserService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction SetupController($http, $state, SettingsService, NotificationService,UserService) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.setupData = {};\r\n\t\tvm.loaded = false;\r\n\t\tvm.version = null;\r\n\r\n\t\tactivate();\r\n\r\n\t\tvm.saveData = function(){\r\n\t\t\tif (!vm.setupData.isCustomized){\r\n\t\t\t\tSettingsService.updateInit(vm.setupData).then(function(response){\r\n\t\t\t\t\tvar newUrl = window.location.protocol + \"//\" + window.location.host;\r\n\t\t\t\t\twindow.location.replace(newUrl);\r\n\t\t\t\t},function(error){\r\n\t\t\t\t\tNotificationService.create('Fehler bei der Initialisierung! Evtl. fehlende Ordner-Zugriffsberechtigungen.',6000);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tSettingsService.update(vm.setupData).then(function(response){\r\n\t\t\t\t\tNotificationService.create('Konfiguration erfolgreich gespeichert.',6000);\r\n\t\t\t\t\tUserService.resetUser();\r\n\t\t\t\t},function(error){\r\n\t\t\t\t\tNotificationService.create('Fehler beim Speichern! Bitte Ordner-Zugriffsberechtigungen berprfen.',6000);\r\n\t\t\t\t\tUserService.resetUser();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tvm.sendTestMail = function() {\r\n\t\t\tNotificationService.create('Einen Moment bitte. Test-E-Mail wird versandt!',6000);\r\n\t\t\tSettingsService.sendTestMail(vm.setupData).then(function(response){\r\n\t\t\t\t$('#updateModalDialog').modal('show');\r\n\t\t\t},function(error){\r\n\t\t\t\tNotificationService.create('Versand der Test-E-Mail fehlgeschlagen!',6000);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.versionCheck = function() {\r\n\t\t\tNotificationService.create('Einen Moment bitte. Es wird auf Updates geprft!',1000);\r\n\t\t\tSettingsService.versionCheck().then(function(response){\r\n\t\t\t\tvm.version = response.data;\r\n\t\t\t\t$('#updateModalDialog').modal('show');\r\n\t\t\t},function(error){\r\n\t\t\t\tNotificationService.create('Abruf der aktuellen Version fehlgeschlagen!.',6000);\r\n\t\t\t});\r\n\t\t};\r\n\r\n        function activate(){\r\n        \tSettingsService.isCustomized().then(function(response){\r\n        \t\tif (response.data.value){\r\n\t\t\t\t\tSettingsService.get().then(function(response){\r\n\t\t\t\t\t\tvm.setupData = response.data;\r\n\t\t\t\t\t\tvm.loaded = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tSettingsService.getInit().then(function(response){\r\n\t\t\t\t\t\tvm.setupData = response.data;\r\n\t\t\t\t\t\tvm.loaded = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('StandingOrderListController', StandingOrderListController);\r\n\r\n\tStandingOrderListController.$inject = ['$state','$stateParams','InvoiceService', 'SearchService'];\r\n\r\n\t/* @ngInject */\r\n\tfunction StandingOrderListController($state,$stateParams,InvoiceService, SearchService) {\r\n\t\tvar vm = this;\r\n\t\tvm.title = 'StandingOrderListController';\r\n\r\n\t\tvm.toggleFilter = false;\r\n\r\n\t\tvm.goToInvoice = function(invoiceId, viewList) {\r\n\t\t\t$state.go('invoices.details', {\r\n\t\t\t\tinvoiceId: invoiceId,\r\n\t\t\t\tview: viewList,\r\n\t\t\t\treturnView: \"standingorders.list\",\r\n\t\t\t\tisStandingOrder: true\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.getInvoices = function(mode){\r\n\t\t\tvar invoices = InvoiceService.getInvoices(mode);\r\n\t\t\treturn invoices;\r\n\t\t};\r\n\r\n        vm.startSearch = function(){\r\n            // SearchService.search();\r\n\t\t\tvm.refreshInvoices();\r\n        };\r\n\r\n\t\tvm.toggleFilterView = function(){\r\n\t\t\tvm.toggleFilter = !vm.toggleFilter;\r\n\t\t};\r\n\r\n\t\tvm.refreshInvoices = function(){\r\n\t\t\t// SearchService.resetSearchConfiguration();\r\n\t\t\tInvoiceService.setSearchMode(false);\r\n\t\t\tInvoiceService.allInvoices();\r\n\t\t};\r\n\r\n        vm.invoiceServiceLoading = function(){\r\n\t\t\treturn InvoiceService.isLoading();\r\n\t\t};\r\n\r\n\t\tvm.newExpense = function(){\r\n\t\t\t$state.go('invoices.create', {\r\n\t\t\t\ttransactionType: 'EXPENSE',\r\n\t\t\t\tisStandingOrder: true,\r\n                returnView: \"standingorders.list\"\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.newIncome = function(){\r\n\t\t\t$state.go('invoices.create', {\r\n\t\t\t\ttransactionType: 'INCOME',\r\n\t\t\t\tisStandingOrder: true,\r\n                returnView: \"standingorders.list\"\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvm.otherMenuOptions = [\r\n\t\t\t['Einnahme', function ($itemScope, $event, color) {\r\n\t\t\t\tvm.newIncome();\r\n\t\t\t}],['Ausgabe', function ($itemScope, $event, color) {\r\n\t\t\t\tvm.newExpense();\r\n\t\t\t}]\r\n\t\t];\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('ShellController',ShellController);\r\n\r\n    ShellController.$inject = ['$state','$http', 'MessageService', 'NotificationService','BillingService','UserService','SettingsService'];\r\n\r\n\r\n\tfunction ShellController($state, $http, MessageService, NotificationService, BillingService,UserService,SettingsService) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.currentUser = {appUserName: 'Keine Angabe'};\r\n\r\n\t\tvm.userCanEditUsers = false;\r\n\t\tvm.userCanEditSettings = false;\r\n\r\n\t\tvm.settingsLoaded = false;\r\n\r\n\t\tvm.countOfMessages = function(){\r\n\t\t\treturn MessageService.getMessages().length;\r\n\t\t};\r\n\r\n\t\tvm.getMessages = function(){\r\n\t\t\tvar messages = MessageService.getMessages();\r\n\t\t\treturn messages;\r\n\t\t};\r\n\r\n\t\tvm.getMessageDTO = function(basicDataMessage){\r\n\t\t\treturn JSON.parse(basicDataMessage.value)\r\n\t\t};\r\n\r\n\t\tvm.firstAction = function(basicDataMessage){\r\n\t\t\tBillingService.billingUpdate(basicDataMessage.object1Id, basicDataMessage.messageType);\r\n\t\t};\r\n\r\n\t\tvm.secondAction = function(basicDataMessage){\r\n\t\t\tBillingService.billingDelete(basicDataMessage.object1Id);\r\n\t\t};\r\n\r\n\t\tvm.thirdAction = function(basicDataMessage){\r\n\t\t\tMessageService.deleteMessage(basicDataMessage.basicDataId);\r\n\t\t};\r\n\r\n\t\tvm.problemSolved = function(basicDataMessage){\r\n\t\t\tMessageService.problemSolved(basicDataMessage.basicDataId);\r\n\t\t};\r\n\r\n\t\tvm.goToInvoice = function(invoiceId) {\r\n\t\t\tvar params = {\r\n\t\t\t\tinvoiceId: invoiceId\r\n\t\t\t};\r\n\r\n\t\t\t$state.go('invoices.details', params);\r\n\t\t};\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction activate(){\r\n\t\t\tSettingsService.isCustomized().then(function(response){\r\n\t\t\t\tif (response.data.value){\r\n\t\t\t\t\tUserService.currentUser().then(function(response){\r\n\t\t\t\t\t\tvm.currentUser = response;\r\n\r\n\t\t\t\t\t\tUserService.hasUserRight('EDIT_USERS').then(function(result){\r\n\t\t\t\t\t\t\tvm.userCanEditUsers = result;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tUserService.hasUserRight('EDIT_SETTINGS').then(function(result){\r\n\t\t\t\t\t\t\tvm.userCanEditSettings = result;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvm.settingsLoaded = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.controller('UserListController', UserListController);\r\n\r\n\tUserListController.$inject = ['UserService', 'SettingsService','NotificationService', '_'];\r\n\r\n\t/* @ngInject */\r\n\tfunction UserListController(UserService, SettingsService,NotificationService, _) {\r\n\t\tvar vm = this;\r\n\r\n\t\tvm.users = [];\r\n\t\tvm.key = null;\r\n\t\tvm.userToDelete = null;\r\n\r\n\t\tvm.scansioEnabled = false;\r\n\r\n\t\tvm.lockUser = function(user) {\r\n\t\t\tuser.editable = false;\r\n\r\n\t\t\tif (user.new) {\r\n\t\t\t\tvar indexOfUser = _.indexOf(vm.users, user);\r\n\t\t\t\tvm.users.splice(indexOfUser, 1);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvm.updateUser = function(user){\r\n\r\n\t\t\tif (!user.appUserId) {\r\n\t\t\t\tuser.appUserId = generateUUID();\r\n\t\t\t}\r\n\r\n            UserService.adminUpdate(user).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Benutzer wurde aktualisiert!',5000);\r\n\t\t\t\t\tuser.editable = false;\r\n\t\t\t\t\tuser.new = false;\r\n\t\t\t\t\tuser = result.data;\r\n\r\n\t\t\t\t\tvar foundUser = _.filter(vm.users, function(tmpUser){ return (tmpUser.appUserId === user.appUserId);});\r\n\t\t\t\t\tif (foundUser && foundUser.length > 0){\r\n\t\t\t\t\t\tvar foundUserIndex = _.indexOf(vm.users, foundUser[0]);\r\n\r\n\t\t\t\t\t\tvm.users[foundUserIndex] = result.data;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tUserService.resetUser();\r\n\t\t\t\t},\r\n\t\t\t\tfunction(error) {\r\n\t\t\t\t\tNotificationService.create('Ausfhrung nicht mglich!',8000);\r\n\t\t\t\t\tUserService.list().then(function(response){\r\n\t\t\t\t\t\tvm.users = response.data;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tuser.editable = false;\r\n\t\t\t\t\tif (user.new) {\r\n\t\t\t\t\t\tvar indexOfUser = _.indexOf(vm.users, user);\r\n\t\t\t\t\t\tvm.users.splice(indexOfUser, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tvm.showDeleteUserDialog = function(user) {\r\n\t\t\tvm.userToDelete = user;\r\n\t\t\t$('#userDeleteModalDialog').modal('show');\r\n\t\t};\r\n\r\n\t\tvm.deleteUser = function(user){\r\n\t\t\tUserService.adminDelete(user).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Benutzer wurde gelscht!',5000);\r\n\t\t\t\t\tvar indexOfUser = _.indexOf(vm.users, user);\r\n\t\t\t\t\tvm.users.splice(indexOfUser, 1);\r\n\t\t\t\t\tvm.userToDelete = null;\r\n\r\n\t\t\t\t\t$('#userDeleteModalDialog').modal('hide');\r\n\t\t\t\t},\r\n\t\t\t\tfunction(error) {\r\n\t\t\t\t\tNotificationService.create('Ausfhrung nicht mglich!',8000);\r\n\t\t\t\t\tUserService.list().then(function(response){\r\n\t\t\t\t\t\tvm.users = response.data;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tuser.editable = false;\r\n\t\t\t\t\tif (user.new) {\r\n\t\t\t\t\t\tvar indexOfUser = _.indexOf(vm.users, user);\r\n\t\t\t\t\t\tvm.users.splice(indexOfUser, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tvm.addUser = function() {\r\n\t\t\tvm.users.unshift({\r\n\t\t\t\tnew: true,\r\n\t\t\t\teditable: true,\r\n\t\t\t\tenabled: true,\r\n\t\t\t\tuseAndroid: true,\r\n\t\t\t\tuseOcr: false,\r\n\t\t\t\teditUsers: false,\r\n\t\t\t\teditSettings: false}\r\n\t\t\t)\r\n\t\t};\r\n\r\n\t\tvm.sendPassword = function(mail){\r\n\t\t\tUserService.sendPassword(mail).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tif (result.status === 200){\r\n\t\t\t\t\t\tvm.key = result.data.value;\r\n\t\t\t\t\t\t$('#passwordResetModalDialog').modal('show');\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tNotificationService.create('Eine E-Mail zur Wiederherstellung wurde verschickt.',5000);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuser.editable = false;\r\n\t\t\t\t},\r\n\t\t\t\tfunction(error) {\r\n\t\t\t\t\tNotificationService.create('Leider ist ein unerwarteter Fehler aufgetreten.',8000);\r\n\t\t\t\t\tuser.editable = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\tactivate();\r\n\r\n\t\tfunction generateUUID(){\r\n\t\t\tfunction s4() {\r\n\t\t\t\treturn Math.floor((1 + Math.random()) * 0x10000)\r\n\t\t\t\t\t.toString(16)\r\n\t\t\t\t\t.substring(1);\r\n\t\t\t}\r\n\t\t\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n\t\t\t\ts4() + '-' + s4() + s4() + s4();\r\n\t\t}\r\n\r\n        function activate(){\r\n\r\n\t\t\tSettingsService.scansioEnabled().then(function(responseScansio){\r\n\t\t\t\tvm.scansioEnabled = responseScansio.data.value;\r\n\t\t\t\tUserService.list().then(function(response){\r\n\t\t\t\t\tvm.users = response.data;\r\n\t\t\t\t},function(error){\r\n\t\t\t\t\tNotificationService.create('Benutzer konnnten nicht geladen werden.',4000);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();\r\n\r\n","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function() {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('UserService', UserService);\r\n\r\n    UserService.$inject = ['$http', '$q', 'NotificationService'];\r\n\r\n\t\tfunction UserService($http, $q, NotificationService) {\r\n\t\t\tvar base = {\r\n                \tusers: '/webapp/api/appusers',\r\n\t\t\t\t\tsendPassword: '/webapp/api',\r\n            \t},\r\n\t\t\t\tservice = {\r\n                    update: update,\r\n\t\t\t\t\tadminUpdate: adminUpdate,\r\n\t\t\t\t\tadminDelete: adminDelete,\r\n\t\t\t\t\tsendPassword: sendPassword,\r\n\t\t\t\t\tcurrentUser: currentUserFun,\r\n\t\t\t\t\tlist: list,\r\n\t\t\t\t\thasUserRight: hasUserRight,\r\n\t\t\t\t\tresetUser: resetUser\r\n\t\t\t\t},\r\n\t\t\t\tcurrentUser = null;\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////\r\n\r\n\t\tfunction list(){\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.users,\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction sendPassword(mail){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: base.sendPassword + '/sendPasswordKey',\r\n\t\t\t\tdata: {value: mail},\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction adminUpdate(appUserDTO){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'PUT',\r\n\t\t\t\turl: base.users,\r\n\t\t\t\tdata: appUserDTO,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction resetUser() {\r\n\t\t\tcurrentUser = null;\r\n\t\t\tcurrentUserFun();\r\n\t\t}\r\n\r\n\t\tfunction adminDelete(appUserDTO){\r\n\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\turl: base.users + '/' + appUserDTO.appUserId,\r\n\t\t\t\tdata: appUserDTO,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction update(appUserDTO){\r\n\r\n\t\t\t$http({\r\n\t\t\t\tmethod: 'PUT',\r\n\t\t\t\turl: base.users + '/currentUser',\r\n\t\t\t\tdata: appUserDTO,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t}).then(\r\n\t\t\t\tfunction(result) {\r\n\t\t\t\t\tNotificationService.create('Profil wurde aktualisiert!',5000);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tfunction currentUserFun() {\r\n\r\n\t\t\treturn $q(function(resolve, error) {\r\n\t\t\t\tif (currentUser != null){\r\n\t\t\t\t\tresolve(currentUser);\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$http({\r\n\t\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\t\turl: base.users + '/currentUser'\r\n\t\t\t\t\t}).then(function(response){\r\n\t\t\t\t\t\tcurrentUser = response.data;\r\n\t\t\t\t\t\tresolve(currentUser);\r\n\t\t\t\t\t},function(response){\r\n\t\t\t\t\t\terror(null);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction hasUserRight(rightCode) {\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\tcurrentUserFun().then(function(user){\r\n\t\t\t\t\tresolve(findRight(user.appRightDTOs, rightCode));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction findRight(roles, rightCode){\r\n\t\t\tvar matchedRights = _.chain(roles)\r\n\t\t\t\t.pluck('code')\r\n\t\t\t\t.intersection([rightCode])\r\n\t\t\t\t.value();\r\n\r\n\t\t\tif (matchedRights.length > 0) {\r\n\t\t\t\treturn true\r\n\t\t\t}else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n})();","/*\r\n * NextBill server application\r\n *\r\n * @author Michael Roedel\r\n * Copyright (c) 2020 Michael Roedel\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as published by\r\n * the Free Software Foundation, either version 3 of the License, or\r\n * (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tangular\r\n\t\t.module('msWebApp')\r\n\t\t.factory('UsercontactService', UsercontactService);\r\n\r\n\tUsercontactService.$inject = ['$http','$q'];\r\n\r\n\t/* @ngInject */\r\n\tfunction UsercontactService($http,$q) {\r\n\t\tvar base = {\r\n\t\t\t\tusercontacts: '/webapp/api/usercontacts',\r\n\t\t\t\tfindByEmail: '/webapp/api/appusers/findForUserContact',\r\n\t\t\t\tcurrentUser: '/webapp/api/appusers/currentUser'\r\n\t\t\t},\r\n\t\t\tservice = {\r\n\t\t\t\tlist: list,\r\n\t\t\t\tgetOne: getOne,\r\n                getUsers: getUsers,\r\n                getUserContacts: getUserContacts,\r\n                getProjects: getProjects,\r\n\t\t\t\tcreateProject: createProject,\r\n\t\t\t\tcreateUserContact: createUserContact,\r\n\t\t\t\tremove: remove,\r\n\t\t\t\tcreateAppUserContact: createAppUserContact,\r\n\t\t\t\tgetFoundAppUser: getFoundAppUser,\r\n\t\t\t\tsearchForUser: searchForUser,\r\n\t\t\t\tgetCurrentUSer: getCurrentUser\r\n\t\t\t},\r\n\t\t\tfoundAppUser = null,\r\n\t\t\tallContacts = [],\r\n            userContacts = [],\r\n            users = [],\r\n            projects = [];\r\n\r\n\t\tactivate();\r\n\r\n\t\treturn service;\r\n\r\n\t\t////////////////\r\n\r\n\t\tfunction list() {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.usercontacts\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getCurrentUser(){\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\turl: base.currentUser\r\n\t\t\t\t}).then(function(response){\r\n\t\t\t\t\tvar currentUserData = response.data;\r\n\t\t\t\t\tcurrentUserData.contactName = currentUserData.appUserName;\r\n\t\t\t\t\tallContacts.push(currentUserData);\r\n\t\t\t\t\tresolve(currentUserData);\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction getFoundAppUser(){\r\n\t\t\treturn foundAppUser;\r\n\t\t}\r\n\r\n\t\tfunction getUsers(){\r\n\t\t\treturn users;\r\n\t\t}\r\n\r\n        function getUserContacts(){\r\n            return userContacts;\r\n        }\r\n\r\n        function getProjects(){\r\n            return projects;\r\n        }\r\n\r\n\t\tfunction activate(){\r\n\r\n            list().then(\r\n                function(response) {\r\n                    allContacts = response.data;\r\n\t\t\t\t\tgetCurrentUser().then(function(response){\r\n\t\t\t\t\t\tdistributeContacts();\r\n\t\t\t\t\t});\r\n                }\r\n            );\r\n\t\t}\r\n\r\n\t\tfunction searchForUser(searchMail) {\r\n\r\n\t\t\tvar appUserDTO = {\r\n\t\t\t\temail: searchMail\r\n\t\t\t};\r\n\r\n\t\t\t$http({\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turl: base.findByEmail,\r\n\t\t\t\tdata: appUserDTO,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t}\r\n\t\t\t}).then(\r\n\t\t\t\tfunction(response){\r\n\t\t\t\tfoundAppUser = response.data;\r\n\t\t\t},\r\n\t\t\tfunction(response){\r\n\t\t\t\tfoundAppUser = null;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction distributeContacts(){\r\n\t\t\tuserContacts = _.filter(allContacts, function(userContact){ return (userContact.appUserContactId === null && (userContact.project == null || userContact.project == undefined));});\r\n\t\t\tusers = _.filter(allContacts, function(userContact){ return (userContact.appUserContactId != null && (userContact.project == null || userContact.project == undefined))});\r\n\t\t\tprojects = _.filter(allContacts, function(userContact){ return (userContact.project != null);});\r\n\r\n\t\t\tvar foundUsers = _.filter(allContacts, function(userContact){ return (userContact.appUserName != null)});\r\n\t\t\tfoundUsers.forEach(function(foundUser) {\r\n\t\t\t\tusers.push(foundUser);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction getOne(uuid) {\r\n\t\t\treturn $http({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: base.usercontacts + '/' + uuid\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction createAppUserContact(){\r\n\r\n\t\t\tvar userContactDTO = {\r\n\t\t\t\tappUserContactId: foundAppUser.appUserId,\r\n\t\t\t\tcontactName: foundAppUser.appUserName,\r\n\t\t\t\temail: foundAppUser.email\r\n\t\t\t};\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\turl: base.usercontacts,\r\n\t\t\t\t\tdata: userContactDTO,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tallContacts.push(result.data);\r\n\t\t\t\t\t\tfoundAppUser = null;\r\n\t\t\t\t\t\tdistributeContacts();\r\n\t\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction createProject(projectNewName){\r\n\r\n\t\t\tvar userContactDTO = {\r\n\t\t\t\tcontactName: projectNewName,\r\n\t\t\t\tproject: true\r\n\t\t\t};\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\turl: base.usercontacts,\r\n\t\t\t\t\tdata: userContactDTO,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tallContacts.push(result.data);\r\n\t\t\t\t\t\tdistributeContacts();\r\n\t\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction createUserContact(userContactNewName){\r\n\r\n\t\t\tvar userContactDTO = {\r\n\t\t\t\tcontactName: userContactNewName\r\n\t\t\t};\r\n\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\t$http({\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\turl: base.usercontacts,\r\n\t\t\t\t\tdata: userContactDTO,\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'application/json;charset=UTF-8'\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\tallContacts.push(result.data);\r\n\t\t\t\t\t\tdistributeContacts();\r\n\t\t\t\t\t\tresolve(result.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction remove(userContactId){\r\n\t\t\treturn $q(function(resolve) {\r\n\t\t\t\treturn $http({\r\n\t\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\t\turl: base.usercontacts + '/' + userContactId\r\n\t\t\t\t}).then(\r\n\t\t\t\t\tfunction(result) {\r\n\r\n\t\t\t\t\t\tvar foundUserContact = _.filter(allContacts, function(userContact){ return (userContact.userContactId === userContactId);});\r\n\t\t\t\t\t\tif (foundUserContact != null && foundUserContact != undefined && foundUserContact.length > 0){\r\n\t\t\t\t\t\t\tvar foundUserContactIndex = _.indexOf(allContacts, foundUserContact[0]);\r\n\r\n\t\t\t\t\t\t\tallContacts.splice(foundUserContactIndex, 1);\r\n\r\n\t\t\t\t\t\t\tdistributeContacts();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction(result) {\r\n\t\t\t\t\t\t$log.warn('Could not delete!','result',result);\r\n\t\t\t\t\t\tresolve(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n})();\r\n\r\n"]}