!function(){"use strict";angular.module("msWebApp",["ui.router","monospaced.elastic","moment-picker","pascalprecht.translate","angular-loading-bar","ui.bootstrap.contextMenu","chart.js","msWebApp.msInputDate","msWebApp.msPaymentpersonSelect","msWebApp.msCostdistributioncalculate","msWebApp.msInvoicecategorieSelect","msWebApp.msArticlesSelect","msWebApp.msSearchConfiguration","msWebApp.msInvoiceTable","msWebApp.msInvoiceSummary","angularFileUpload","infinite-scroll"]).constant("csrfToken",window.csrfToken).constant("moment",window.moment).constant("_",window._).constant("ColorHash",window.ColorHash).constant("Chart",window.Chart).value("THROTTLE_MILLISECONDS",2e3)}(),function(){"use strict";function e(e,t,n,i){e.defaults.xsrfHeaderName=csrfToken,e.defaults.xsrfCookieName=csrfToken,t.when("/invoices","/invoices/list").otherwise("/"),n.state("dashboard",{url:"/",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"vm"}).state("setup",{url:"/setup",templateUrl:"app/settings/setup.html",controller:"SetupController",controllerAs:"vm"}).state("profile",{url:"/profile",templateUrl:"app/settings/profile.html",controller:"ProfileController",controllerAs:"vm"}).state("invoices",{abstract:!0,url:"/invoices",template:"<ui-view/>"}).state("invoices.list",{url:"/list?view",templateUrl:"app/invoices/invoice-list.html",controller:"InvoiceListController",controllerAs:"vm"}).state("user",{abstract:!0,url:"/user",template:"<ui-view/>"}).state("user.list",{url:"/list",templateUrl:"app/user/user-list.html",controller:"UserListController",controllerAs:"vm"}).state("budgets",{abstract:!0,url:"/budgets",template:"<ui-view/>"}).state("budgets.list",{url:"/budgets",templateUrl:"app/budgets/budget-list.html",controller:"BudgetListController",controllerAs:"vm"}).state("budgets.create",{url:"/new",templateUrl:"app/budgets/budget-edit.html",controller:"BudgetEditController",controllerAs:"vm"}).state("budgets.edit",{url:"/:budgetId",templateUrl:"app/budgets/budget-edit.html",controller:"BudgetEditController",controllerAs:"vm"}).state("standingorders",{abstract:!0,url:"/standingorders",template:"<ui-view/>"}).state("standingorders.list",{url:"/list?view",templateUrl:"app/standingorders/standingorder-list.html",controller:"StandingOrderListController",controllerAs:"vm"}).state("billings",{abstract:!0,url:"/billings",template:"<ui-view/>"}).state("billings.processList",{url:"/processList",templateUrl:"app/billings/billing-process-list.html",controller:"BillingProcessListController",controllerAs:"vm"}).state("billings.create",{url:"/create",templateUrl:"app/billings/billing-create.html",controller:"BillingCreateController",controllerAs:"vm",params:{sumToBePaid:null,userContact:null,billingListItem:null}}).state("billings.details",{url:"/:billingId",templateUrl:"app/billings/billing-details.html",controller:"BillingDetailsController",controllerAs:"vm"}).state("invoices.create",{url:"/new?transactionType&returnView&isStandingOrder",templateUrl:"app/invoices/invoice-edit.html",controller:"InvoiceEditController",controllerAs:"vm"}).state("invoices.details",{url:"/:invoiceId?isStandingOrder&transactionType",templateUrl:"app/invoices/invoice-edit.html",controller:"InvoiceEditController",controllerAs:"vm",params:{returnView:null}}).state("analysis",{abstract:!0,url:"/analysis",template:"<ui-view/>"}).state("analysis.charts",{url:"/charts",templateUrl:"app/analysis/analysis-chart.html",controller:"AnalysisChartController",controllerAs:"vm"}).state("fileanalyses",{abstract:!0,url:"/fileanalyses",template:"<ui-view/>"}).state("fileanalyses.upload",{url:"/upload",templateUrl:"app/fileanalyses/fileanalyses-upload.html",controller:"FileAnalysesController",controllerAs:"vm"}),i.useSanitizeValueStrategy("sanitize").useStaticFilesLoader({prefix:"i18n/locale-",suffix:".json"}).fallbackLanguage("de").preferredLanguage("de")}angular.module("msWebApp").config(e),e.$inject=["$httpProvider","$urlRouterProvider","$stateProvider","$translateProvider"]}(),function(){"use strict";function e(e,o,t,n,i,r,a,s,u){var c=this;function l(){c.isSearchFiringActivated&&(c.isSearchFiringActivated=!1,r.updateChartData(c.diagramViewType.useAbsolutValues,c.diagramType.diagramType).then(function(e){d(),c.isSearchFiringActivated=!0},function(e){c.isSearchFiringActivated=!0}))}function d(){var e=r.getChartData();e&&(c.labels=e.xaxesValues,c.chartData=[],c.chartData.push(e.yaxesValues))}c.title="AnalysisChartController",c.diagramViewOptions=[{name:"Liniendiagramm",code:"BAR",useAbsolutValues:!1,isActive:!0},{name:"Tortendiagramm",code:"PIE",useAbsolutValues:!0}],c.diagramOptions=[{name:"Kategorien",diagramType:"CATEGORY"},{name:"Träger",diagramType:"COST_PAYER"},{name:"Tagesvergleich",diagramType:"DAY"},{name:"Zahlungsempfänger",diagramType:"PAYMENT_RECIPIENTS"},{name:"Monatsvergleich",diagramType:"MONTH",isActive:!0}],c.barChartOptions={},c.pieChartOptions={showAllTooltips:!0},s.pluginService.register({beforeRender:function(n){n.config.options.showAllTooltips&&(n.pluginTooltips=[],n.config.data.datasets.forEach(function(e,t){n.getDatasetMeta(t).data.forEach(function(e,t){n.pluginTooltips.push(new s.Tooltip({_chart:n.chart,_chartInstance:n,_data:n.data,_options:n.options.tooltips,_active:[e]},n))})}),n.options.tooltips.enabled=!1)},afterDraw:function(e,t){if(e.config.options.showAllTooltips){if(!e.allTooltipsOnce){if(1!==t)return;e.allTooltipsOnce=!0}e.options.tooltips.enabled=!0,s.helpers.each(e.pluginTooltips,function(e){e.initialize(),e._options.displayColors=!1,e._options.bodyFontSize=.025*e._chart.height,e._options.yPadding=.1*e._options.bodyFontSize,e._options.xPadding=.1*e._options.bodyFontSize,e._options.caretSize=.3*e._options.bodyFontSize,e._options.cornerRadius=.2*e._options.bodyFontSize,e.update(),e.pivot(),e.transition(t).draw()}),e.options.tooltips.enabled=!1}}}),c.selectedMonth=null,c.monthRanges=[],c.showAfterButton=!0,c.showBeforeButton=!0,c.isSearchFiringActivated=!0,c.diagramType=c.diagramOptions[4],c.diagramViewType=c.diagramViewOptions[0],c.startSearch=function(){c.isSearchFiringActivated&&l()},c.setChartType=function(e){c.diagramOptions.forEach(function(e){e.isActive=!1}),c.diagramType=e,c.diagramType.isActive=!0,l()},c.statisticData=function(e){var t=r.getStatisticData(e);return null!=t?t.numberValue:"Keine Angabe"},c.setChartViewType=function(e){c.diagramViewOptions.forEach(function(e){e.isActive=!1}),c.diagramViewType=e,c.diagramViewType.isActive=!0,l()},c.chartServiceLoading=function(){return r.isLoading()},c.transferSelectionToSearch=function(){if(null==c.selectedMonth||null==c.selectedMonth||""===c.selectedMonth)t.getSearchConfiguration().startDate=null,t.getSearchConfiguration().endDate=null;else{var e=u.findWhere(c.monthRanges,{monthNumber:parseInt(c.selectedMonth)});t.getSearchConfiguration().startDate=e.startMonth,t.getSearchConfiguration().endDate=e.endMonth,6==e.monthNumber?(c.showAfterButton=!0,c.showBeforeButton=!1):(0==e.monthNumber?c.showAfterButton=!1:c.showAfterButton=!0,c.showBeforeButton=!0)}l()},c.monthBefore=function(){var e=parseInt(c.selectedMonth);6==(e+=1)?(c.showAfterButton=!0,c.showBeforeButton=!1):(c.showAfterButton=!0,c.showBeforeButton=!0),c.selectedMonth=e.toString(),c.transferSelectionToSearch()},c.monthAfter=function(){var e=parseInt(c.selectedMonth);--e,c.showAfterButton=0!=e,c.showBeforeButton=!0,c.selectedMonth=e.toString(),c.transferSelectionToSearch()},function(){var e=r.getChartData();e&&0<e.length&&d();l(),function(){for(var e=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],t=0;t<7;t++){var n=new o;n=n.subtract(t,"months");var i=new o;i=i.subtract(t,"months");var r={startMonth:n.startOf("month").toDate().getTime(),endMonth:i.endOf("month").toDate().getTime(),monthName:e[n.month()]+" "+n.year(),monthNumber:t};c.monthRanges.push(r)}}()}()}angular.module("msWebApp").controller("AnalysisChartController",e),e.$inject=["$state","moment","SearchService","$stateParams","NotificationService","AnalysisService","InvoiceService","Chart","_"]}(),function(){"use strict";function e(r,o,e,a,s,t){var u={chartsWithFilter:"/webapp/api/charts/withFilterBean",statistics:"/webapp/api/statistics"},n=[],c=[],l=!1,i={updateChartData:function(e,n){var t=a.getSearchConfiguration();s.clearCurrentPageReadyList(),s.clearCurrentPageCheckList(),s.setSearchMode(!1),s.allInvoices();var i=angular.copy(t);return i.standingOrder=!1,o(function(t){l=!0,r({method:"POST",data:i,params:{useAbsolutValues:e,chartType:n},url:u.chartsWithFilter}).then(function(e){c=e.data,l=!1,t(c)},function(e){$log.warn("Could not get chart data!","result",e)})})},getChartData:function(){return c},isLoading:function(){return l},setIsLoading:function(e){l=e},getStatisticData:function(t){var e=n.findIndex(function(e){return e.basicDataSubType===t});return n[e]}};return o(function(t){r({method:"GET",url:u.statistics}).then(function(e){n=e.data,t(n)},function(e){$log.warn("Could not get statistic data!","result",e)})}),i}angular.module("msWebApp").factory("AnalysisService",e),e.$inject=["$http","$q","NotificationService","SearchService","InvoiceService","_"]}(),function(){"use strict";function e(e,t,n,i,r,o,a,s,u){var c=this;c.title="BudgetEditController",c.budget={},c.createMode=!1,o.budgetId?c.budget.budgetId=o.budgetId:c.createMode=!0,c.paymentTypeEnums=[],c.budgetRepetionTypeEnums=[],c.submitForm=function(){c.budget.paymentTypeEnum=""!==c.budget.paymentTypeEnum&&void 0!==c.budget.paymentTypeEnum?c.budget.paymentTypeEnum:null,c.createMode?s.createBudget(c.budget).then(function(e){l()}):s.updateBudget(c.budget.budgetId,c.budget).then(function(e){l()})},c.getDialogId=function(e){var t="#";return null!=e&&(t+=e),t},c.getDialogIdWithoutHash=function(e){return e};var l=function(){r.go("budgets.list")};c.removePersonFromList=function(t){var e=c.budget.payerDTOS.findIndex(function(e){return e.id===t.id});c.budget.payerDTOS.splice(e,1)},c.removeCategoryFromList=function(t){var e=c.budget.invoiceCategoryDTOS.findIndex(function(e){return e.id===t.id});c.budget.invoiceCategoryDTOS.splice(e,1)},c.addPersonToList=function(e){var t={id:e.id,displayName:e.name,paymentPersonTypeEnum:e.type};c.budget.payerDTOS.push(t)},c.addCategoryToList=function(e){c.budget.invoiceCategoryDTOS.push(e)},c.removeBudget=function(){s.deleteBudget(c.budget.budgetId).then(function(e){l()})},c.deleteConfirmationMenu=[["Löchen bestätigen",function(e,t,n){c.removeBudget()}]],function(){if(u.paymentTypeEnumList().then(function(e){c.paymentTypeEnums=e.data}),s.budgetRepetitionTypeEnumList().then(function(e){c.budgetRepetionTypeEnums=e.data}),c.budget.budgetId)s.details(c.budget.budgetId).then(function(e){c.budget=e.data});else{new Date;c.budget.budgetId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),c.budget.payerDTOS=[],c.budget.budgetRepetitionType="MONTH",c.budget.invoiceCategoryDTOS=[],c.budget.sum=0}}()}angular.module("msWebApp").controller("BudgetEditController",e),e.$inject=["$timeout","$filter","$log","csrfToken","$state","$stateParams","$scope","BudgetService","InvoiceService"]}(),function(){"use strict";function e(n,t){var i=this;i.title="BudgetListController",i.useArchived=!1,i.budgets=[],i.newBudget=function(){n.go("budgets.create")},i.budgetServiceLoading=function(){return t.isLoading()},i.deleteBudget=function(e){t.deleteBudget(e)},i.goToDetails=function(e){var t={budgetId:e};n.go("budgets.edit",t)},i.displayNameForBudgetType=function(e){return i.displayNames={WEEK:"Woche",MONTH:"Monat"},i.displayNames[e]},t.listBudgets().then(function(e){i.budgets=e},function(e){i.budgets=[]})}angular.module("msWebApp").controller("BudgetListController",e),e.$inject=["$state","BudgetService"]}(),function(){"use strict";function e(r,o,a,s,e){var u={budgets:"/webapp/api/budgets",createBudget:"/webapp/api/budgets",budgetUdate:"/webapp/api/budgets/{budgetId}",budgetDelete:"/webapp/api/budgets/{budgetId}"},n=[],i=!1;return{listBudgets:c,getBudgets:function(){return n},details:function(e){return r({method:"GET",url:u.budgets+"/"+e})},createBudget:function(n){return o(function(t){var e={method:"POST",url:u.createBudget,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}};r(e).then(function(e){a.create("Budget wurde erstellt!",5e3),s.list(),c(),t(null)})})},updateBudget:function(e,t){var i=u.budgetUdate.replace("{budgetId}",e);return o(function(n){r({method:"PUT",url:i,data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){s.list(),c().then(function(e){a.create("Budget aktualisiert!",5e3),n(t.data)})})})},deleteBudget:function(e){var n=u.budgetDelete.replace("{budgetId}",e);return o(function(t){r({method:"DELETE",url:n}).then(function(e){s.list(),c().then(function(e){a.create("Budget wurde gelöscht!",5e3),t(null)})})})},isLoading:function(){return i},setIsLoading:function(e){i=e},budgetRepetitionTypeEnumList:function(){return r({method:"GET",url:u.budgets+"/budgetRepetitionTypeEnums"})}};function c(){return i=!0,o(function(t){r({method:"GET",url:u.budgets}).then(function(e){n=e.data,i=!1,t(n)},function(e){i=!1,t(null)})})}}angular.module("msWebApp").factory("BudgetService",e),e.$inject=["$http","$q","NotificationService","MessageService","_"]}(),function(){"use strict";function e(t,e,n,i){var r=this;r.title="BillingCreateController",r.switched=!1,r.smtpMailServiceEnabled=!1,r.toggleSwitch=function(){r.switched=!r.switched},e.userContact?r.userContact=e.userContact:t.go("billings.processList"),r.returnViewObject={view:"billings.processList"},r.billingConfig={costPayerMail:r.userContact.email},e.sumToBePaid&&(r.sumToBePaid=e.sumToBePaid),e.billingListItem&&(r.billingListItem=e.billingListItem),r.getCategoriesForInvoicePayer=function(e){return r.categoriesInvoicePayer=_.map(e.invoiceCategoriesOfInvoicePayer,function(e){return e.invoiceCategoryName}).join(", "),r.categoriesInvoicePayer},r.getCategoriesForCostPayer=function(e){return r.categoriesCostPayer=_.map(e.invoiceCategoriesOfCostPayer,function(e){return e.invoiceCategoryName}).join(", "),r.categoriesCostPayer},r.createBilling=function(){r.billingConfig.startDate=null,r.billingConfig.endDate=null,r.billingConfig.userSelectionPaymentPersonTypeEnum=r.userContact.paymentPersonTypeEnum,r.billingConfig.userSelection=r.userContact.paymentPersonId,null!=r.billingConfig.sendMailInvoicePayer&&null!=r.billingConfig.sendMailInvoicePayer||(r.billingConfig.sendMailInvoicePayer=!1),null!=r.billingConfig.sendMailCostPayer&&null!=r.billingConfig.sendMailCostPayer||(r.billingConfig.sendMailCostPayer=!1),r.lockBillingButton=!0,n.createBilling(r.billingConfig).then(function(e){t.go("billings.processList")})},i.get().then(function(e){r.smtpMailServiceEnabled=e.data.smtpMailServiceEnabled})}angular.module("msWebApp").controller("BillingCreateController",e),e.$inject=["$state","$stateParams","BillingService","SettingsService"]}(),function(){"use strict";function e(n,e,t){var i=this;function r(){n.go("^.processList")}function o(){t.getBilling(i.billing.billingId).then(function(e){i.billing=e})}i.title="BillingCreateController",i.selected=[],i.billing={},i.switched=!1,e.billingId?i.billing.billingId=e.billingId:n.go("billings.processList"),i.returnViewObject={view:"billings.details",params:{billingId:i.billing.billingId}},i.toggleSwitch=function(){i.switched=!i.switched},i.returnSumPaidSum=function(){return i.billing.sumPaid},i.archiveBilling=function(){t.archiveBilling(i.billing.billingId).then(function(e){r()})},i.firstAction=function(){t.billingUpdate(i.billing.billingId,i.billing.messageType).then(function(e){o()})},i.secondAction=function(){t.billingDelete(i.billing.billingId).then(function(e){r()})},i.getBillingReportUrl=function(){return t.billingReportUrl(i.billing.billingId)},i.billingServiceLoading=function(){return t.isLoading()},i.createCompensation=function(){t.createCompensation(i.billing.billingId).then(function(e){var t={invoiceId:e.invoiceId};t.returnView=i.returnViewObject,n.go("invoices.details",t)})},i.executeEquality=function(){t.executeEquality(i.billing.billingId).then(function(e){i.billing=e})},o()}angular.module("msWebApp").controller("BillingDetailsController",e),e.$inject=["$state","$stateParams","BillingService"]}(),function(){"use strict";function e(o,t,e){var n=this;n.title="BillingProcessListController",n.useArchived=!1,n.getGroupedBillingListItems=function(){return t.getBillingProcesses()},n.getBillingListProcessItems=function(e){return e.billingListProcessItemDTOs},n.checkReminderMessage=function(e){t.checkReminderMessage(e)},n.refreshArchived=function(){t.setUseArchived(n.useArchived)},n.createBilling=function(i){var r={sumToBePaid:i.sumToBePaid,billingListItem:i};e.currentUser().then(function(e){var t=e;if("CONTACT"===i.invoicePayer.paymentPersonEnum){var n=_.filter(t.userContactDTOs,function(e){return e.userContactId===i.invoicePayer.payerId});null!=n&&null!=n&&0<n.length?r.userContact=i.costPayer:r.userContact=i.invoicePayer}else r.userContact=i.costPayer;o.go("billings.create",r)})},n.showCanBeCompensatedWarning=function(e){return e.sumToPay!==e.sumPaid&&("PAID"===e.messageType||"PAYMENT_CONFIRMED"===e.messageType||"FINISHED"===e.messageType||"ARCHIVED"===e.messageType)},n.showBillingPaidPart=function(e){return e.billingListItemDTO&&e.billingListItemDTO.sumToBePaid&&0!==e.billingListItemDTO.sumToBePaid},n.showSumToBeChecked=function(e){return e&&e.sumToBeChecked&&0<=e.sumToBeChecked},n.goToDetails=function(e){var t={billingId:e.billingId};o.go("billings.details",t)},n.billingServiceLoading=function(){return t.isLoading()},n.getBillingReportUrl=function(e){return t.billingReportUrl(e.billingId)},n.archiveBilling=function(e){t.archiveBilling(e.billingId)},n.firstAction=function(e){t.billingUpdate(e.billingId,e.messageType)},n.secondAction=function(e){t.billingDelete(e.billingId)},n.listBillingProcesses=function(){t.listBillingProcesses(n.useArchived)},t.listBillingProcesses(!1),n.useArchived=t.getUseArchived()}angular.module("msWebApp").controller("BillingProcessListController",e),e.$inject=["$state","BillingService","UserService"]}(),function(){"use strict";function e(r,o,a,s,e){var u={createBilling:"/webapp/api/billings/payment",billingUdate:"/webapp/api/billings/{billingId}/payment",billingDelete:"/webapp/api/billings/{billingId}",billing:"/webapp/api/billings/{billingId}",billingProcesses:"/webapp/api/billings/billingListItems/grouped",billingReport:"/webapp/api/billings/{billingId}/downloadReport/Kostenuebersicht.pdf",archive:"/webapp/api/billings/{billingId}/archive",checkReminderMessage:"/webapp/api/billings/checkReminderMessage/{appUserId}",createCompensation:"/webapp/api/billings/{billingId}/createCompensation",executeEquality:"/webapp/api/billings/{billingId}/executeEquality"},n=[],t=[],i=!1,c=!1;return{getBillings:function(){return t},getBilling:function(e){i=!0;var n=u.billing.replace("{billingId}",e);return o(function(t){r({method:"GET",url:n}).then(function(e){t(e.data),i=!1},function(e){i=!1,t(null)})})},createBilling:function(n){return o(function(t){var e={method:"POST",url:u.createBilling,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}};r(e).then(function(e){a.create("Abrechnung wurde erstellt!",5e3),s.list(),l(),t(null)})})},billingUpdate:function(e,t){var n={};n.billingId=e,"TO_PAY"===t?n.billingStatusEnum="PAID":"PAID"===t||"WAIT_FOR_PAYMENT"===t?n.billingStatusEnum="PAYMENT_CONFIRMED":"PAYMENT_CONFIRMED"===t&&(n.billingStatusEnum="FINISHED");var i=u.billingUdate.replace("{billingId}",e);return o(function(t){r({method:"POST",url:i,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){l().then(function(e){a.create("Workflow-Status wurde gesetzt!",5e3)}),s.list().then(function(e){t(e)})})})},billingDelete:function(e){var n=u.billingDelete.replace("{billingId}",e);return o(function(t){r({method:"DELETE",url:n}).then(function(e){l().then(function(e){a.create("Abrechnung wurde gelöscht!",5e3)}),s.list().then(function(e){t(e)})})})},isLoading:function(){return i},setIsLoading:function(e){i=e},getUseArchived:function(){return c},setUseArchived:function(e){c=e},getBillingProcesses:function(){return n},listBillingProcesses:l,billingReportUrl:function(e){return u.billingReport.replace("{billingId}",e)},archiveBilling:function(e){var n=u.archive.replace("{billingId}",e);return o(function(t){r({method:"POST",url:n}).then(function(e){a.create("Abrechnung wurde archiviert!",5e3),s.list(),l(),t(null)})})},checkReminderMessage:function(e){var n=u.checkReminderMessage.replace("{appUserId}",e);return o(function(t){r({method:"POST",url:n}).then(function(e){a.create("Nachricht wurde verschickt!",5e3),s.list(),t(null)})})},createCompensation:function(e){var i=u.createCompensation.replace("{billingId}",e);return o(function(t,n){r({method:"POST",url:i}).then(function(e){s.list(),a.create("Ausbalancierende Rechnung wurde gespeichert und kann noch bearbeitet werden!",8e3),t(e.data)},function(e){a.create("Ausbalancierende Rechnung konnte nicht erstellt werden!",5e3),n(null)})})},executeEquality:function(e){var n=u.executeEquality.replace("{billingId}",e);return o(function(t){r({method:"POST",url:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){a.create("Summen wurden gleichgesetzt!",5e3),s.list(),l(),t(e.data)})})}};function l(){var e=c?"?archived=true":"";return i=!0,o(function(t){r({method:"GET",url:u.billingProcesses+e}).then(function(e){n=e.data,i=!1,t(n)},function(e){i=!1,t(null)})})}}angular.module("msWebApp").factory("BillingService",e),e.$inject=["$http","$q","NotificationService","MessageService","_"]}(),function(){"use strict";function e(n,t){var o="/webapp/api/businesspartners",i="/webapp/api/businesspartners/search",r="/autoCategory",e={list:function(){return n({method:"GET",url:o})},getOne:function(e){return n({method:"GET",url:o+"/"+e})},getAutoCategory:function(e){return n({method:"GET",url:o+"/"+e+r})},getBusinessPartners:function(){return s},search:function(e){n({method:"POST",url:i,data:{businessPartnerName:e},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s=e.data.businessPartnerDTOList,a=e.data.newUserName})},getBusinessPartnerNewName:function(){return a},create:function(){var e={businessPartnerName:a};return t(function(t){n({method:"POST",url:o,data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s.push(e.data),a=null,t(e.data)})})},remove:function(r){return t(function(i){return n({method:"DELETE",url:o+"/"+r}).then(function(e){var t=_.filter(s,function(e){return e.businessPartnerId===r});if(null!=t&&null!=t&&0<t.length){var n=_.indexOf(s,t[0]);s.splice(n,1)}i(null)},function(e){$log.warn("Could not delete business partner!","result",e),i(null)})})}},a=null,s=[];return e}angular.module("msWebApp").factory("BusinesspartnerService",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e,t,n,v,i){var h=this;h.showLoadingText=!0;var r=h.data();h.articles=r.articles?r.articles:[],h.imageUrl=r.imageUrl,h.invoiceId=r.invoiceId,h.username=r.username?r.username:"Keine Eingabe",setTimeout(function(){var e;e={method:"POST",url:"/webapp/api/service/upload/"+h.invoiceId+"/articleAnalysisPreparement"},v(e).then(function(e){h.showLoadingText=!1},function(e){h.showLoadingText=!1})},1e3),console.log("article select started"),h.calculateSum=function(){h.sum=0,h.articles.forEach(function(e){h.sum=h.sum+e.price});var e=h.sum.toFixed(2);h.sum=Number(e)},h.useThisSum=function(){h.callback(h.articles,h.sum)},setTimeout(function(){document.getElementById("imageTarget"+h.invoiceId).addEventListener("click",function(e){var t,n,i,r=this.getBoundingClientRect(),o=r.left,a=r.top,s=e.pageX-o,u=e.pageY-a,c=this.clientWidth,l=this.clientHeight,d=this.naturalWidth,m=this.naturalHeight,p=u/l*m,g=(s/c*d/d).toPrecision(8),f=(p/m).toPrecision(8);t=g,n=f,i={method:"POST",url:"/webapp/api/service/upload/"+h.invoiceId+"/articleAnalysis?x="+t+"&y="+n},v(i).then(function(e){console.log("Article name:"+e.data.name+" price:"+e.data.price),h.articles.push(e.data),h.calculateSum()})})},100),h.calculateSum(),h.removeArticleFromList=function(t){var e=h.articles.findIndex(function(e){return e===t});h.articles.splice(e,1),h.calculateSum()}}angular.module("msWebApp.msArticlesSelect",[]).component("msArticlesSelect",{templateUrl:"app/components/ms-articles-select.html",bindings:{callback:"=msCallback",data:"=msArticleDialogData"},controller:e,controllerAs:"vm"}),e.$inject=["$filter","$log","$timeout","$http","_"]}(),function(){"use strict";function e(e,t){return{restrict:"E",templateUrl:"app/components/ms-costdistribution-calculate.html",scope:{costDistributionItem:"=msCostDistributionItem",costDistributionItems:"=msCostDistributionItems",dialogId:"=msDialogId",updateMethod:"=msUpdateMethod",sumCost:"=msSumCost"},link:function(){},controller:n,controllerAs:"vm",bindToController:!0}}function n(e,t,u){var c=this;function s(){c.costDistributionItem.value=c.currentValue}Number.prototype.setScale=function(e){var t=Math.pow(10,e);return+Math.round(this*t)/t},Number.prototype.divide=function(e,t){return(this/e).setScale(t)},Number.prototype.remainder=function(e){return(this%e+e)%e},Number.prototype.compareTo=function(e){return this<e?-1:e<this?1:0},Number.prototype.multiply=function(e){return this*e},Number.prototype.subtract=function(e){return this-e},Number.prototype.add=function(e){return this+e},Number.prototype.floor=function(){return Math.floor(this)},c.costDistributionPercentageTv="0 %",c.costDistributionQuotaTv="0.0",c.costDistributionFixedAmountEt=0,(c.costDistributionItemTypeEnum=null)!=c.sumCost&&null!=c.sumCost||(c.sumCost=0),c.updateMethod=function(){c.currentValue=c.costDistributionItem.value,c.costDistributionItemTypeEnum=c.costDistributionItem.costDistributionItemTypeEnum,function(){c.costDistributionItemsWithoutCurrentItem=[],c.costDistributionItems.forEach(function(e){c.costDistributionItemsWithoutCurrentItem.push(e)});var e=c.costDistributionItems.findIndex(function(e){return e.costDistributionItemId===c.costDistributionItem.costDistributionItemId});c.costDistributionItemsWithoutCurrentItem.splice(e,1)}(),c.refreshAllViews(),c.updateCostDistributionItems()},c.getDialogIdWithoutHash=function(){return c.dialogId},c.updateCostDistributionItems=function(){c.costDistributionItems.forEach(function(e){e.moneyValue=u.calculateAmountForCostDistributionItemPrecise(e,c.costDistributionItems,c.sumCost)})},c.onProgressChanged=function(){if(null!=c.costDistributionItemsWithoutCurrentItem){var e=parseInt(c.seekBar).divide(100,30);if("FIXED_AMOUNT"===c.costDistributionItem.costDistributionItemTypeEnum){var t=u.getMaxAmountForOneCostDistributionItem(c.costDistributionItemsWithoutCurrentItem,c.sumCost);c.currentValue=t.multiply(e).setScale(2)}else if("QUOTA"===c.costDistributionItem.costDistributionItemTypeEnum){var n=u.getCountWithoutFixed(c.costDistributionItems),i=u.getCountWeightedWithoutFixed(c.costDistributionItemsWithoutCurrentItem),r=n.subtract(i);c.currentValue=e.multiply(r).setScale(1)}else if("PERCENT"===c.costDistributionItem.costDistributionItemTypeEnum){var o=u.getMaxAmountForOneCostDistributionItem(c.costDistributionItemsWithoutCurrentItem,c.sumCost),a=e.multiply(o).divide(c.sumCost,2);c.currentValue=a}s(),c.refreshAllViews("UNDEFINED"),c.updateCostDistributionItems()}},c.refreshAllViews=function(e){var t;null==c.sumCost&&(c.sumCost=0),null!=e&&null!=e?"FIXED_AMOUNT"===e?c.refreshProgressBar():"QUOTA"===e||"PERCENT"===e?(c.refreshFixedAmountEt(),c.refreshProgressBar()):"UNDEFINED"===e&&c.refreshFixedAmountEt():(c.refreshFixedAmountEt(),c.refreshProgressBar()),t=u.calculateQuotaForValue(c.costDistributionItem.costDistributionItemTypeEnum,c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost),c.costDistributionQuotaTv=t.toFixed(1),function(){var e=0;if("FIXED_AMOUNT"===c.costDistributionItem.costDistributionItemTypeEnum)e=c.currentValue.divide(c.sumCost,10).multiply(100).setScale(0);else if("QUOTA"===c.costDistributionItem.costDistributionItemTypeEnum){var t=u.calculatePercentForValue("QUOTA",c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost);e=t.multiply(100).setScale(0)}else"PERCENT"===c.costDistributionItem.costDistributionItemTypeEnum&&(e=c.currentValue.multiply(100).setScale(0));c.costDistributionPercentageTv=e.toFixed(0)+"%"}()},c.onQuotaCheckBoxClick=function(){var e=u.calculateQuotaForValue(c.costDistributionItemTypeEnum,c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost);c.currentValue=e,c.costDistributionItemTypeEnum="QUOTA",s(),c.refreshAllViews("QUOTA")},c.onPercentCheckBoxClick=function(){var e=u.calculatePercentForValue(c.costDistributionItemTypeEnum,c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost);c.currentValue=e,c.costDistributionItemTypeEnum="PERCENT",s(),c.refreshAllViews("PERCENT")},c.onFixedAmountCheckBoxClick=function(){var e=u.calculateAmountForValue(c.costDistributionItemTypeEnum,c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost);c.currentValue=e,c.costDistributionItemTypeEnum="FIXED_AMOUNT",s(),c.refreshAllViews("FIXED_AMOUNT")},c.onFixedAmountTextChanged=function(){"FIXED_AMOUNT"===c.costDistributionItemTypeEnum&&(c.currentValue=c.costDistributionFixedAmountEt,s(),c.refreshAllViews("FIXED_AMOUNT"),c.updateCostDistributionItems())},c.refreshFixedAmountEt=function(){var e=u.calculateAmountForValue(c.costDistributionItem.costDistributionItemTypeEnum,c.currentValue,c.costDistributionItemsWithoutCurrentItem,c.sumCost);c.costDistributionFixedAmountEt=e,c.costDistributionItem.moneyValue=e},c.refreshProgressBar=function(){var e=0;if("FIXED_AMOUNT"===c.costDistributionItem.costDistributionItemTypeEnum){var t=u.getMaxAmountForOneCostDistributionItem(c.costDistributionItemsWithoutCurrentItem,c.sumCost);e=c.currentValue.divide(t,10).multiply(100).setScale(0)}else if("QUOTA"===c.costDistributionItem.costDistributionItemTypeEnum){var n=u.getCountWithoutFixed(c.costDistributionItems),i=u.getCountWeightedWithoutFixed(c.costDistributionItemsWithoutCurrentItem),r=n.subtract(i);e=c.currentValue.divide(r,10).multiply(100).setScale(0)}else if("PERCENT"===c.costDistributionItem.costDistributionItemTypeEnum){var o=u.getMaxAmountForOneCostDistributionItem(c.costDistributionItemsWithoutCurrentItem,c.sumCost),a=c.currentValue.multiply(c.sumCost),s=0;0!=o&&(s=a.divide(o,3)),e=s.multiply(100)}c.seekBar=e.setScale(0)}}angular.module("msWebApp.msCostdistributioncalculate",[]).directive("msCostdistributioncalculate",e),e.$inject=["$document","$log"],n.$inject=["$filter","$log","CostdistributioncalculateService"]}(),function(){"use strict";function e(t,e,n,i){var r=this;r.$onInit=function(){n.$watch("vm.value",function(e){var t,n;r.timestamp=e,r.date=(t=e,isNaN(t)||null==t||null==t?null:(n=parseInt(t),new Date(n)))})},r.$onChanges=function(e){e.required&&(e.required.currentValue?t.attr("data-required","required"):t.removeAttribute("data-required"))},r.dateToTimestamp=function(){var e;r.timestamp=(e=r.date,angular.isDate(e)?e.getTime():null),r.value=r.timestamp,angular.isFunction(r.callback)&&r.callback()},r.setDateToNull=function(){void 0!==r.setNull&&!0!==r.setNull||(r.date=null,r.timestamp=null,r.value=r.timestamp)}}angular.module("msWebApp.msInputDate",["moment-picker"]).component("msInputDate",{templateUrl:"app/components/ms-input-date.html",bindings:{value:"=msValue",required:"<?msRequired",disabled:"<?msDisabled",setNull:"<?msSetNull",callback:"&?msOnChange"},controller:e,controllerAs:"vm"}),e.$inject=["$element","$log","$scope","_"]}(),function(){"use strict";function e(e,t,n,i,r,o,a,s){var u=this;u.title="InvoiceSummaryController",u.costDistributionItems=[],u.payerName="",u.paymentRecipientName="",u.currentUser={},u.hasInvoiceImageValue=!1,u.repetionTypeEnums=[],u.paymentTypeEnums=[],u.standingOrder={},u.originalStandingOrder={},u.costDistributions=[],u.goToInvoice=function(){var e={invoiceId:u.invoice.invoiceId};null!=u.returnView&&(e.returnView=u.returnView),t.go("invoices.details",e)},u.isReadOnlyMode=function(){return"EXTERNAL_USER_CHECK_MODE"===u.invoice.invoiceWorkflowMode||"EXTERNAL_USER_READY_MODE"===u.invoice.invoiceWorkflowMode},u.remove=function(){u.isStandingOrder?u.removeInvoiceTemplate():u.removeInvoice()},u.getDialogId=function(e){var t="#";return null!=e&&(t+=e),t},u.getDialogIdWithoutHash=function(e){return e},u.hasInvoiceImage=function(){u.hasInvoiceImageValue=!!u.invoice.invoiceImageId},u.getInvoiceImageUrl=function(){return r.getInvoiceImageUrl(u.invoice.invoiceImageId)},u.removeInvoice=function(){n.remove(u.invoice.invoiceId),goToOverview()},u.removeInvoiceTemplate=function(){n.deleteStandingOrder(u.invoice.invoiceId),goToOverview()},u.isNullOrUndefined=function(e){return null==e},function(t){s.currentUser().then(function(e){u.currentUser=e,null!=t&&t()})}(),n.details(u.invoice.invoiceId).then(function(e){u.invoice=e.data,function(){u.hasInvoiceImage(),null!=u.invoice.paymentRecipientId&&(u.paymentRecipientName=u.invoice.paymentRecipientDTO.displayName);null!=u.invoice.payerId&&(u.payerName=u.invoice.payerDTO.displayName)}(),u.costDistributionItems=u.invoice.costDistributionItemDTOs,u.originalCostDistributionItems=angular.copy(u.costDistributionItems),u.originalInvoice=angular.copy(u.invoice)}),u.standingOrder.invoiceTemplateId=u.invoice.invoiceId,u.standingOrder.futureInvoiceTemplateId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),u.isStandingOrder?e(function(){n.getStandingOrder(u.invoice.invoiceId).then(function(e){u.standingOrder.repetitionTypeEnum=e.repetitionTypeEnum,u.standingOrder.startDate=e.startDate,u.originalStandingOrder=angular.copy(u.standingOrder)},function(e){u.standingOrder.startDate=(new Date).getTime(),u.standingOrder.repetitionTypeEnum="MONTHLY",u.originalStandingOrder={repetitionTypeEnum:u.standingOrder.repetitionTypeEnum,startDate:u.standingOrder.startDate},u.invoice.repetitionTypeEnum=u.standingOrder.repetitionTypeEnum,u.originalInvoice.repetitionTypeEnum=u.standingOrder.repetitionTypeEnum})},100):u.originalStandingOrder=angular.copy(u.standingOrder),n.repetitionTypeEnumList().then(function(e){if(u.repetionTypeEnums=e.data,u.isStandingOrder){var t=a.filter(u.repetionTypeEnums,function(e){return"ONCE"===e.name});if(null!=t&&null!=t&&0<t.length){var n=a.indexOf(u.repetionTypeEnums,t[0]);u.repetionTypeEnums.splice(n,1)}}}),n.paymentTypeEnumList().then(function(e){u.paymentTypeEnums=e.data})}angular.module("msWebApp.msInvoiceSummary",["moment-picker"]).component("msInvoiceSummary",{templateUrl:"app/components/ms-invoice-summary.html",bindings:{invoice:"<msInvoice",isStandingOrder:"<?msIsStandingOrder",isReadyOnlyMode:"<?msReadOnly",returnView:"=?msReturnView"},controller:e,controllerAs:"vm"}),e.$inject=["$timeout","$state","InvoiceService","CostdistributionitemService","InvoiceimageService","NotificationService","_","UserService"]}(),function(){"use strict";function e(e,t,n,i,r,o,a,s){var u=this;i.info("msInvoiceTable loaded"),u.selectedInvoiceId=null,u.isInvoiceDetailsEnabled=function(e){return void 0!==u.tableViewId&&null!=u.tableViewId?u.tableViewId+""+e===u.detailViewId:u.selectedInvoiceId===e},u.goToInvoice=function(e){u.allowGoTo=null==u.allowGoTo||u.allowGoTo,u.allowGoTo&&("ANALYZING"!==e.invoiceStatusEnum?t.go("invoices.details",{invoiceId:e.invoiceId}):a.create("Rechnung wird gerade analysiert! Bitte warten!",3e3))},u.toggleInvoiceDetails=function(e){var t,n=e.invoiceId;void 0!==u.tableViewId&&null!=u.tableViewId?(t=u.detailViewId===u.tableViewId+""+n?null:n,u.detailViewId=null==t?null:u.tableViewId+""+t):(t=u.selectedInvoiceId===n?null:n,u.selectedInvoiceId=t)},u.isSelected=function(e){return 0<s.chain(u.selected).intersection([e]).value().length},u.toggleSelect=function(e){var t=s.indexOf(u.selected,e);-1===t?u.selected.push(e):u.selected.splice(t,1)},u.invoiceServiceLoading=function(){return o.isLoading()}}angular.module("msWebApp.msInvoiceTable",["moment-picker"]).component("msInvoiceTable",{templateUrl:"app/components/ms-invoice-table.html",bindings:{invoices:"<msInvoices",allowGoTo:"<?msAllowGoTo",useSelection:"<msUseSelection",selected:"=?msSelected",detailViewId:"=?msDetailViewId",tableViewId:"=?msTableViewId",useDebtValue:"<?msUseDebt",returnView:"=?msReturnView"},controller:e,controllerAs:"vm"}),e.$inject=["$filter","$state","$element","$log","$scope","InvoiceService","NotificationService","_"]}(),function(){"use strict";function e(e,t,n,i){return{restrict:"E",templateUrl:"app/components/ms-invoicecategorie-select.html",scope:{invoiceCategories:"=msInvoiceCategories",returnInvoiceCategory:"=msReturnInvoiceCategory",disabled:"<disabled",currentSelection:"=msCurrentSelection",dialogId:"=msDialogId",hideSelectionButton:"=msHideSelectionButton",expenseType:"=msExpenseType",hiddenSelButtonActivator:"=msHiddenSelButtonActivator"},link:function(e,t,n,i){},controller:r,controllerAs:"vm",bindToController:!0}}function r(e,t,r,o){var a=this;a.newInvoiceCategoryName="",a.getParentInvoiceCategories=function(){return a.categorieParentsFiltered?a.categorieParentsFiltered:r.getParentInvoiceCategories(a.expenseType)},a.getDialogId=function(e){var t="#"+a.dialogId;return e&&(t+=e),t},a.selectNone=function(){a.returnInvoiceCategory(null)},a.getDialogIdWithoutHash=function(e){var t=a.dialogId;return e&&(t+=e),t},a.findInvoiceCategoriesForParent=function(t){return o.filter(r.getInvoiceCategories(),function(e){return null!=e.parentInvoiceCategoryDTO&&t.invoiceCategoryId===e.parentInvoiceCategoryDTO.invoiceCategoryId})},a.selectInvoiceCategory=function(e){a.returnInvoiceCategory(e),a.invoiceCategorySearch="",a.refreshInvoiceParents()},a.searchFilterForInvoiceCategories=function(){return a.searchMatcher(a.invoiceCategorySearch)},a.refreshInvoiceParents=function(){a.categorieParentsFiltered=o.filter(r.getParentInvoiceCategories(a.expenseType),function(t){var n=!1,e=o.filter(r.getInvoiceCategories(),function(e){return null!=e.parentInvoiceCategoryDTO&&t.invoiceCategoryId===e.parentInvoiceCategoryDTO.invoiceCategoryId}),i=a.searchFilterForInvoiceCategories();return e.forEach(function(e){i(e)&&(n=!0)}),n})},a.searchMatcher=function(e){var t=e?new RegExp(".*"+e+".*","i"):null;return function(e){return!(t&&!t.test(e.invoiceCategoryName))}},a.createInvoiceCategory=function(e){r.create(a.newInvoiceCategoryName,e.invoiceCategoryId).then(function(e){a.refreshInvoiceParents()}),a.parentInvoiceCategoryAdding[e.invoiceCategoryId]=!1},a.removeInvoiceCategory=function(e){r.remove(e.invoiceCategoryId).then(function(e){a.refreshInvoiceParents()})}}angular.module("msWebApp.msInvoicecategorieSelect",[]).directive("msInvoicecategorieSelect",e),e.$inject=["$document","$log","InvoicecategoriesService","_"],r.$inject=["$filter","$log","InvoicecategoriesService","_"]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"app/components/ms-paymentperson-select.html",scope:{appUsers:"=msUsers",userContacts:"=msUsercontacts",businessPartners:"=msBusinesspartners",projects:"=msProjects",callbackPaymentPerson:"=msCallbackPaymentPerson",dialogId:"=msDialogId",disabled:"<disabled",currentSelection:"=msCurrentSelection",hideBusinessPartners:"=msHideBusinessPartners",hideSelectionButton:"=msHideSelectionButton",hiddenSelButtonActivator:"=msHiddenSelButtonActivator"},link:function(e,t,n,i){},controller:i,controllerAs:"vm",bindToController:!0}}function i(e,t,n,i,r,o){var a=this;a.showDialog=!1,a.businessPartnerTimeoutRunning=!1,a.appUserTimeoutRunning=!1,a.getUsers=function(){return null==a.appUsers||null==a.appUsers?i.getUsers():a.appUsers},a.getNewBusinessPartnerName=function(){return r.getBusinessPartnerNewName()},a.getFoundAppUser=function(){return i.getFoundAppUser()},a.createNewBusinessPartner=function(){r.create().then(function(e){a.selectBusinessPartner(e)})},a.createNewProject=function(){i.createProject(a.projectsSearch).then(function(e){a.selectProject(e)})},a.createNewUserContact=function(){i.createUserContact(a.userContactsSearch).then(function(e){a.selectUserContact(e)})},a.createNewAppUserContact=function(){i.createAppUserContact().then(function(e){a.selectUser(e)})},a.removeBusinessPartner=function(e){r.remove(e.businessPartnerId)},a.removeUserContact=function(e){i.remove(e.userContactId)},a.businessPartnerInputDone=function(){0==a.businessPartnerTimeoutRunning&&(a.businessPartnerTimeoutRunning=!0,n(function(){1<a.businessPartnerInput.length&&r.search(a.businessPartnerInput),a.businessPartnerTimeoutRunning=!1},400))},a.appUserInputDone=function(){0==a.appUserTimeoutRunning&&(a.appUserTimeoutRunning=!0,n(function(){1<a.usersSearch.length&&i.searchForUser(a.usersSearch),a.appUserTimeoutRunning=!1},400))},a.getUserContacts=function(){return null==a.userContacts||null==a.userContacts?i.getUserContacts():a.userContacts},a.getProjects=function(){return null==a.projects||null==a.projects?i.getProjects():a.projects},a.getBusinessPartners=function(){return null==a.businessPartners||null==a.businessPartners?r.getBusinessPartners():a.businessPartners},a.getDialogId=function(e){var t="#"+a.dialogId;return null!=e&&(t+=e),t},a.getDialogIdWithoutHash=function(e){var t=a.dialogId;return null!=e&&(t+=e),t},a.selectBusinessPartner=function(e){a.callbackPaymentPerson({name:e.businessPartnerName,id:e.businessPartnerId,type:"BUSINESS_PARTNER"}),a.resetValues()},a.selectUser=function(e){null!=e.userContactId&&null!=e.userContactId?a.callbackPaymentPerson({name:e.contactName,id:e.userContactId,type:"CONTACT",virtualType:"USER"}):a.callbackPaymentPerson({name:e.contactName,id:e.appUserId,type:"USER"}),a.resetValues()},a.selectUserContact=function(e){a.callbackPaymentPerson({name:e.contactName,id:e.userContactId,type:"CONTACT"}),a.resetValues()},a.selectProject=function(e){a.callbackPaymentPerson({name:e.contactName,id:e.userContactId,type:"CONTACT"}),a.resetValues()},a.selectNone=function(){a.callbackPaymentPerson(null),a.resetValues()},a.searchFilterForBusinessPartners=function(){var t=a.businessPartnerSearch?new RegExp(".*"+a.businessPartnerSearch+".*","i"):null;return function(e){return!(t&&!t.test(e.businessPartnerName))}},a.searchFilterForUsers=function(){var t=a.usersSearch?new RegExp(".*"+a.usersSearch+".*","i"):null;return function(e){return!(t&&!t.test(e.contactName))}},a.searchFilterForUserContacts=function(){var t=a.userContactsSearch?new RegExp(".*"+a.userContactsSearch+".*","i"):null;return function(e){return!(t&&!t.test(e.contactName))}},a.searchFilterForProjects=function(){var t=a.projectsSearch?new RegExp(".*"+a.projectsSearch+".*","i"):null;return function(e){return!(t&&!t.test(e.contactName))}},a.resetValues=function(){setTimeout(function(){a.businessPartnerInput="",a.userContactsSearch="",a.projectsSearch="",a.usersSearch="",r.search(""),i.searchForUser("")},1e3)}}angular.module("msWebApp.msPaymentpersonSelect",[]).directive("msPaymentpersonSelect",e),e.$inject=["$document","$log","_"],i.$inject=["$filter","$log","$timeout","UsercontactService","BusinesspartnerService","_"]}(),function(){"use strict";function e(e,t,n){return{restrict:"E",templateUrl:"app/components/ms-search-configuration.html",scope:{startSearch:"=msStartSearch"},link:function(e,t,n,i){},controller:i,controllerAs:"vm",bindToController:!0}}function i(e,t,n,i,r,o){var a=this;a.payerPersonSearchConfiguration="payerPersonSearchConfiguration"+Math.floor(Math.random()*(1e7-1))+1,a.paymentRecipientPersonSearchConfiguration="paymentRecipientPersonSearchConfiguration"+Math.floor(Math.random()*(1e7-1))+1,a.costPayerSearchConfiguration="costPayerSearchConfiguration"+Math.floor(Math.random()*(1e7-1))+1,a.invoiceCategorySearchConfiguration="invoiceCategorySearchConfiguration"+Math.floor(Math.random()*(1e7-1))+1,a.repetitionTypeEnums=[{enumName:null,displayName:"Keine Auswahl"},{enumName:"ONCE",displayName:"Einmalig"},{enumName:"MONTHLY",displayName:"Monatlich"},{enumName:"QUARTER",displayName:"Vierteljährlich"},{enumName:"HALF_YEAR",displayName:"Halbjährlich"},{enumName:"ANNUALLY",displayName:"Jährlich"}],a.booleanSelections=[{enumName:null,displayName:"Keine Auswahl"},{enumName:!0,displayName:"Ja"},{enumName:!1,displayName:"Nein"}],a.remarksTimeoutRunning=!1,a.remarksInput="",a.fullTextTimeoutRunning=!1,a.fullTextInput="",a.remarksInputDone=function(){!1===a.remarksTimeoutRunning&&(a.remarksTimeoutRunning=!0,t(function(){i.getSearchConfiguration().remarks=a.remarksInput,a.startSearch(),a.remarksTimeoutRunning=!1},1e3))},a.fullTextInputDone=function(){!1===a.fullTextTimeoutRunning&&(a.fullTextTimeoutRunning=!0,t(function(){i.getSearchConfiguration().fullText=a.fullTextInput,a.startSearch(),a.fullTextTimeoutRunning=!1},1e3))},a.getPayerPersonSelection=function(){var e=i.getSearchConfiguration();return void 0!==e.payerPerson&&null!=e.payerPerson?e.payerPerson.payerName:null},a.getCostDistributions=function(){return r.getCostDistributions()},a.repairSearchConfiguration=function(){i.repairSearchConfiguration()},a.updateSearchConfiguration=function(){i.getSearchConfiguration()},a.getPaymentRecipientPersonSelection=function(){var e=i.getSearchConfiguration();return null!=e.paymentRecipientPerson&&null!=e.paymentRecipientPerson?e.paymentRecipientPerson.payerName:null},a.getCostPayerSelection=function(){var e=i.getSearchConfiguration();return null!=e.costPayer&&null!=e.costPayer?e.costPayer.payerName:null},a.setPayerPerson=function(e){var t=i.getSearchConfiguration();null!=e?(t.payerPerson={},t.payerPerson.payerId=e.id,t.payerPerson.payerEnum=e.type,t.payerPerson.payerName=e.name):t.payerPerson=null,a.startSearch()},a.setPaymentRecipientPerson=function(e){var t=i.getSearchConfiguration();null!=e?(t.paymentRecipientPerson={},t.paymentRecipientPerson.payerId=e.id,t.paymentRecipientPerson.payerEnum=e.type,t.paymentRecipientPerson.payerName=e.name):t.paymentRecipientPerson=null,a.startSearch()},a.setCostPayer=function(e){var t=i.getSearchConfiguration();null!=e?(t.costPayer={},t.costPayer.payerId=e.id,t.costPayer.payerEnum=e.type,t.costPayer.payerName=e.name):t.costPayer=null,a.startSearch()},a.selectInvoiceCategory=function(e){i.getSearchConfiguration().invoiceCategoryDTO=e,a.startSearch()},a.costDistributionItems=function(){return r.getCostDistributions()},a.getSearchConfiguration=function(){return i.getSearchConfiguration()}}angular.module("msWebApp.msSearchConfiguration",[]).directive("msSearchConfiguration",e),e.$inject=["$document","$log","_"],i.$inject=["$filter","$timeout","$log","SearchService","CostdistributionService","_"]}(),function(){"use strict";function e(r,t,o,a){var s={invoices:"/webapp/api/invoices",costDistribution:"/webapp/api/costdistributions"},e={list:n,create:function(n,e){n.costDistributionItemDTOS=[],e.forEach(function(e){n.costDistributionItemDTOS.push(e)});var i=s.costDistribution+"/complete";return t(function(t){return o({method:"POST",url:i,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){a.create("Kostenverteilungs-Vorlage wurde erstellt!",5e3),u.push(e.data),t(e.data)},function(e){r.warn("Could not create costdistribution!","result",e),t(null)})})},remove:function(e){return t(function(t){return o({method:"DELETE",url:s.costDistribution+"/"+e}).then(function(e){a.create("Kostenverteilungs-Vorlage wurde gelöscht!",5e3),t(null)},function(e){r.warn("Could not delete costdistribution!","result",e),t(null)})})},getCostDistributions:function(){return u},prepareItemForCostDistribution:function(e){return e.costDistributionItemId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),e.costDistributionId=null,e}},u=[];return n().then(function(e){u=e.data}),e;function n(){return o({method:"GET",url:s.costDistribution})}}angular.module("msWebApp").factory("CostdistributionService",e),e.$inject=["$log","$q","$http","NotificationService"]}(),function(){"use strict";function e(n){var i="/webapp/api/invoices";return{listForInvoice:function(e){return n({method:"GET",url:i+"/"+e+"/costdistributionitems"})},update:function(e,t){return n({method:"PUT",url:i+"/"+e+"/costdistributionitems",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}}}angular.module("msWebApp").factory("CostdistributionitemService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){this.title="DashboardController",e.go("invoices.list")}angular.module("msWebApp").controller("DashboardController",e),e.$inject=["$state"]}(),function(){"use strict";function e(e,t,n,r,i,o,a){this.title="FileAnalysesController";var s=this.uploader=new e({url:"/webapp/api/service/upload/"+c(),headers:{},alias:"fileUpload"}),u=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}(a);function c(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}s.headers[a]=u,s.filters.push({name:"syncFilter",fn:function(e,t){return console.log("syncFilter"),this.queue.length<40}}),s.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},s.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},s.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},s.onBeforeUploadItem=function(e){e.url="/webapp/api/service/upload/"+c(),console.info("onBeforeUploadItem",e)},s.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},s.onProgressAll=function(e){console.info("onProgressAll",e)},s.onSuccessItem=function(e,t,n,i){r.create("Datei erfolgreich hochgeladen!",5e3),console.info("onSuccessItem",e,t,n,i)},s.onErrorItem=function(e,t,n,i){r.create("Fehler beim Upload! Ist die Datei beschädigt?",5e3),console.info("onErrorItem",e,t,n,i)},s.onCancelItem=function(e,t,n,i){console.info("onCancelItem",e,t,n,i)},s.onCompleteItem=function(e,t,n,i){console.info("onCompleteItem",e,t,n,i)},s.onCompleteAll=function(){r.create("Datei(en) erfolgreich hochgeladen! Sie wird/werden nun im Hintergrund analysiert...",5e3),o.resetSearchConfiguration(),i.setSearchMode(!1),i.allInvoices(),n(function(){t.go("invoices.list")},2e3),console.info("onCompleteAll")},console.info("uploader",s)}angular.module("msWebApp").controller("FileAnalysesController",e),e.$inject=["FileUploader","$state","$timeout","NotificationService","InvoiceService","SearchService","csrfToken"]}(),function(){"use strict";function e(i,r){var o={invoicecategories:"/webapp/api/invoicecategories",autoAttributes:"/autoAttributes"},e={list:s,getOne:function(e){return i({method:"GET",url:o.invoicecategories+"/"+e})},getAutoAttributes:function(e){return i({method:"GET",url:o.invoicecategories+"/"+e+o.autoAttributes})},getInvoiceCategories:function(){return n},getParentInvoiceCategories:function(t){return t?_.filter(a,function(e){return e.invoiceCategoryType===t}):a},create:function(e,t){var n={invoiceCategoryName:e,parentInvoiceCategoryDTO:{invoiceCategoryId:t}};return r(function(t){return i({method:"POST",url:o.invoicecategories,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s().then(function(e){t(e.data)})})})},remove:function(e){return r(function(t){return i({method:"DELETE",url:o.invoicecategories+"/"+e}).then(function(e){s().then(function(e){t(null)})},function(e){$log.warn("Could not delete invoice category!","result",e),t(null)})})}},n=[],a=[];return s(),e;function s(){return r(function(t){i({method:"GET",url:o.invoicecategories}).then(function(e){n=e.data,a=_.filter(n,function(e){return null===e.parentInvoiceCategoryDTO}),t(e.data)})})}}angular.module("msWebApp").factory("InvoicecategoriesService",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e){var t="/webapp/api/invoices/image";return{getInvoiceImageUrl:function(e){return t+"/"+e}}}angular.module("msWebApp").factory("InvoiceimageService",e),e.$inject=["$http"]}(),function(){"use strict";function e(o,e,a,s,t){var u={messages:"/webapp/api/messages",invoices:"/webapp/api/invoices",deleteMessage:"/webapp/api/basicdata"},c=[],n={list:i,getMessages:function(){return c},problemSolved:function(r){return e(function(i){var e={method:"DELETE",url:u.invoices+"/"+r+"/problemSolved"};o(e).then(function(e){var t=s.filter(c,function(e){return e.basicDataId===r});if(null!=t&&null!=t&&0<t.length){var n=s.indexOf(c,t[0]);c.splice(n,1),i(c[n])}a.create("Nachricht wurde gelöscht!",5e3),i(e)})})},deleteMessage:function(n){return e(function(t){var e={method:"DELETE",url:u.deleteMessage+"/"+n};o(e).then(function(e){a.create("Nachricht wurde gelöscht!",5e3),i(),t(null)})})}};return t.isCustomized().then(function(e){e.data.value&&i()}),n;function i(){return e(function(n){o({method:"GET",url:u.messages}).then(function(e){var t=e.data;c=[],t.forEach(function(e){var t=e,n=JSON.parse(t.value);t.subject=n.subject,t.message=n.message,t.messageType=n.messageType,c.push(t)}),n(c)})})}}angular.module("msWebApp").factory("MessageService",e),e.$inject=["$http","$q","NotificationService","_","SettingsService"]}(),function(){"use strict";function e(i,e,t,n,r,o,a,s,u,c,l,d,m,p,g,f,v){var h=this;function I(){var e=!0;if(h.imagePreview)return!0;h.isStandingOrder&&(e=h.originalStandingOrder.startDate==h.standingOrder.startDate&&h.originalStandingOrder.repetitionTypeEnum==h.standingOrder.repetitionTypeEnum);var t=angular.equals(h.originalCostDistributionItems,h.costDistributionItems)&&angular.equals(h.originalInvoice,h.invoice);return!(e&&t||"EXTERNAL_USER_CHECK_MODE"===h.invoice.invoiceWorkflowMode||"EXTERNAL_USER_READY_MODE"===h.invoice.invoiceWorkflowMode)}function b(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function y(t){v.currentUser().then(function(e){h.currentUser=e,null!=t&&t()})}function T(){h.createNewCostDistributionItem(),"INCOME"===h.invoice.mainFunctionEnum?(h.invoice.paymentRecipientId=h.currentUser.appUserId,h.invoice.paymentRecipientTypeEnum="USER"):(h.invoice.payerId=h.currentUser.appUserId,h.invoice.payerTypeEnum="USER"),h.originalInvoice=angular.copy(h.invoice)}h.title="InvoiceEditController",h.invoice={},h.invoice.articleDTOs=[],h.createMode=!1,h.mistakeMessage="",h.imagePreview=null,h.uploader=new r({url:"/webapp/api/invoices/image",headers:{},alias:"fileUpload"}),a.returnView?h.returnView=a.returnView:h.returnView="invoices.list",a.transactionType?(h.invoice.mainFunctionEnum=a.transactionType,h.createMode=!0):h.invoice.mainFunctionEnum="EXPENSE",a.isStandingOrder?h.isStandingOrder=!0:h.isStandingOrder=!1,h.costDistributionItems=[],h.payerName="",h.paymentRecipientName="",h.currentUser={},h.hasInvoiceImageValue=!1,h.loadingBarCategory=!1,a.invoiceId&&(h.invoice.invoiceId=a.invoiceId),h.repetionTypeEnums=[],h.paymentTypeEnums=[],h.userSelectSearch="",h.standingOrder={},h.originalStandingOrder={},h.costDistributions=[],h.costDistributionsMenu=[],h.costDistributionsMenuOptions=[],h.selectedCostDistributionItemForArticleSelection=null,h.submitForm=function(){I()?h.createMode?(u.create(h.invoice,h.costDistributionItems).then(function(e){h.imagePreview&&h.uploader.uploadAll(),h.isStandingOrder&&u.generateStandingOrder(h.standingOrder,!0)}),C()):D():C()},h.resetForm=function(){h.invoice.invoiceId?S():h.invoice={},s.invoiceForm.$setPristine(),s.invoiceForm.$setUntouched()},h.repeatAnalysis=function(){u.repeatAnalysis(h.invoice.invoiceId).then(function(e){}),C()},h.getInvoice=function(){return h.invoice},h.addCostDistributionItemToList=function(e){var t={costDistributionItemId:b(),costDistributionItemTypeEnum:"QUOTA",position:h.costDistributionItems.length,value:1,costPaid:0,invoiceId:h.invoice.invoiceId,payerId:e.id,paymentPersonName:e.name,paymentPersonTypeEnum:e.type,payerDTO:{displayName:e.name}};null!=e.virtualType&&"USER"===e.virtualType?t.correctionStatus="CHECK":"CONTACT"===e.type?t.correctionStatus="READY":t.correctionStatus="IGNORE",h.costDistributionItems.push(t),h.updateCostDistributionItems()},h.isReadOnlyMode=function(){return"EXTERNAL_USER_CHECK_MODE"===h.invoice.invoiceWorkflowMode||"EXTERNAL_USER_READY_MODE"===h.invoice.invoiceWorkflowMode},h.generateStandingOrder=function(){u.generateStandingOrder(h.standingOrder,!0)},h.selectInvoiceCategory=function(e){h.invoice.invoiceCategoryDTO=e,w(h.invoice.invoiceCategoryDTO.invoiceCategoryId)},h.updateCostDistributionItems=function(){null!=h.invoice.sumOfInvoice&&null!=h.invoice.sumOfInvoice&&h.costDistributionItems.forEach(function(e){e.moneyValue=m.calculateAmountForCostDistributionItemPrecise(e,h.costDistributionItems,h.invoice.sumOfInvoice)})},h.resetInvoice=function(){h.costDistributionItems=angular.copy(h.originalCostDistributionItems),h.invoice=angular.copy(h.originalInvoice),h.isStandingOrder&&(h.standingOrder=angular.copy(h.originalStandingOrder)),E()},h.paymentRecipientTransfer=function(e){null!=e?(h.invoice.paymentRecipientId=e.id,h.invoice.paymentRecipientTypeEnum=e.type,h.paymentRecipientName=e.name,null!=e.virtualType&&"USER"===e.virtualType?h.invoice.correctionStatus="CHECK":"CONTACT"===e.type?h.invoice.correctionStatus="READY":h.invoice.correctionStatus="IGNORE","BUSINESS_PARTNER"===e.type&&A(e.id)):(h.invoice.paymentRecipientId=null,h.invoice.paymentRecipientTypeEnum=null,h.paymentRecipientName=null)},h.showDialog=function(e){$(h.getDialogId(e)).modal("show")},h.updateCostDistributionItemDirectiveExec=function(e){t.info(e),t.info(h.updateCostDistributionItemDirective),h.updateCostDistributionItemDirective[e]()},h.payerTransfer=function(e){null!=e?(h.invoice.payerId=e.id,h.invoice.payerTypeEnum=e.type,h.payerName=e.name,null!=e.virtualType&&"USER"===e.virtualType?h.invoice.correctionStatus="CHECK":"CONTACT"===e.type?h.invoice.correctionStatus="READY":h.invoice.correctionStatus="IGNORE","BUSINESS_PARTNER"===e.type&&A(e.id)):(h.invoice.payerId=null,h.invoice.payerTypeEnum=null,h.payerName=null)},h.remove=function(){h.isStandingOrder?h.removeInvoiceTemplate():h.removeInvoice()},h.removeImage=function(){h.invoice.invoiceImageId=null,h.hasInvoiceImage(),h.invoice.articleDTOs=[],h.imagePreview=void 0,h.uploader.clearQueue()},h.getDialogId=function(e){var t="#";return null!=e&&(t+=e),t},h.getDialogIdWithoutHash=function(e){return e},h.showArticlesInvoiceDialog=function(){h.showArticlesDialogForInvoice=!0,$("#articlesModalDialogForInvoice").modal("show")},h.hideArticlesInvoiceDialog=function(){$("#articlesModalDialogForInvoice").modal("hide"),h.showArticlesDialogForInvoice=!1},h.selectArticleInvoiceData=function(){return h.showPaymentRecipient()?{username:h.paymentRecipientName,invoiceId:h.invoice.invoiceId,articles:h.invoice.articleDTOs,imageUrl:h.getInvoiceImageUrl()}:h.showPayer()?{username:h.payerName,invoiceId:h.invoice.invoiceId,articles:h.invoice.articleDTOs,imageUrl:h.getInvoiceImageUrl()}:void 0},h.callbackForArticlesSelectInvoice=function(e,t){h.invoice.articleDTOs=e,h.invoice.sumOfInvoice=t,h.updateCostDistributionItems(),h.hideArticlesInvoiceDialog()},h.selectArticleCostDistributionItem=function(e){h.selectedCostDistributionItemForArticleSelection=e,h.showArticlesDialogForCostDistributionItem=!0,$("#articlesModalDialogCostDistributionItem").modal("show")},h.hideSelectArticleCostDistributionItemDialog=function(){$("#articlesModalDialogCostDistributionItem").modal("hide"),h.showArticlesDialogForCostDistributionItem=!1},h.selectedArticleCostDistributionItemData=function(){return{username:h.selectedCostDistributionItemForArticleSelection.payerDTO.displayName,invoiceId:h.invoice.invoiceId,articles:h.selectedCostDistributionItemForArticleSelection.articleDTOs,imageUrl:h.getInvoiceImageUrl()}},h.callbackForArticlesSelectCostDistributionItem=function(e,t){h.selectedCostDistributionItemForArticleSelection.articleDTOs=e,h.selectedCostDistributionItemForArticleSelection.moneyValue=t,h.selectedCostDistributionItemForArticleSelection.value=t,h.selectedCostDistributionItemForArticleSelection.costDistributionItemTypeEnum="FIXED_AMOUNT",h.updateCostDistributionItems(),h.hideSelectArticleCostDistributionItemDialog()},h.showPaymentRecipient=function(){return"EXPENSE"===h.invoice.mainFunctionEnum&&!h.invoice.reverseInvoice||"EXPENSE"!==h.invoice.mainFunctionEnum&&h.invoice.reverseInvoice},h.showPayer=function(){return"INCOME"===h.invoice.mainFunctionEnum&&!h.invoice.reverseInvoice||"INCOME"!==h.invoice.mainFunctionEnum&&h.invoice.reverseInvoice},h.removeCostDistributionItemFromList=function(t){var e=h.costDistributionItems.findIndex(function(e){return e.costDistributionItemId===t.costDistributionItemId});h.costDistributionItems.splice(e,1);var n=h.invoice.sumOfInvoice;if(1===h.costDistributionItems.length){var i=h.costDistributionItems[0];if(n<m.calculateAmountForCostDistributionItemPrecise(i,h.costDistributionItems,h.invoice.sumOfInvoice)){var r=i.costDistributionItemTypeEnum;"FIXED_AMOUNT"===r?i.value=n:"PERCENT"===r?i.value=100:"QUOTA"===r&&(i.value=1),i.moneyValue=n}}h.updateCostDistributionItems()},h.hasInvoiceImage=function(){h.hasInvoiceImageValue=!!h.invoice.invoiceImageId},h.getInvoiceImageUrl=function(){return h.imagePreview?h.imagePreview:p.getInvoiceImageUrl(h.invoice.invoiceImageId)},h.goToOverview=function(){C()},h.removeInvoice=function(){u.remove(h.invoice.invoiceId),C()},h.removeInvoiceTemplate=function(){u.deleteStandingOrder(h.invoice.invoiceId),C()},h.isNullOrUndefined=function(e){return null==e},h.setCorrectionStatus=function(e){h.isNullOrUndefined(h.correctionStatus)?h.correctionStatus=e:h.correctionStatus=null,D()},h.setCostPaidStatus=function(e){e.costPaid&&0!==e.costPaid?e.costPaid=0:e.costPaid=e.moneyValue},h.setInvoiceCostPaidStatus=function(e){e.costPaid&&0!==e.costPaid?e.costPaid=0:e.costPaid=e.sumOfInvoice},h.showPaymentRecipientPaymentPersonHasPaidButton=function(){return null!=h.invoice.paymentRecipientTypeEnum&&("CONTACT"===h.invoice.paymentRecipientTypeEnum||"USER"===h.invoice.paymentRecipientTypeEnum)&&h.invoice.paymentRecipientId!==h.invoice.createdById},h.showPayerPaymentPersonHasPaidButton=function(){return null!=h.invoice.payerTypeEnum&&("CONTACT"===h.invoice.payerTypeEnum||"USER"===h.invoice.payerTypeEnum)&&h.invoice.payerId!==h.invoice.createdById},h.showCostPaymentPersonHasPaidButton=function(e){return null!=e.paymentPersonTypeEnum&&("CONTACT"===e.paymentPersonTypeEnum||"USER"===e.paymentPersonTypeEnum)&&e.payerId!==h.invoice.createdById&&0!==h.invoice.sumOfInvoice},h.paymentItemPersonHasPaid=function(e){return!(null==e.costPaid&&0!=e.moneyValue||null!=e.costPaid&&e.costPaid!=e.moneyValue!=0)},h.invoicePaymentItemPersonHasPaid=function(e){return!(null==e.costPaid&&0!=e.sumOfInvoice||null!=e.costPaid&&e.costPaid!=e.sumOfInvoice!=0)},h.createNewCostDistributionItem=function(){h.costDistributionItems.push({costDistributionItemId:b(),costDistributionItemTypeEnum:"QUOTA",position:h.costDistributionItems.length,value:1,costPaid:0,invoiceId:h.invoice.invoiceId,correctionStatus:"READY",payerId:h.currentUser.appUserId,payerTypeEnum:"USER",paymentPersonName:h.currentUser.appUserName,paymentPersonTypeEnum:"USER",payerDTO:{displayName:h.currentUser.appUserName}}),h.updateCostDistributionItems(),h.originalCostDistributionItems=angular.copy(h.costDistributionItems)},h.correctDateAndRepetitionForStandingOrder=function(){var e=h.originalStandingOrder.startDate!=h.standingOrder.startDate;h.invoice.dateOfInvoice=e?h.standingOrder.startDate:h.originalInvoice.dateOfInvoice,h.invoice.repetitionTypeEnum=h.standingOrder.repetitionTypeEnum},h.areChanges=function(){return I()},h.useCostDistribution=function(e){h.costDistributionItems=[],e.costDistributionItemDTOS.forEach(function(e){var t=f.prepareItemForCostDistribution(angular.copy(e));h.costDistributionItems.push(t)}),h.costDistributionItems.forEach(function(e){e.moneyValue=m.calculateAmountForCostDistributionItemPrecise(e,h.costDistributionItems,h.invoice.sumOfInvoice),e.invoiceId=h.invoice.invoiceId})},h.createCostDistributionRequest=function(){var e={name:h.newCostDistributionName};f.create(e,h.costDistributionItems).then(function(e){h.newCostDistributionName=null,h.costDistributions.push(e)})},h.removeCostDistribution=function(i){f.remove(i.costDistributionId).then(function(e){var t=_.filter(h.costDistributions,function(e){return e.costDistributionId===i.costDistributionId});if(null!=t&&null!=t&&0<t.length){var n=_.indexOf(h.costDistributions,t[0]);h.costDistributions.splice(n,1)}})},h.sendMistakeMessage=function(){u.sendMistakeMessage(h.invoice.invoiceId,h.mistakeMessage).then(function(e){h.mistakeMessage=""})},h.useStandardCostDistribution=function(){h.costDistributionItems=[],h.costDistributionItems.push({costDistributionItemId:b(),costDistributionItemTypeEnum:"QUOTA",position:h.costDistributionItems.length,value:1,costPaid:0,invoiceId:h.invoice.invoiceId,correctionStatus:"READY",payerId:h.currentUser.appUserId,payerTypeEnum:"USER",paymentPersonName:h.currentUser.appUserName,paymentPersonTypeEnum:"USER",payerDTO:{displayName:h.currentUser.appUserName}}),h.updateCostDistributionItems()},h.deleteConfirmationMenu=[["Löchen bestätigen",function(e,t,n){h.remove()}]],function(){if(h.invoice.invoiceId)y(),S();else{var e=new Date;h.invoice.dateOfInvoice=e.getTime(),h.invoice.invoiceId=b(),h.isStandingOrder?h.invoice.invoiceStatusEnum="CHECK":h.invoice.invoiceStatusEnum="READY",h.invoice.invoiceSource="MANUAL",h.invoice.repetitionTypeEnum="ONCE",h.invoice.paymentTypeEnum="NOT_DEFINED",y(T),h.invoice.sumOfInvoice=0,h.invoice.costPaid=0}h.uploader=new r({url:"/webapp/api/invoices/image/"+h.invoice.invoiceId,headers:{},alias:"fileUpload"});var t=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}(n);h.uploader.headers[n]=t,h.uploader.filters.push({name:"syncFilter",fn:function(e,t){return console.log("syncFilter"),this.queue.length<2}}),h.uploader.onAfterAddingFile=function(e){for(var t=0;t<h.uploader.queue.length-1;t++)h.uploader.queue[0].remove();h.uploader.progress=0,console.info("onAfterAddingFile",e);var n=new FileReader;n.onload=function(){h.imagePreview=n.result},n.readAsDataURL(e._file),i(function(){h.hasInvoiceImage()},500),h.invoice.invoiceImageId=void 0},h.uploader.onSuccessItem=function(e,t,n,i){console.info("onSuccessItem",e,t,n,i),h.invoice.invoiceImageId=t.invoiceImageId,h.originalInvoice.invoiceImageId=t.invoiceImageId,h.hasInvoiceImage()},h.standingOrder.invoiceTemplateId=h.invoice.invoiceId,h.standingOrder.futureInvoiceTemplateId=b(),h.isStandingOrder?i(function(){u.getStandingOrder(h.invoice.invoiceId).then(function(e){h.standingOrder.repetitionTypeEnum=e.repetitionTypeEnum,h.standingOrder.startDate=e.startDate,h.originalStandingOrder=angular.copy(h.standingOrder)},function(e){h.standingOrder.startDate=(new Date).getTime(),h.standingOrder.repetitionTypeEnum="MONTHLY",h.originalStandingOrder={repetitionTypeEnum:h.standingOrder.repetitionTypeEnum,startDate:h.standingOrder.startDate},h.invoice.repetitionTypeEnum=h.standingOrder.repetitionTypeEnum,h.originalInvoice.repetitionTypeEnum=h.standingOrder.repetitionTypeEnum})},400):h.originalStandingOrder=angular.copy(h.standingOrder),u.repetitionTypeEnumList().then(function(e){if(h.repetionTypeEnums=e.data,h.isStandingOrder){var t=_.filter(h.repetionTypeEnums,function(e){return"ONCE"===e.name});if(null!=t&&null!=t&&0<t.length){var n=_.indexOf(h.repetionTypeEnums,t[0]);h.repetionTypeEnums.splice(n,1)}}}),u.paymentTypeEnumList().then(function(e){h.paymentTypeEnums=e.data}),h.costDistributions=f.getCostDistributions(),v.hasUserRight("OCR").then(function(e){h.hasScanRight=e})}();var C=function(){angular.isObject(h.returnView)?o.go(h.returnView.view,h.returnView.params):o.go(h.returnView)};function E(){h.hasInvoiceImage(),null!=h.invoice.paymentRecipientId&&(h.paymentRecipientName=h.invoice.paymentRecipientDTO.displayName),null!=h.invoice.payerId&&(h.payerName=h.invoice.payerDTO.displayName)}function S(){u.details(h.invoice.invoiceId).then(function(e){h.invoice=e.data,E(),d.listForInvoice(h.invoice.invoiceId).then(function(e){h.costDistributionItems=e.data,h.originalCostDistributionItems=angular.copy(h.costDistributionItems)},function(e){}),h.originalInvoice=angular.copy(h.invoice)})}function D(){u.update(h.invoice,h.correctionStatus,h.costDistributionItems).then(function(e){h.imagePreview?h.uploader.uploadAll():h.originalInvoice.invoiceImageId&&!h.invoice.invoiceImageId&&u.deleteInvoiceImage(h.invoice.invoiceId),h.isStandingOrder&&u.updateStandingOrder(h.invoice.invoiceId,h.standingOrder)}),C()}function A(e){return h.loadingBarCategory=!0,c.getAutoCategory(e).then(function(e){h.invoice.invoiceCategoryDTO=e.data,h.loadingBarCategory=!1,w(h.invoice.invoiceCategoryDTO.invoiceCategoryId)},function(e){h.invoice.invoiceCategoryDTO=null,h.loadingBarCategory=!1})}function w(e){g.getAutoAttributes(e).then(function(e){var t=e.data.costDistributionItems;null!=t&&null!=t&&(h.costDistributionItems=t,h.costDistributionItems.forEach(function(e){e.moneyValue=m.calculateAmountForCostDistributionItemPrecise(e,h.costDistributionItems,h.invoice.sumOfInvoice),e.costDistributionItemId=b(),e.costDistributionId=null,e.invoiceId=h.invoice.invoiceId}));var n=e.data.repetitionTypeEnum;null!=n&&null!=n&&(h.invoice.repetitionTypeEnum=n);var i=e.data.isSpecialType;null!=i&&null!=i&&(h.invoice.specialType=i)})}}angular.module("msWebApp").controller("InvoiceEditController",e),e.$inject=["$timeout","$filter","$log","csrfToken","FileUploader","$state","$stateParams","$scope","InvoiceService","BusinesspartnerService","UsercontactService","CostdistributionitemService","CostdistributioncalculateService","InvoiceimageService","InvoicecategoriesService","CostdistributionService","UserService"]}(),function(){"use strict";function e(e,t,n,i,r,o,a,s){var u=this;u.title="InvoiceListController",u.showCheckList=!1,u.showReadyList=!1,u.isLoadingReadyList=!1,u.toggleFilter=!1,u.selected=[],u.goToInvoice=function(e){"ANALYZING"!==e.invoiceStatusEnum?i.go("^.details",{invoiceId:e.invoiceId}):s.create("Rechnung wird gerade analysiert! Bitte warten!",3e3)},u.setViewMode=function(e){o.setViewMode(e)},u.getInvoices=function(e){return o.getInvoices(e)},u.viewMode=function(e){return o.getViewMode()===e},u.getIsScrollingDisabled=function(){return o.getIsScrollingDisabled()},u.toggleFilterView=function(){u.toggleFilter=!u.toggleFilter},u.toggleExportView=function(){u.showCsvExport=!u.showCsvExport,u.showCsvExport&&(u.toggleFilter=!0)},u.getCsvExportUrl=function(){var e=JSON.stringify(a.getSearchConfiguration()),t=btoa(e);return"/webapp/api/export/withFilter/export.csv?invoiceStatusEnum="+o.getViewMode()+"&filter="+t},u.setCorrectionStatusForSelection=function(){o.updateCorrectionStatus(u.selected,"READY").then(function(e){u.selected=[]})},u.startSearch=function(){u.refreshInvoiceList()},u.invoiceServiceLoading=function(){return o.isLoading()},u.refreshInvoices=function(){a.resetSearchConfiguration(),u.refreshInvoiceList()},u.refreshInvoiceList=function(){o.clearCurrentPageReadyList(),o.clearCurrentPageCheckList(),o.setSearchMode(!1),o.setIsScrollingDisabled(!0),o.allInvoices().then(function(){o.getIsScrollingDisabled()||t.$emit("readyList:filtered")})},u.showMoreReadyList=function(){o.isSearchMode()||o.getIsScrollingDisabled()||"READY"!==o.getViewMode()||(u.isLoadingReadyList=!0,e.warn("Invoice list showMoreReadyList"),o.setIsScrollingDisabled(!0),o.addValueToCurrentPageReadyList(),o.readyInvoicesList().then(function(e){u.isLoadingReadyList=!1},function(e){u.isLoadingReadyList=!1}))},u.showMoreCheckList=function(){o.isSearchMode()||(o.addValueToCurrentPageCheckList(),o.checkInvoicesList())},u.newExpense=function(){i.go("^.create",{transactionType:"EXPENSE"})},u.newIncome=function(){i.go("^.create",{transactionType:"INCOME"})},u.newFileAnalysis=function(){i.go("fileanalyses.upload")},u.otherMenuOptions=[["Einnahme",function(e,t,n){u.newIncome()}],["Ausgabe",function(e,t,n){u.newExpense()}]]}angular.module("msWebApp").controller("InvoiceListController",e),e.$inject=["$log","$scope","$filter","$state","$stateParams","InvoiceService","SearchService","NotificationService"]}(),function(){"use strict";function e(c,l,r,o,a,d,f){var m={invoices:"/webapp/api/invoices",invoicesWithFilterBean:"/webapp/api/search/withFilterBean",invoiceImages:"/webapp/api/invoices/image",standingOrders:"/webapp/api/standingOrders",standingOrderInvoiceTemplates:"/webapp/api/standingOrders/invoiceTemplates",deleteStandingOrders:"/webapp/api/standingOrders/deleteByInvoiceTemplate",invoiceAnalysis:"/webapp/api/service/upload"},s=[],p=[],g=[],u="CHECK",v=[],h=!1,I=0,b=0,t=!1,y=!0,e={list:D,create:function(t,i){return r(function(n){var e={method:"PUT",url:m.invoices+"/"+t.invoiceId,data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}};l(e).then(function(t){o.update(t.data.invoiceId,i).then(function(e){A(t.data.invoiceId).then(function(e){C(e.data),n(null)})}),a.create("Rechnung wurde erstellt!",5e3)})})},details:A,update:function(n,i,e){return n.costDistributionItemDTOs=e,r(function(t){var e={method:"PUT",url:m.invoices+"/"+n.invoiceId,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}};null!=i&&null!=i&&(e.params={setWorkflow:i}),l(e).then(function(e){null!=i&&null!=i?(w(n.invoiceId),C(e.data)):(P(e.data),a.create("Rechnung wurde aktualisiert!",5e3),t(null))},function(e){a.create("Fehler während der Aktualisierung!",5e3),S()})})},remove:function(n){return r(function(t){return l({method:"DELETE",url:m.invoices+"/"+n}).then(function(e){w(n),a.create("Rechnung wurde gelöscht!",5e3),t(null)},function(e){c.warn("Could not delete invoice!","result",e),t(null)})})},sendMistakeMessage:function(e,t){var n={message:t};return l({method:"POST",url:m.invoices+"/"+e+"/mistake",data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){a.create("Fehler erfolgreich gemeldet!",5e3)},function(e){a.create("Fehlermeldung nicht erfolgreich!",5e3),c.warn("Could not get create mistake message!","result",e),h=!1})},deleteInvoiceImage:function(e){return l({method:"DELETE",url:m.invoiceImages+"/"+e}).then(function(e){},function(e){a.create("Fehler beim Löschen von Bild!",5e3),c.warn("Could not delete standing order!","result",e)})},repetitionTypeEnumList:function(){return l({method:"GET",url:m.invoices+"/repetitionTypeEnums"})},paymentTypeEnumList:function(){return l({method:"GET",url:m.invoices+"/paymentTypeEnums"})},getInvoices:function(e){{if("CHECK"===e)return s;if("READY"===e)return p;if("STANDING_ORDER"===e)return v}return[]},getIsScrollingDisabled:function(){return y},setIsScrollingDisabled:function(e){y=e},getInvoicesReadyRawList:function(){return g},setInvoices:function(e){var t=[];e.forEach(function(e){t.push(e)}),function(e){s=f.filter(e,function(e){return("EXTERNAL_USER_CHECK_MODE"===e.invoiceWorkflowMode||"CREATED_USER_CHECK_MODE"===e.invoiceWorkflowMode)&&e.standingOrderInvoiceTemplateId!==e.invoiceId});var t=f.filter(e,function(e){return("EXTERNAL_USER_READY_MODE"===e.invoiceWorkflowMode||"CREATED_USER_READY_MODE"===e.invoiceWorkflowMode)&&e.standingOrderInvoiceTemplateId!==e.invoiceId}),n=f.sortBy(t,function(e){return new Date(e.dateOfInvoice)}).reverse();p=i(n),v=f.filter(e,function(e){return e.standingOrderInvoiceTemplateId===e.invoiceId})}(t)},isLoading:function(){return h},setIsLoading:function(e){h=e},generateStandingOrder:function(e,t){var n=t?m.standingOrders+"?deleteInvoiceTemplate=true":m.standingOrders;return l({method:"POST",url:n,data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){a.create("Dauerauftrag erfolgreich erstellt!",5e3),S()},function(e){a.create("Fehler bei Erstellung des Dauerauftrags!",5e3),c.warn("Could not get create standing order!","result",e),h=!1})},deleteStandingOrder:function(i){return l({method:"DELETE",url:m.deleteStandingOrders+"/"+i}).then(function(e){var t=f.filter(v,function(e){return e.invoiceId===i});if(null!=t&&null!=t&&0<t.length){var n=f.indexOf(v,t[0]);v.splice(n,1)}a.create("Dauerauftrag wurde gelöscht!",5e3)},function(e){a.create("Fehler beim Löschen von Dauerauftrag!",5e3),c.warn("Could not delete standing order!","result",e)})},updateStandingOrder:function(n,i){return r(function(t){var e={method:"PUT",url:m.standingOrderInvoiceTemplates+"/"+n,data:i,headers:{"Content-Type":"application/json;charset=UTF-8"}};l(e).then(function(e){a.create("Dauerauftrag wurde aktualisiert!",5e3),t(null)},function(e){a.create("Fehler während der Aktualisierung!",5e3),S()})})},getStandingOrder:function(i){return r(function(t,n){var e={method:"GET",url:m.standingOrderInvoiceTemplates+"/"+i};l(e).then(function(e){t(e.data)},function(e){n(null)})})},allInvoices:S,addValueToCurrentPageReadyList:function(){I+=1},addValueToCurrentPageCheckList:function(){b+=1},readyInvoicesList:function(){var e=angular.copy(I),t=g.length,n=[];return g.forEach(function(e){n.push(e)}),D(!1,"READY",p,e,void 0,t,[],n)},checkInvoicesList:function(){return D(!1,"CHECK",s,b)},clearCurrentPageReadyList:function(){I=0},clearCurrentPageCheckList:function(){I=0},isSearchMode:function(){return t},setSearchMode:function(e){t=e},updateCorrectionStatus:function(n,i){return r(function(t){var e={method:"POST",url:m.invoices+"/setCorrectionStatus",data:n,headers:{"Content-Type":"application/json;charset=UTF-8"},params:{setWorkflow:i}};l(e).then(function(e){e.data.forEach(function(e){w(e.invoiceId),C(e)}),a.create("Status wurde aktualisiert!",5e3),t(null)},function(e){a.create("Fehler während der Aktualisierung!",5e3),S()})})},getViewMode:function(){return u},setViewMode:function(e){u=e},repeatAnalysis:function(t){return l({method:"POST",url:m.invoiceAnalysis+"/"+t+"/repeatAnalysis"}).then(function(e){w(t),C(e.data),a.create("Bild wird nochmal analysiert!",5e3)},function(e){a.create("Fehler bei Analyse vom Bild!",5e3),c.warn("Could not analyze image!","result",e)})},pollingProcessRecursive:T};return S(),e;function T(t,n){var i=[3,1,1,1,1,2,3,4,4,5,5,5];setTimeout(function(){A(t).then(function(e){"ANALYZING"!==e.data.invoiceStatusEnum?P(e.data):n<i.length-1&&T(t,n+1)})},1e3*i[n])}function C(e){return"EXTERNAL_USER_READY_MODE"!==e.invoiceWorkflowMode&&"CREATED_USER_READY_MODE"!==e.invoiceWorkflowMode||e.standingOrderInvoiceTemplateId===e.invoiceId?"EXTERNAL_USER_CHECK_MODE"!==e.invoiceWorkflowMode&&"CREATED_USER_CHECK_MODE"!==e.invoiceWorkflowMode||e.standingOrderInvoiceTemplateId===e.invoiceId?e.standingOrderInvoiceTemplateId===e.invoiceId&&(v.push(e),v):(s.push(e),s):(g.push(e),p=E(g),g)}function E(e){var t=[];return e.forEach(function(e){t.push(e)}),i(f.sortBy(t,function(e){return new Date(e.dateOfInvoice)}).reverse())}function i(e){for(var t=[],n=[],i=[],r=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],o=0;o<e.length;o++){var a=e[o].dateOfInvoice,s=parseInt(a),u=new Date(s),c=(u.getMonth()+" "+u.getFullYear()).toString(),l={month:u.getMonth(),year:u.getFullYear(),key:c};0==f.filter(n,function(e){return e.key===c}).length&&n.push(l),null==t[c]&&(t[c]=[]),t[c].push(e[o])}for(var d=0;d<n.length;d++){var m=r[n[d].month]+" "+n[d].year,p=0;t[n[d].key].forEach(function(e){p+=e.moneyValue});var g=Math.pow(10,2);p=+Math.round(p*g)/g,i.push({groupLabel:m,items:t[n[d].key],groupSum:p})}return i}function S(){return s=[],g=[],v=[],h=!(b=I=0),r(function(t){var e=g.length,n=angular.copy(I),i=[];g.forEach(function(e){i.push(e)}),r.all([D(!0,null,v),D(!1,"READY",p,n,void 0,e,[],i),D(!1,"CHECK",s,b)]).then(function(e){h=!1,u=(null==s||0==s.length)&&null!=g&&0<=g.length?"READY":"CHECK",t(null)},function(e){h=!1,t(null)})})}function D(e,n,i,r,t,o,a,s){var u=d.getSearchConfiguration();return l({method:"POST",url:m.invoicesWithFilterBean,params:{onlyStandingOrder:e,invoiceStatusEnum:n,pageNumber:r},data:u,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){var t=e.data;null!=n&&"READY"===n?(t=e.data.invoiceDTOs,r=e.data.currentPage,t.forEach(function(e){a.push(e)}),a.forEach(function(e){s.push(e)}),g=[],s.forEach(function(e){g.push(e)}),I=r,p=E(g),y=!1):t.forEach(function(e){"ANALYZING"===e.invoiceStatusEnum&&T(e.invoiceId,0),i.push(e)})},function(e){c.warn("Could not get invoices!","result",e)})}function A(e){return l({method:"GET",url:m.invoices+"/"+e})}function w(t){var e,n;null!=(n=f.filter(s,function(e){return e.invoiceId===t}))&&null!=n&&0<n.length&&(e=f.indexOf(s,n[0]),s.splice(e,1),s[e]),null!=(n=f.filter(g,function(e){return e.invoiceId===t}))&&null!=n&&0<n.length&&(e=f.indexOf(g,n[0]),g.splice(e,1),p[e],p=E(g)),null!=(n=f.filter(v,function(e){return e.invoiceId===t}))&&null!=n&&0<n.length&&(e=f.indexOf(v,n[0]),v.splice(e,1),v[e])}function P(t){var e,n;null!=(n=f.filter(s,function(e){return e.invoiceId===t.invoiceId}))&&null!=n&&0<n.length&&(e=f.indexOf(s,n[0]),s[e]=t),null!=(n=f.filter(g,function(e){return e.invoiceId===t.invoiceId}))&&null!=n&&0<n.length&&(e=f.indexOf(g,n[0]),g[e]=t,p=E(g)),null!=(n=f.filter(v,function(e){return e.invoiceId===t.invoiceId}))&&null!=n&&0<n.length&&(e=f.indexOf(v,n[0]),v[e]=t)}}angular.module("msWebApp").factory("InvoiceService",e),e.$inject=["$log","$http","$q","CostdistributionitemService","NotificationService","SearchService","_"]}(),function(){"use strict";function e(n,l,d){return{restrict:"E",template:'<div class="notifications"></div>',replace:!0,link:function(a,e,t){var s=angular.element(e),u=t.duration?t.duration:3e3,c=t.removeDelay?t.removeDelay:200;n.$on("createNotification",function(e,t){var n=i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i();function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var r='<div class="float-right w-100"><div class="toast m-2 float-right" role="alert" aria-live="assertive" aria-atomic="true" id="'+n+'"><div class="toast-header"><div class="mr-auto">Hinweis</div></div><div class="toast-body"><b>'+t.content+"</b></div></div></div>",o=angular.element(l(r)(a));s.append(o),$("#"+n).toast({delay:(t.duration?t.duration:u)-1e3}).toast("show"),d(function(){o.attr("hidden","hidden"),d(function(){$("#"+n).toast("hide"),o.remove()},c,!1)},t.duration?t.duration:u,!1)})},controller:t,controllerAs:"vm",bindToController:!0}}function t(){}angular.module("msWebApp").directive("msNotification",e),e.$inject=["$rootScope","$compile","$timeout"]}(),function(){"use strict";function e(i,r,e){return{create:function(t,n){e(t).then(function(e){r.$broadcast("createNotification",{content:e,duration:n})},function(e){i.error("No translation available:",e),r.$broadcast("createNotification",{content:t,duration:n})})}}}angular.module("msWebApp").factory("NotificationService",e),e.$inject=["$log","$rootScope","$translate"]}(),function(){"use strict";function e(){var e={getMaxQuotaForOneCostDistributionItem:p,getMaxAmountForOneQuota:a,getMaxAmountForOneCostDistributionItem:r,getCountWeightedWithoutFixed:f,calculateQuotaForValue:function(e,t,n,i){var r=0;if("FIXED_AMOUNT"===e){var o=0;if(1==t.compareTo(0)){var a=p(n),s=v("QUOTA",a,n,i),u=t;if(1==t.compareTo(s)?u=s:-1!=t.compareTo(0)&&0!=t.compareTo(0)||(u=0),0!=u.compareTo(0)){var c=u.divide(s,50),l=p(n);o=c.multiply(l).setScale(1)}}r=o}else if("QUOTA"===e)r=t.setScale(50);else if("PERCENT"===e)o=0,1==t.compareTo(0)&&(a=p(n),s=v("QUOTA",a,n,i),u=v("PERCENT",t,n,i),1==t.compareTo(s)?u=s:-1==t.compareTo(0)||0==t.compareTo(0)?u=0:1!=u.compareTo(s)&&0!=u.compareTo(s)||(u=s),0!=u.compareTo(0)&&(c=u.divide(s,50),l=p(n),o=c.multiply(l).setScale(1))),r=o;else if("REST"===e){var d=h(n),m=f(n);r=d.subtract(m)}return r.setScale(1)},calculateAmountForValue:v,calculatePercentForValue:function(e,t,n,i){var r=0;if("QUOTA"===e){var o=v("QUOTA",t,n,i).divide(i,30);r=o}else"FIXED_AMOUNT"===e?(o=t.divide(i,2),r=o):"PERCENT"===e&&(r=t);return r.setScale(2)},getCountWithoutFixed:h,getCountOfFixedAmount:I,getCountOfPercent:b,calculateAmountForCostDistributionItem:y,calculateAmountForCostDistributionItemPrecise:function(t,e,n){var i,r=[];e.forEach(function(e){r.push(e)});var o=e.findIndex(function(e){return e.costDistributionItemId===t.costDistributionItemId});if(r.splice(o,1),function(t,n){if(0==t.length)return;var e=f(t),i=h(t),r=I(t),o=b(t);{if(1==i.compareTo(0))return 0==i.compareTo(e);if(0==r.compareTo(0)&&1==o.compareTo(0)){var a=0;return t.forEach(function(e){a=a.add(e.value)}),0==a.compareTo(1)}if(1==r.compareTo(0)&&0==o.compareTo(0)){var s=0;return t.forEach(function(e){s=s.add(e.value)}),0==s.compareTo(n)}if(1==r.compareTo(0)&&1==o.compareTo(0)){var u=0;return t.forEach(function(e){u=y(e,t,n)}),0==u.compareTo(n)}}return 1}(e,n)){var a=0,s=0,u=-1,c=[];if(e.forEach(function(e){"FIXED_AMOUNT"!==e.costDistributionItemTypeEnum&&(a+=1,e.costDistributionItemId===t.costDistributionItemId&&(u=s),c.push(e),s++)}),1<a){var l=function(t,n){var i=0;return n.forEach(function(e){i=i.add(y(e,n,t))}),t.subtract(i)}(n,e);if(i=v(t.costDistributionItemTypeEnum,t.value,r,n).setScale(2),-1==l.compareTo(0)||1==l.compareTo(0)){var d=1;-1==l.compareTo(0)&&(d=-1);var m=l.multiply(d).multiply(100).divide(a,50).floor(),p=l.multiply(d).multiply(100).remainder(a);m=m.multiply(d),p=p.multiply(d),i=i.add(m.divide(100,2));for(var g=0;g<p.multiply(d).setScale(0);g++)g==u&&(i=i.add(.01.multiply(d)));i=i.setScale(2)}}else i=v(t.costDistributionItemTypeEnum,t.value,r,n).setScale(2)}else i=v(t.costDistributionItemTypeEnum,t.value,r,n).setScale(2);return i}};return Number.prototype.setScale=function(e){var t=Math.pow(10,e);return+Math.round(this*t)/t},Number.prototype.divide=function(e,t){return(this/e).setScale(t)},Number.prototype.remainder=function(e){return(this%e+e)%e},Number.prototype.compareTo=function(e){return this<e?-1:e<this?1:0},Number.prototype.multiply=function(e){return this*e},Number.prototype.subtract=function(e){return this-e},Number.prototype.add=function(e){return this+e},Number.prototype.floor=function(){return Math.floor(this)},e;function p(e){var t=h(e).add(1),n=f(e);return t.subtract(n)}function a(e,t){var n=r(e,t),i=h(e).add(1);return n.divide(i,50)}function r(t,n){var i=0;return t.forEach(function(e){"FIXED_AMOUNT"!==e.costDistributionItemTypeEnum&&"PERCENT"!==e.costDistributionItemTypeEnum||(i+=y(e,t,n))}),n.subtract(i)}function f(e){var t=0;return e.forEach(function(e){"QUOTA"===e.costDistributionItemTypeEnum&&(t+=e.value)}),t}function v(e,t,n,i){var r=0;if("QUOTA"===e){var o=a(n,i);-1==o.compareTo(0)&&(o=0),r=t.multiply(o).setScale(2)}else if("FIXED_AMOUNT"===e)r=t;else if("PERCENT"===e){r=i.multiply(t).setScale(2)}else if("REST"===e){n.forEach(function(e){"REST"!=e.costDistributionItemTypeEnum&&(0).add(y(e,n,i))}),r=i.subtract(0)}return r.setScale(2)}function h(e){var t=0;return e.forEach(function(e){"QUOTA"===e.costDistributionItemTypeEnum&&(t=t.add(1))}),t}function I(e){var t=0;return e.forEach(function(e){"FIXED_AMOUNT"===e.costDistributionItemTypeEnum&&(t=t.add(1))}),t}function b(e){var t=0;return e.forEach(function(e){"PERCENT"===e.costDistributionItemTypeEnum&&(t=t.add(1))}),t}function y(t,e,n){var i=[];e.forEach(function(e){i.push(e)});var r=e.findIndex(function(e){return e.costDistributionItemId===t.costDistributionItemId});return i.splice(r,1),v(t.costDistributionItemTypeEnum,t.value,i,n).setScale(2)}}angular.module("msWebApp").factory("CostdistributioncalculateService",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n){var i="/webapp/api/search/withFilterBean",r={search:function(){return e({method:"POST",url:i,data:a,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){e.data},function(e){t.warn("Could not get invoices!","result",e)})},getSearchConfiguration:function(){return a},setSearchConfiguration:function(e){a=e},resetSearchConfiguration:function(){a=angular.copy(o)},repairSearchConfiguration:function(){""===a.repetitionTypeEnum&&(a.repetitionTypeEnum=null);""===a.costDistributionId&&(a.costDistributionId=null);""===a.specialType&&(a.specialType=null);""===a.remarks&&(a.remarks=null)},isSearchConfigurationDefaultOne:function(){null!=a.startDate&&NaN!=a.startDate||(a.startDate=null);null!=a.endDate&&NaN!=a.endDate||(a.endDate=null);return angular.equals(a,o)}},o={incomeMainFunctionEnum:!0,expenseMainFunctionEnum:!0,repetitionTypeEnum:null,costDistributionId:null,specialType:null,paymentRecipientPerson:null,costPayer:null,payerPerson:null,invoiceCategoryDTO:null,startDate:null,endDate:null,remarks:null,fullText:null},a={incomeMainFunctionEnum:!0,expenseMainFunctionEnum:!0,repetitionTypeEnum:null,costDistributionId:null,specialType:null,paymentRecipientPerson:null,costPayer:null,payerPerson:null,invoiceCategoryDTO:null,startDate:null,endDate:null,remarks:null,fullText:null};return r}angular.module("msWebApp").factory("SearchService",e),e.$inject=["$http","$log","NotificationService"]}(),function(){"use strict";function e(e,t,n){var i=this;i.currentUser={},i.mailSendEnabled=!1,i.submitForm=function(){e.update(i.currentUser)},i.sendPasswordResetMail=function(){e.sendPassword(i.currentUser.email).then(function(e){t.create("Eine E-Mail zur Passwort-Änderung wurde verschickt.",5e3)},function(e){t.create("Leider ist ein unerwarteter Fehler aufgetreten.",8e3)})},e.currentUser().then(function(e){i.currentUser=e}),n.mailSendEnabled().then(function(e){i.mailSendEnabled=e.data.value})}angular.module("msWebApp").controller("ProfileController",e),e.$inject=["UserService","NotificationService","SettingsService"]}(),function(){"use strict";function e(t,e){var n="/webapp/api/settings";return{getInit:function(){return t({method:"GET",url:n+"/initSetupData"})},updateInit:function(e){return t({method:"PUT",data:e,url:n+"/initSetupData"})},get:function(){return t({method:"GET",url:n})},update:function(e){return t({method:"PUT",data:e,url:n})},sendTestMail:function(e){return t({method:"POST",data:e,url:n+"/sendTestMail"})},scansioEnabled:function(){return t({method:"GET",url:n+"/scansioEnabled"})},mailSendEnabled:function(){return t({method:"GET",url:n+"/mailSendEnabled"})},isCustomized:function(){return t({method:"GET",url:n+"/isCustomized"})},versionCheck:function(){return t({method:"GET",url:n+"/searchForUpdate"})}}}angular.module("msWebApp").factory("SettingsService",e),e.$inject=["$http","NotificationService"]}(),function(){"use strict";function e(e,t,n,i,r){var o=this;o.setupData={},o.loaded=!1,o.version=null,n.isCustomized().then(function(e){e.data.value?n.get().then(function(e){o.setupData=e.data,o.loaded=!0}):n.getInit().then(function(e){o.setupData=e.data,o.loaded=!0})}),o.saveData=function(){o.setupData.isCustomized?n.update(o.setupData).then(function(e){i.create("Konfiguration erfolgreich gespeichert.",6e3),r.resetUser()},function(e){i.create("Fehler beim Speichern! Bitte Ordner-Zugriffsberechtigungen überprüfen.",6e3),r.resetUser()}):n.updateInit(o.setupData).then(function(e){var t=window.location.protocol+"//"+window.location.host;window.location.replace(t)},function(e){i.create("Fehler bei der Initialisierung! Evtl. fehlende Ordner-Zugriffsberechtigungen.",6e3)})},o.sendTestMail=function(){i.create("Einen Moment bitte. Test-E-Mail wird versandt!",6e3),n.sendTestMail(o.setupData).then(function(e){$("#updateModalDialog").modal("show")},function(e){i.create("Versand der Test-E-Mail fehlgeschlagen!",6e3)})},o.versionCheck=function(){i.create("Einen Moment bitte. Es wird auf Updates geprüft!",1e3),n.versionCheck().then(function(e){o.version=e.data,$("#updateModalDialog").modal("show")},function(e){i.create("Abruf der aktuellen Version fehlgeschlagen!.",6e3)})}}angular.module("msWebApp").controller("SetupController",e),e.$inject=["$http","$state","SettingsService","NotificationService","UserService"]}(),function(){"use strict";function e(n,e,t,i,r,o,a){var s=this;s.currentUser={appUserName:"Keine Angabe"},s.userCanEditUsers=!1,s.userCanEditSettings=!1,s.settingsLoaded=!1,s.countOfMessages=function(){return t.getMessages().length},s.getMessages=function(){return t.getMessages()},s.getMessageDTO=function(e){return JSON.parse(e.value)},s.firstAction=function(e){r.billingUpdate(e.object1Id,e.messageType)},s.secondAction=function(e){r.billingDelete(e.object1Id)},s.thirdAction=function(e){t.deleteMessage(e.basicDataId)},s.problemSolved=function(e){t.problemSolved(e.basicDataId)},s.goToInvoice=function(e){var t={invoiceId:e};n.go("invoices.details",t)},a.isCustomized().then(function(e){e.data.value&&(o.currentUser().then(function(e){s.currentUser=e,o.hasUserRight("EDIT_USERS").then(function(e){s.userCanEditUsers=e}),o.hasUserRight("EDIT_SETTINGS").then(function(e){s.userCanEditSettings=e})}),s.settingsLoaded=!0)})}angular.module("msWebApp").controller("ShellController",e),e.$inject=["$state","$http","MessageService","NotificationService","BillingService","UserService","SettingsService"]}(),function(){"use strict";function e(n,e,t,i){var r=this;r.title="StandingOrderListController",r.toggleFilter=!1,r.goToInvoice=function(e,t){n.go("invoices.details",{invoiceId:e,view:t,returnView:"standingorders.list",isStandingOrder:!0})},r.getInvoices=function(e){return t.getInvoices(e)},r.startSearch=function(){r.refreshInvoices()},r.toggleFilterView=function(){r.toggleFilter=!r.toggleFilter},r.refreshInvoices=function(){t.setSearchMode(!1),t.allInvoices()},r.invoiceServiceLoading=function(){return t.isLoading()},r.newExpense=function(){n.go("invoices.create",{transactionType:"EXPENSE",isStandingOrder:!0,returnView:"standingorders.list"})},r.newIncome=function(){n.go("invoices.create",{transactionType:"INCOME",isStandingOrder:!0,returnView:"standingorders.list"})},r.otherMenuOptions=[["Einnahme",function(e,t,n){r.newIncome()}],["Ausgabe",function(e,t,n){r.newExpense()}]]}angular.module("msWebApp").controller("StandingOrderListController",e),e.$inject=["$state","$stateParams","InvoiceService","SearchService"]}(),function(){"use strict";function e(r,e,o,a){var s=this;s.users=[],s.key=null,s.userToDelete=null,s.scansioEnabled=!1,s.lockUser=function(e){if(e.editable=!1,e.new){var t=a.indexOf(s.users,e);s.users.splice(t,1)}},s.updateUser=function(i){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}i.appUserId||(i.appUserId=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()),r.adminUpdate(i).then(function(e){o.create("Benutzer wurde aktualisiert!",5e3),i.editable=!1,i.new=!1,i=e.data;var t=a.filter(s.users,function(e){return e.appUserId===i.appUserId});if(t&&0<t.length){var n=a.indexOf(s.users,t[0]);s.users[n]=e.data}r.resetUser()},function(e){if(o.create("Ausführung nicht möglich!",8e3),r.list().then(function(e){s.users=e.data}),i.editable=!1,i.new){var t=a.indexOf(s.users,i);s.users.splice(t,1)}})},s.showDeleteUserDialog=function(e){s.userToDelete=e,$("#userDeleteModalDialog").modal("show")},s.deleteUser=function(n){r.adminDelete(n).then(function(e){o.create("Benutzer wurde gelöscht!",5e3);var t=a.indexOf(s.users,n);s.users.splice(t,1),s.userToDelete=null,$("#userDeleteModalDialog").modal("hide")},function(e){if(o.create("Ausführung nicht möglich!",8e3),r.list().then(function(e){s.users=e.data}),n.editable=!1,n.new){var t=a.indexOf(s.users,n);s.users.splice(t,1)}})},s.addUser=function(){s.users.unshift({new:!0,editable:!0,enabled:!0,useAndroid:!0,useOcr:!1,editUsers:!1,editSettings:!1})},s.sendPassword=function(e){r.sendPassword(e).then(function(e){200===e.status?(s.key=e.data.value,$("#passwordResetModalDialog").modal("show")):o.create("Eine E-Mail zur Wiederherstellung wurde verschickt.",5e3),user.editable=!1},function(e){o.create("Leider ist ein unerwarteter Fehler aufgetreten.",8e3),user.editable=!1})},e.scansioEnabled().then(function(e){s.scansioEnabled=e.data.value,r.list().then(function(e){s.users=e.data},function(e){o.create("Benutzer konnnten nicht geladen werden.",4e3)})})}angular.module("msWebApp").controller("UserListController",e),e.$inject=["UserService","SettingsService","NotificationService","_"]}(),function(){"use strict";function e(i,e,t){var r={users:"/webapp/api/appusers",sendPassword:"/webapp/api"},n={update:function(e){i({method:"PUT",url:r.users+"/currentUser",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.create("Profil wurde aktualisiert!",5e3)})},adminUpdate:function(e){return i({method:"PUT",url:r.users,data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})},adminDelete:function(e){return i({method:"DELETE",url:r.users+"/"+e.appUserId,data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})},sendPassword:function(e){return i({method:"POST",url:r.sendPassword+"/sendPasswordKey",data:{value:e},headers:{"Content-Type":"application/json;charset=UTF-8"}})},currentUser:a,list:function(){return i({method:"GET",url:r.users})},hasUserRight:function(r){return e(function(i){a().then(function(e){var t,n;i((t=e.appRightDTOs,n=r,0<_.chain(t).pluck("code").intersection([n]).value().length))})})},resetUser:function(){o=null,a()}},o=null;return n;function a(){return e(function(t,n){null!=o?t(o):i({method:"GET",url:r.users+"/currentUser"}).then(function(e){o=e.data,t(o)},function(e){n(null)})})}}angular.module("msWebApp").factory("UserService",e),e.$inject=["$http","$q","NotificationService"]}(),function(){"use strict";function e(o,t){var a={usercontacts:"/webapp/api/usercontacts",findByEmail:"/webapp/api/appusers/findForUserContact",currentUser:"/webapp/api/appusers/currentUser"},e={list:c,getOne:function(e){return o({method:"GET",url:a.usercontacts+"/"+e})},getUsers:function(){return r},getUserContacts:function(){return i},getProjects:function(){return u},createProject:function(e){var n={contactName:e,project:!0};return t(function(t){o({method:"POST",url:a.usercontacts,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s.push(e.data),d(),t(e.data)})})},createUserContact:function(e){var n={contactName:e};return t(function(t){o({method:"POST",url:a.usercontacts,data:n,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s.push(e.data),d(),t(e.data)})})},remove:function(r){return t(function(i){return o({method:"DELETE",url:a.usercontacts+"/"+r}).then(function(e){var t=_.filter(s,function(e){return e.userContactId===r});if(null!=t&&null!=t&&0<t.length){var n=_.indexOf(s,t[0]);s.splice(n,1),d()}i(null)},function(e){$log.warn("Could not delete!","result",e),i(null)})})},createAppUserContact:function(){var e={appUserContactId:n.appUserId,contactName:n.appUserName,email:n.email};return t(function(t){o({method:"POST",url:a.usercontacts,data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){s.push(e.data),n=null,d(),t(e.data)})})},getFoundAppUser:function(){return n},searchForUser:function(e){var t={email:e};o({method:"POST",url:a.findByEmail,data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){n=e.data},function(e){n=null})},getCurrentUSer:l},n=null,s=[],i=[],r=[],u=[];return c().then(function(e){s=e.data,l().then(function(e){d()})}),e;function c(){return o({method:"GET",url:a.usercontacts})}function l(){return t(function(n){o({method:"GET",url:a.currentUser}).then(function(e){var t=e.data;t.contactName=t.appUserName,s.push(t),n(t)})})}function d(){i=_.filter(s,function(e){return null===e.appUserContactId&&(null==e.project||null==e.project)}),r=_.filter(s,function(e){return null!=e.appUserContactId&&(null==e.project||null==e.project)}),u=_.filter(s,function(e){return null!=e.project}),_.filter(s,function(e){return null!=e.appUserName}).forEach(function(e){r.push(e)})}}angular.module("msWebApp").factory("UsercontactService",e),e.$inject=["$http","$q"]}();
//# sourceMappingURL=../map/app.min.js.map
